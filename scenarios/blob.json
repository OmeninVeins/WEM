{"GUID":"f0f46b","Name":"Custom_Model_Bag","Transform":{"posX":13,"posY":5.84359932,"posZ":51.5,"rotX":7.882172e-9,"rotY":179.9651,"rotZ":0.00000494766255,"scaleX":1.20052135,"scaleY":0.249882281,"scaleZ":1.3145982},"Nickname":"Le Dévoreur de Toute Chose","Description":"","GMNotes":"scenarios/blob.json","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":1,"g":1,"b":1},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"MaterialIndex":-1,"MeshIndex":-1,"CustomMesh":{"MeshURL":"https://raw.githubusercontent.com/RobMayer/TTSLibrary/master/advboxes/tuckbox_h_MSH.obj","DiffuseURL":"http://cloud-3.steamusercontent.com/ugc/784129708171644922/CF8E4B744A65B5C7FEAF46C907D8E470A9E2241F/","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":3,"TypeIndex":6,"CustomShader":{"SpecularColor":{"r":1,"g":1,"b":1},"SpecularIntensity":0,"SpecularSharpness":2,"FresnelStrength":0},"CastShadows":true},"Bag":{"Order":0},"LuaScript":"-- Utility memory bag by Directsun\r\n-- Version 2.7.0\r\n-- Fork of Memory Bag 2.0 by MrStump\r\n--\r\n-- Want to contribute? Create an issue or fork the code on GitHub and submit a pull request:\r\n-- https://github.com/sunflowermans/TTS-UtilityMemoryBag\r\n\r\n\r\nfunction updateSave()\r\n    local data_to_save = {[\"ml\"]=memoryList}\r\n    saved_data = JSON.encode(data_to_save)\r\n    self.script_state = saved_data\r\nend\r\n\r\nfunction combineMemoryFromBagsWithin()\r\n    local bagObjList = self.getObjects()\r\n    for _, bagObj in ipairs(bagObjList) do\r\n        local data = bagObj.lua_script_state\r\n        if data ~= nil then\r\n            local j = JSON.decode(data)\r\n            if j ~= nil and j.ml ~= nil then\r\n                for guid, entry in pairs(j.ml) do\r\n                    memoryList[guid] = entry\r\n                end\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\nfunction updateMemoryWithMoves()\r\n    memoryList = memoryListBackup\r\n    --get the first transposed object's coordinates\r\n    local obj = getObjectFromGUID(moveGuid)\r\n\r\n    -- p1 is where needs to go, p2 is where it was\r\n    local refObjPos = memoryList[moveGuid].pos\r\n    local deltaPos = findOffsetDistance(obj.getPosition(), refObjPos, nil)\r\n    local movedRotation = obj.getRotation()\r\n    for guid, entry in pairs(memoryList) do\r\n        memoryList[guid].pos.x = entry.pos.x - deltaPos.x\r\n        memoryList[guid].pos.y = entry.pos.y - deltaPos.y\r\n        memoryList[guid].pos.z = entry.pos.z - deltaPos.z\r\n        -- memoryList[guid].rot.x = movedRotation.x\r\n        -- memoryList[guid].rot.y = movedRotation.y\r\n        -- memoryList[guid].rot.z = movedRotation.z\r\n    end\r\n\r\n    --theList[obj.getGUID()] = {\r\n    --    pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n    --    rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n    --    lock=obj.getLock()\r\n    --}\r\n    moveList = {}\r\nend\r\n\r\nfunction onload(saved_data)\r\n\r\n    fresh = true\r\n    if saved_data ~= \"\" then\r\n        local loaded_data = JSON.decode(saved_data)\r\n        --Set up information off of loaded_data\r\n        memoryList = loaded_data.ml\r\n    else\r\n        --Set up information for if there is no saved saved data\r\n        memoryList = {}\r\n\r\n    end\r\n\r\n    moveList = {}\r\n    moveGuid = nil\r\n\r\n    if next(memoryList) == nil then\r\n        createSetupButton()\r\n    else\r\n        fresh = false\r\n        createMemoryActionButtons()\r\n    end\r\nend\r\n\r\n\r\n--Beginning Setup\r\n\r\n\r\n--Make setup button\r\n function createSetupButton()\r\n    self.createButton({\r\n      label=\"Config\", click_function=\"buttonClick_setup\", function_owner=self,\r\n      position={0,0.1,-2.1}, rotation={0,0,0}, height=275, width=625,\r\n      font_size=150, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n end\r\n\r\n--Triggered by Transpose button\r\nfunction buttonClick_transpose()\r\n    moveGuid = nil\r\n    broadcastToAll(\"Select one object and move it- all objects will move relative to the new location\", {0.75, 0.75, 1})\r\n    memoryListBackup = duplicateTable(memoryList)\r\n    memoryList = {}\r\n    moveList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createButtonsOnAllObjects(true)\r\n    createSetupActionButtons(true)\r\nend\r\n\r\n--Triggered by setup button,\r\nfunction buttonClick_setup()\r\n    memoryListBackup = duplicateTable(memoryList)\r\n    memoryList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createButtonsOnAllObjects(false)\r\n    createSetupActionButtons(false)\r\nend\r\n\r\nfunction getAllObjectsInMemory()\r\n    local objTable = {}\r\n    local curObj = {}\r\n\r\n    for guid in pairs(memoryListBackup) do\r\n        curObj = getObjectFromGUID(guid)\r\n        table.insert(objTable, curObj)\r\n    end\r\n\r\n    return objTable\r\n    -- return getAllObjects()\r\nend\r\n\r\n--Creates selection buttons on objects\r\nfunction createButtonsOnAllObjects(move)\r\n    buttonIndexMap = {}\r\n    local howManyButtons = 0\r\n\r\n    local objsToHaveButtons = {}\r\n    if move == true then\r\n        objsToHaveButtons = getAllObjectsInMemory()\r\n    else\r\n        objsToHaveButtons = getAllObjects()\r\n    end\r\n\r\n    for _, obj in ipairs(objsToHaveButtons) do\r\n        if obj ~= self then\r\n            --On a normal bag, the button positions aren't the same size as the bag.\r\n            globalScaleFactor = 1* 1/self.getScale().x\r\n            --Super sweet math to set button positions\r\n            local selfPos = self.getPosition()\r\n            local objPos = obj.getPosition()\r\n            local deltaPos = findOffsetDistance(selfPos, objPos, obj)\r\n            local objPos = rotateLocalCoordinates(deltaPos, self)\r\n            objPos.x = -objPos.x * globalScaleFactor\r\n            objPos.y = objPos.y * globalScaleFactor + 2\r\n            objPos.z = objPos.z * globalScaleFactor * 0.9\r\n            --Workaround for custom PDFs\r\n            if obj.Book then\r\n                objPos.y = objPos.y + 0.5\r\n            end\r\n            --Offset rotation of bag\r\n            local rot = self.getRotation()\r\n            rot.y = -rot.y + 180\r\n            --Create function\r\n            local funcName = \"selectButton_\" .. howManyButtons\r\n            local func = function() buttonClick_selection(obj, move) end\r\n            local color = {0.75,0.25,0.25,0.6}\r\n            local colorMove = {0,0,1,0.6}\r\n            if move == true then\r\n                color = colorMove\r\n            end\r\n            self.setVar(funcName, func)\r\n            self.createButton({\r\n                click_function=funcName, function_owner=self,\r\n                position=objPos, rotation=rot, height=500, width=500,\r\n                color=color,\r\n            })\r\n            buttonIndexMap[obj.getGUID()] = howManyButtons\r\n            howManyButtons = howManyButtons + 1\r\n        end\r\n    end\r\nend\r\n\r\n--Creates submit and cancel buttons\r\nfunction createSetupActionButtons(move)\r\n    self.createButton({\r\n        label=\"Annuler\", click_function=\"buttonClick_cancel\", function_owner=self,\r\n      position={-0.7,0.1,2.1}, rotation={0,0,0}, height=275, width=625,\r\n      font_size=145, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n\r\n    self.createButton({\r\n        label=\"Valider\", click_function=\"buttonClick_submit\", function_owner=self,\r\n        position={-0.7,0.3,2.6}, rotation={0,0,0}, height=275, width=625,\r\n        font_size=140, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n\r\n    if move == false then\r\n      self.createButton({\r\n          label=\"Ajouter\", click_function=\"buttonClick_add\", function_owner=self,\r\n          position={0.7,0.3,2.1}, rotation={0,0,0}, height=275, width=625,\r\n          font_size=140, color={0,0,0}, font_color={0.25,1,0.25}\r\n      })\r\n\r\n        self.createButton({\r\n            label=\"Sélection\", click_function=\"editDragSelection\", function_owner=self,\r\n            position={-0.7,0.3,3.1}, rotation={0,0,0}, height=275, width=625,\r\n            font_size=125, color={0,0,0}, font_color={1,1,1}\r\n        })\r\n\r\n        if fresh == false then\r\n                self.createButton({\r\n                    label=\"Mise à jour\", click_function=\"buttonClick_setNew\", function_owner=self,\r\n                    position={0.7,0.3,3.1}, rotation={0,0,0}, height=275, width=625,\r\n                    font_size=105, color={0,0,0}, font_color={0.75,0.75,1}\r\n                })\r\n                self.createButton({\r\n                    label=\"Retirer\", click_function=\"buttonClick_remove\", function_owner=self,\r\n                    position={0.7,0.3,2.6}, rotation={0,0,0}, height=275, width=625,\r\n                    font_size=140, color={0,0,0}, font_color={1,0.25,0.25}\r\n                })\r\n            end\r\n        end\r\n\r\n        self.createButton({\r\n            label=\"Reset\", click_function=\"buttonClick_reset\", function_owner=self,\r\n            position={0,0.3,-2.1}, rotation={0,0,0}, height=275, width=625,\r\n            font_size=165, color={0,0,0}, font_color={1,1,1}\r\n        })\r\n    end\r\n\r\n\r\n--During Setup\r\n\r\n\r\n--Checks or unchecks buttons\r\nfunction buttonClick_selection(obj, move)\r\n    local index = buttonIndexMap[obj.getGUID()]\r\n    local colorMove = {0,0,1,0.6}\r\n    local color = {0,1,0,0.6}\r\n\r\n    previousGuid = selectedGuid\r\n    selectedGuid = obj.getGUID()\r\n\r\n    theList = memoryList\r\n    if move == true then\r\n        theList = moveList\r\n        if previousGuid ~= nil and previousGuid ~= selectedGuid then\r\n            local prevObj = getObjectFromGUID(previousGuid)\r\n            prevObj.highlightOff()\r\n            self.editButton({index=previousIndex, color=colorMove})\r\n            theList[previousGuid] = nil\r\n        end\r\n        previousIndex = index\r\n    end\r\n\r\n    if theList[selectedGuid] == nil then\r\n        self.editButton({index=index, color=color})\r\n        --Adding pos/rot to memory table\r\n        local pos, rot = obj.getPosition(), obj.getRotation()\r\n        --I need to add it like this or it won't save due to indexing issue\r\n        theList[obj.getGUID()] = {\r\n            pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n            rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n            lock=obj.getLock(),\r\n            tint=obj.getColorTint()\r\n        }\r\n        obj.highlightOn({0,1,0})\r\n    else\r\n        color = {0.75,0.25,0.25,0.6}\r\n        if move == true then\r\n            color = colorMove\r\n        end\r\n        self.editButton({index=index, color=color})\r\n        theList[obj.getGUID()] = nil\r\n        obj.highlightOff()\r\n    end\r\nend\r\n\r\nfunction editDragSelection(bagObj, player, remove)\r\n    local selectedObjs = Player[player].getSelectedObjects()\r\n    if not remove then\r\n        for _, obj in ipairs(selectedObjs) do\r\n            local index = buttonIndexMap[obj.getGUID()]\r\n            --Ignore if already in the memory list, or does not have a button\r\n            if index and not memoryList[obj.getGUID()] then\r\n                self.editButton({index=index, color={0,1,0,0.6}})\r\n                --Adding pos/rot to memory table\r\n                local pos, rot = obj.getPosition(), obj.getRotation()\r\n                --I need to add it like this or it won't save due to indexing issue\r\n                memoryList[obj.getGUID()] = {\r\n                    pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n                    rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n                    lock=obj.getLock(),\r\n                    tint=obj.getColorTint()\r\n                }\r\n                obj.highlightOn({0,1,0})\r\n            end\r\n        end\r\n    else\r\n        for _, obj in ipairs(selectedObjs) do\r\n            local index = buttonIndexMap[obj.getGUID()]\r\n            if index and memoryList[obj.getGUID()] then\r\n                color = {0.75,0.25,0.25,0.6}\r\n                self.editButton({index=index, color=color})\r\n                memoryList[obj.getGUID()] = nil\r\n                obj.highlightOff()\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\n--Cancels selection process\r\nfunction buttonClick_cancel()\r\n    memoryList = memoryListBackup\r\n    moveList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    if next(memoryList) == nil then\r\n        createSetupButton()\r\n    else\r\n        createMemoryActionButtons()\r\n    end\r\n    removeAllHighlights()\r\n    broadcastToAll(\"Sélection annulée\", {1,1,1})\r\n    moveGuid = nil\r\nend\r\n\r\n--Saves selections\r\nfunction buttonClick_submit()\r\n    fresh = false\r\n    if next(moveList) ~= nil then\r\n        for guid in pairs(moveList) do\r\n            moveGuid = guid\r\n        end\r\n        if memoryListBackup[moveGuid] == nil then\r\n            broadcastToAll(\"Item selected for moving is not already in memory\", {1, 0.25, 0.25})\r\n        else\r\n            broadcastToAll(\"Moving all items in memory relative to new objects position!\", {0.75, 0.75, 1})\r\n            self.clearButtons()\r\n            self.clearInputs()\r\n            createMemoryActionButtons()\r\n            local count = 0\r\n            for guid in pairs(moveList) do\r\n                moveGuid = guid\r\n                count = count + 1\r\n                local obj = getObjectFromGUID(guid)\r\n                if obj ~= nil then obj.highlightOff() end\r\n            end\r\n            updateMemoryWithMoves()\r\n            updateSave()\r\n            buttonClick_place()\r\n        end\r\n    elseif next(memoryList) == nil and moveGuid == nil then\r\n        memoryList = memoryListBackup\r\n        broadcastToAll(\"No selections made.\", {0.75, 0.25, 0.25})\r\n    end\r\n    combineMemoryFromBagsWithin()\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    updateSave()\r\n    moveGuid = nil\r\nend\r\n\r\nfunction combineTables(first_table, second_table)\r\n    for k,v in pairs(second_table) do first_table[k] = v end\r\nend\r\n\r\nfunction buttonClick_add()\r\n    fresh = false\r\n    combineTables(memoryList, memoryListBackup)\r\n    broadcastToAll(\"Adding internal bags and selections to existing memory\", {0.25, 0.75, 0.25})\r\n    combineMemoryFromBagsWithin()\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    updateSave()\r\nend\r\n\r\nfunction buttonClick_remove()\r\n    broadcastToAll(\"Removing Selected Entries From Memory\", {1.0, 0.25, 0.25})\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        memoryListBackup[guid] = nil\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Removed\", {1,1,1})\r\n    memoryList = memoryListBackup\r\n    updateSave()\r\nend\r\n\r\nfunction buttonClick_setNew()\r\n    broadcastToAll(\"Setting new position relative to items in memory\", {0.75, 0.75, 1})\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        guid = obj.guid\r\n        if memoryListBackup[guid] ~= nil then\r\n            count = count + 1\r\n            memoryListBackup[guid].pos = obj.getPosition()\r\n            memoryListBackup[guid].rot = obj.getRotation()\r\n            memoryListBackup[guid].lock = obj.getLock()\r\n            memoryListBackup[guid].tint = obj.getColorTint()\r\n        end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    memoryList = memoryListBackup\r\n    updateSave()\r\nend\r\n\r\n--Resets bag to starting status\r\nfunction buttonClick_reset()\r\n    fresh = true\r\n    memoryList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createSetupButton()\r\n    removeAllHighlights()\r\n    broadcastToAll(\"Tool Reset\", {1,1,1})\r\n    updateSave()\r\nend\r\n\r\n\r\n--After Setup\r\n\r\n\r\n--Creates recall and place buttons\r\nfunction createMemoryActionButtons()\r\n    self.createButton({\r\n        label=\"Placer\", click_function=\"buttonClick_place\", function_owner=self,\r\n        position={0.7,0.1,2.2}, rotation={0,0,0}, height=275, width=625,\r\n        font_size=150, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    self.createButton({\r\n        label=\"Ranger\", click_function=\"buttonClick_recall\", function_owner=self,\r\n        position={-0.7,0.1,2.2}, rotation={0,0,0}, height=275, width=625,\r\n        font_size=150, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    self.createButton({\r\n        label=\"Config\", click_function=\"buttonClick_setup\", function_owner=self,\r\n        position={0,0.1,-2.2}, rotation={0,0,0}, height=275, width=625,\r\n        font_size=150, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    ---    self.createButton({\r\n    ---      label=\"Bouger\", click_function=\"buttonClick_transpose\", function_owner=self,\r\n    ---      position={-2,0.3,0.8}, rotation={0,270,0}, height=350, width=800,\r\n    ---      font_size=250, color={0,0,0}, font_color={0.75,0.75,1}\r\n    ---\r\nend\r\n\r\n--Sends objects from bag/table to their saved position/rotation\r\nfunction buttonClick_place()\r\n    local bagObjList = self.getObjects()\r\n    for guid, entry in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        --If obj is out on the table, move it to the saved pos/rot\r\n        if obj ~= nil then\r\n            obj.setPositionSmooth(entry.pos)\r\n            obj.setRotationSmooth(entry.rot)\r\n            obj.setLock(entry.lock)\r\n            obj.setColorTint(entry.tint)\r\n        else\r\n            --If obj is inside of the bag\r\n            for _, bagObj in ipairs(bagObjList) do\r\n                if bagObj.guid == guid then\r\n                    local item = self.takeObject({\r\n                        guid=guid, position=entry.pos, rotation=entry.rot, smooth=false\r\n                    })\r\n                    item.setLock(entry.lock)\r\n                    item.setColorTint(entry.tint)\r\n                    break\r\n                end\r\n            end\r\n        end\r\n    end\r\n    broadcastToAll(\"Objets placés\", {1,1,1})\r\nend\r\n\r\n--Recalls objects to bag from table\r\nfunction buttonClick_recall()\r\n    for guid, entry in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then self.putObject(obj) end\r\n    end\r\n    broadcastToAll(\"Objets rangés\", {1,1,1})\r\nend\r\n\r\n\r\n--Utility functions\r\n\r\n\r\n--Find delta (difference) between 2 x/y/z coordinates\r\nfunction findOffsetDistance(p1, p2, obj)\r\n    local yOffset = 0\r\n    if obj ~= nil then\r\n        local bounds = obj.getBounds()\r\n        yOffset = (bounds.size.y - bounds.offset.y)\r\n    end\r\n    local deltaPos = {}\r\n    deltaPos.x = (p2.x-p1.x)\r\n    deltaPos.y = (p2.y-p1.y) + yOffset\r\n    deltaPos.z = (p2.z-p1.z)\r\n    return deltaPos\r\nend\r\n\r\n--Used to rotate a set of coordinates by an angle\r\nfunction rotateLocalCoordinates(desiredPos, obj)\r\n    local objPos, objRot = obj.getPosition(), obj.getRotation()\r\n    local angle = math.rad(objRot.y)\r\n    local x = desiredPos.x * math.cos(angle) - desiredPos.z * math.sin(angle)\r\n    local z = desiredPos.x * math.sin(angle) + desiredPos.z * math.cos(angle)\r\n    --return {x=objPos.x+x, y=objPos.y+desiredPos.y, z=objPos.z+z}\r\n    return {x=x, y=desiredPos.y, z=z}\r\nend\r\n\r\nfunction rotateMyCoordinates(desiredPos, obj)\r\n    local angle = math.rad(obj.getRotation().y)\r\n    local x = desiredPos.x * math.sin(angle)\r\n    local z = desiredPos.z * math.cos(angle)\r\n    return {x=x, y=desiredPos.y, z=z}\r\nend\r\n\r\n--Coroutine delay, in seconds\r\nfunction wait(time)\r\n    local start = os.time()\r\n    repeat coroutine.yield(0) until os.time() > start + time\r\nend\r\n\r\n--Duplicates a table (needed to prevent it making reference to the same objects)\r\nfunction duplicateTable(oldTable)\r\n    local newTable = {}\r\n    for k, v in pairs(oldTable) do\r\n        newTable[k] = v\r\n    end\r\n    return newTable\r\nend\r\n\r\n--Moves scripted highlight from all objects\r\nfunction removeAllHighlights()\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        obj.highlightOff()\r\n    end\r\nend\r\n\r\n--Round number (num) to the Nth decimal (dec)\r\nfunction round(num, dec)\r\n    local mult = 10^(dec or 0)\r\n    return math.floor(num * mult + 0.5) / mult\r\nend\r\n\r\n\r\n--[[\r\nThis object provides access to a variable stored on the \"Global script\".\r\nThe variable holds the GUIDs for every Utility Memory Bag in the scene.\r\nExample:\r\n{'805ebd', '35cc21', 'fc8886', 'f50264', '5f5f63'}\r\n--]]\r\nAllMemoryBagsInScene = {\r\n    NAME_OF_GLOBAL_VARIABLE = \"_UtilityMemoryBag_AllMemoryBagsInScene\"\r\n}\r\n\r\nfunction AllMemoryBagsInScene:add(guid)\r\n    local guids = Global.getTable(self.NAME_OF_GLOBAL_VARIABLE) or {}\r\n    table.insert(guids, guid)\r\n    Global.setTable(self.NAME_OF_GLOBAL_VARIABLE, guids)\r\nend\r\n\r\nfunction AllMemoryBagsInScene:getGuidList()\r\n    return Global.getTable(self.NAME_OF_GLOBAL_VARIABLE) or {}\r\nend\r\n","LuaScriptState":"{\"ml\":{\"01469d\":{\"lock\":true,\"pos\":{\"x\":15,\"y\":1.51986587047577,\"z\":22.5000038146973},\"rot\":{\"x\":0.0108916815370321,\"y\":179.99787902832,\"z\":0.00494789704680443},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"061b0f\":{\"lock\":true,\"pos\":{\"x\":-31.5021228790283,\"y\":1.83530044555664,\"z\":13.5050506591797},\"rot\":{\"x\":-5.92946707911324E-06,\"y\":180.002685546875,\"z\":-1.53315966144874E-07},\"tint\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1}},\"098203\":{\"lock\":false,\"pos\":{\"x\":17.5,\"y\":1.5419,\"z\":-5.9999},\"rot\":{\"x\":-0.0001,\"y\":90.0013,\"z\":0},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"0ae88f\":{\"lock\":true,\"pos\":{\"x\":5.99999856948853,\"y\":1.51608097553253,\"z\":-1.4999965429306},\"rot\":{\"x\":0.0108917616307735,\"y\":179.997863769531,\"z\":0.00494780298322439},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"0caba3\":{\"lock\":false,\"pos\":{\"x\":-30,\"y\":1.8006,\"z\":12},\"rot\":{\"x\":0,\"y\":179.9896,\"z\":0},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"0fa462\":{\"lock\":false,\"pos\":{\"x\":-23.5,\"y\":1.8006,\"z\":12},\"rot\":{\"x\":0,\"y\":179.9967,\"z\":0},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"1b1606\":{\"lock\":false,\"pos\":{\"x\":-29.5000095367432,\"y\":1.58026671409607,\"z\":11.9999904632568},\"rot\":{\"x\":5.32608009962132E-06,\"y\":0.000129239982925355,\"z\":-1.51738916542854E-07},\"tint\":{\"a\":1,\"b\":0,\"g\":0.366520881652832,\"r\":0.70588231086731}},\"2b78cf\":{\"lock\":false,\"pos\":{\"x\":5.99999856948853,\"y\":1.50314164161682,\"z\":2.00000071525574},\"rot\":{\"x\":0.0108923316001892,\"y\":179.99153137207,\"z\":0.00495187425985932},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"2c8d02\":{\"lock\":false,\"pos\":{\"x\":-26.4364910125732,\"y\":1.82890462875366,\"z\":2.97434997558594},\"rot\":{\"x\":8.01447185949655E-06,\"y\":180.417205810547,\"z\":-1.18103889690246E-05},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"2cf647\":{\"lock\":true,\"pos\":{\"x\":-21,\"y\":1.8353,\"z\":13.5},\"rot\":{\"x\":0,\"y\":179.9966,\"z\":0},\"tint\":{\"a\":1,\"b\":0,\"g\":0,\"r\":0.614982545375824}},\"2eee61\":{\"lock\":true,\"pos\":{\"x\":5.99999856948853,\"y\":1.52216386795044,\"z\":30.5000038146973},\"rot\":{\"x\":0.0108916442841291,\"y\":179.997589111328,\"z\":0.00494775641709566},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"32a399\":{\"lock\":false,\"pos\":{\"x\":17.5,\"y\":1.5419,\"z\":-5.9999},\"rot\":{\"x\":-0.0001,\"y\":89.9997,\"z\":0},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"32a69c\":{\"lock\":false,\"pos\":{\"x\":-33.5001,\"y\":1.7958,\"z\":11.9999},\"rot\":{\"x\":0,\"y\":180.0009,\"z\":0},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"32c650\":{\"lock\":true,\"pos\":{\"x\":-3.00000143051147,\"y\":1.5214204788208,\"z\":22.5000038146973},\"rot\":{\"x\":0.0108917318284512,\"y\":179.99787902832,\"z\":0.00494791055098176},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"36b4eb\":{\"lock\":false,\"pos\":{\"x\":32.8824996948242,\"y\":1.47985994815826,\"z\":14.9982004165649},\"rot\":{\"x\":9.8491463873529E-09,\"y\":180.003402709961,\"z\":3.50982460872729E-08},\"tint\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1}},\"3989a8\":{\"lock\":true,\"pos\":{\"x\":-20.5,\"y\":1.7663,\"z\":17},\"rot\":{\"x\":0,\"y\":-0.0003,\"z\":0},\"tint\":{\"a\":0,\"b\":0,\"g\":0,\"r\":0}},\"3a6bb8\":{\"lock\":false,\"pos\":{\"x\":10.4999980926514,\"y\":1.50664985179901,\"z\":22.5000038146973},\"rot\":{\"x\":0.00494618061929941,\"y\":89.9915771484375,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"46f500\":{\"lock\":false,\"pos\":{\"x\":10.4999980926514,\"y\":1.5036084651947,\"z\":6.50000143051147},\"rot\":{\"x\":0.00494601018726826,\"y\":89.9916534423828,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"483110\":{\"lock\":false,\"pos\":{\"x\":-27.0740947723389,\"y\":1.77890574932098,\"z\":2.97146821022034},\"rot\":{\"x\":-8.83284982933219E-08,\"y\":180.417297363281,\"z\":-3.34041615133174E-05},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"4a63ca\":{\"lock\":true,\"pos\":{\"x\":-20,\"y\":1.8578,\"z\":7},\"rot\":{\"x\":0,\"y\":180.0011,\"z\":0},\"tint\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1}},\"4ff304\":{\"lock\":false,\"pos\":{\"x\":1.49999713897705,\"y\":1.50590634346008,\"z\":14.5000028610229},\"rot\":{\"x\":0.00494621833786368,\"y\":89.9915008544922,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"5359e8\":{\"lock\":true,\"pos\":{\"x\":5.99999809265137,\"y\":1.52064323425293,\"z\":22.5000057220459},\"rot\":{\"x\":0.0108917867764831,\"y\":179.99772644043,\"z\":0.00494781835004687},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"538522\":{\"lock\":true,\"pos\":{\"x\":-3.00000238418579,\"y\":1.5183789730072,\"z\":6.50000286102295},\"rot\":{\"x\":0.0108917411416769,\"y\":179.997512817383,\"z\":0.0049477331340313},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"548427\":{\"lock\":false,\"pos\":{\"x\":-32.9896507263184,\"y\":1.82890379428864,\"z\":19.4867630004883},\"rot\":{\"x\":6.67911263008136E-06,\"y\":180.160095214844,\"z\":-1.15128341349191E-05},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"54f237\":{\"lock\":false,\"pos\":{\"x\":-27,\"y\":1.8006,\"z\":12},\"rot\":{\"x\":0,\"y\":179.9922,\"z\":0},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"5d8be3\":{\"lock\":false,\"pos\":{\"x\":1.49999845027924,\"y\":1.50742709636688,\"z\":22.5000038146973},\"rot\":{\"x\":0.00494619831442833,\"y\":89.9915771484375,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"6147ae\":{\"lock\":false,\"pos\":{\"x\":-19,\"y\":1.47985994815826,\"z\":-5.50000667572021},\"rot\":{\"x\":-1.9078504465142E-07,\"y\":180.001693725586,\"z\":-1.94291700950089E-07},\"tint\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1}},\"61ae50\":{\"lock\":true,\"pos\":{\"x\":14.9999980926514,\"y\":1.51834523677826,\"z\":14.5000028610229},\"rot\":{\"x\":0.0108916331082582,\"y\":179.997650146484,\"z\":0.0049478248693049},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"62ced0\":{\"lock\":true,\"pos\":{\"x\":-28.0023612976074,\"y\":1.83530044555664,\"z\":13.5040111541748},\"rot\":{\"x\":-4.89672720505041E-06,\"y\":180.002548217773,\"z\":3.97426447307225E-07},\"tint\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1}},\"6345b1\":{\"lock\":false,\"pos\":{\"x\":5.99999856948853,\"y\":1.50627815723419,\"z\":18.5000038146973},\"rot\":{\"x\":0.0108934119343758,\"y\":179.980438232422,\"z\":0.00494872685521841},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"6978c3\":{\"lock\":false,\"pos\":{\"x\":-23.0000305175781,\"y\":1.80067372322083,\"z\":6.99996185302734},\"rot\":{\"x\":-5.02156535731046E-06,\"y\":180.001022338867,\"z\":-2.55313992170159E-08},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"69fd89\":{\"lock\":false,\"pos\":{\"x\":14.9999980926514,\"y\":1.50550091266632,\"z\":18.5000038146973},\"rot\":{\"x\":0.0108920866623521,\"y\":179.991577148438,\"z\":0.00495073711499572},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"6fffbd\":{\"lock\":true,\"pos\":{\"x\":-24.5,\"y\":1.7663,\"z\":12.5},\"rot\":{\"x\":0,\"y\":-0.0001,\"z\":0},\"tint\":{\"a\":0,\"b\":0,\"g\":0,\"r\":0}},\"700c1f\":{\"lock\":true,\"pos\":{\"x\":-3.00000500679016,\"y\":1.519899725914,\"z\":14.5000038146973},\"rot\":{\"x\":0.0108901411294937,\"y\":180.015686035156,\"z\":0.00495116645470262},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"703535\":{\"lock\":false,\"pos\":{\"x\":6.00001049041748,\"y\":1.51912248134613,\"z\":14.5000038146973},\"rot\":{\"x\":0.0108888484537601,\"y\":180.029815673828,\"z\":0.00495397765189409},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"71210c\":{\"lock\":false,\"pos\":{\"x\":19.4999980926514,\"y\":1.50435185432434,\"z\":14.5000028610229},\"rot\":{\"x\":0.00494622765108943,\"y\":89.9916687011719,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"7234af\":{\"lock\":false,\"pos\":{\"x\":5.99999856948853,\"y\":1.50475740432739,\"z\":10.5000038146973},\"rot\":{\"x\":0.0108928140252829,\"y\":179.985778808594,\"z\":0.00494934152811766},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"7e350d\":{\"lock\":false,\"pos\":{\"x\":17.5039,\"y\":1.536,\"z\":-6.0055},\"rot\":{\"x\":0.0049,\"y\":89.9244,\"z\":359.9891},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"81cac9\":{\"lock\":true,\"pos\":{\"x\":15,\"y\":1.5167293548584,\"z\":6.00000333786011},\"rot\":{\"x\":0.0108907101675868,\"y\":180.010620117188,\"z\":0.00495028123259544},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"8431e1\":{\"lock\":true,\"pos\":{\"x\":24,\"y\":1.51756799221039,\"z\":14.5000028610229},\"rot\":{\"x\":0.0108917783945799,\"y\":179.997299194336,\"z\":0.00494762975722551},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"88e8cf\":{\"lock\":false,\"pos\":{\"x\":-3.00000143051147,\"y\":1.50705540180206,\"z\":18.5000038146973},\"rot\":{\"x\":0.0108919711783528,\"y\":179.995635986328,\"z\":0.00495131080970168},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"89ac42\":{\"lock\":true,\"pos\":{\"x\":-32.5,\"y\":1.7663,\"z\":17},\"rot\":{\"x\":0,\"y\":0.0005,\"z\":0},\"tint\":{\"a\":0,\"b\":0,\"g\":0,\"r\":0}},\"8c9d30\":{\"lock\":false,\"pos\":{\"x\":-22.00026512146,\"y\":1.8343722820282,\"z\":3.99973034858704},\"rot\":{\"x\":-5.52360916117323E-06,\"y\":180.029983520508,\"z\":3.15148042773217E-07},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"92575b\":{\"lock\":false,\"pos\":{\"x\":35,\"y\":1.558,\"z\":1.5},\"rot\":{\"x\":0.0011,\"y\":90.0005,\"z\":0.0006},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"997e6e\":{\"lock\":false,\"pos\":{\"x\":12.500020980835,\"y\":1.53643202781677,\"z\":-5.99998760223389},\"rot\":{\"x\":0.00494876969605684,\"y\":90.0044555664063,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"9ab76d\":{\"lock\":false,\"pos\":{\"x\":-33.5800018310547,\"y\":1.7789044380188,\"z\":19.4884128570557},\"rot\":{\"x\":-1.01138846275717E-06,\"y\":180.160263061523,\"z\":-2.72387806035113E-05},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"9cae28\":{\"lock\":false,\"pos\":{\"x\":23.4999752044678,\"y\":1.51380932331085,\"z\":-5.49988174438477},\"rot\":{\"x\":0.0108873629942536,\"y\":180.047729492188,\"z\":0.00495735229924321},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"9d2e11\":{\"lock\":true,\"pos\":{\"x\":-28.0004177093506,\"y\":1.76630067825317,\"z\":11.0194177627563},\"rot\":{\"x\":5.30092438566498E-06,\"y\":-0.000355626427335665,\"z\":-1.98829326336636E-07},\"tint\":{\"a\":0,\"b\":0,\"g\":0,\"r\":0}},\"a1af1f\":{\"lock\":false,\"pos\":{\"x\":5.99999856948853,\"y\":1.50779891014099,\"z\":26.5000038146973},\"rot\":{\"x\":0.010892485268414,\"y\":179.99153137207,\"z\":0.00495024072006345},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"b76184\":{\"lock\":false,\"pos\":{\"x\":-3.00000143051147,\"y\":1.50553464889526,\"z\":10.5000038146973},\"rot\":{\"x\":0.0108925187960267,\"y\":179.986328125,\"z\":0.00494983652606606},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"bcee25\":{\"lock\":true,\"pos\":{\"x\":-20.9999885559082,\"y\":1.76630067825317,\"z\":10.9999752044678},\"rot\":{\"x\":5.14187149747158E-06,\"y\":0.000720200361683965,\"z\":-3.30811474213988E-07},\"tint\":{\"a\":0,\"b\":0,\"g\":0,\"r\":0}},\"c05dd6\":{\"lock\":false,\"pos\":{\"x\":30.4999008178711,\"y\":1.709876537323,\"z\":-3},\"rot\":{\"x\":-0.000591230695135891,\"y\":179.999923706055,\"z\":180.001068115234},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"c13319\":{\"lock\":true,\"pos\":{\"x\":-12.0000019073486,\"y\":1.52067697048187,\"z\":14.5000028610229},\"rot\":{\"x\":0.0108916461467743,\"y\":179.997741699219,\"z\":0.00494782021269202},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"c1334a\":{\"lock\":false,\"pos\":{\"x\":-23.0000705718994,\"y\":1.79586005210876,\"z\":2.99992370605469},\"rot\":{\"x\":-4.90501224703621E-06,\"y\":180.004455566406,\"z\":-3.10950099446927E-07},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"c425b7\":{\"lock\":false,\"pos\":{\"x\":10.4999980926514,\"y\":1.50512909889221,\"z\":14.5000038146973},\"rot\":{\"x\":0.00494600180536509,\"y\":89.991569519043,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"c51491\":{\"lock\":false,\"pos\":{\"x\":3,\"y\":1.5018,\"z\":-6.5},\"rot\":{\"x\":0.0109,\"y\":180.0115,\"z\":0.005},\"tint\":{\"a\":1,\"b\":0.701960802078247,\"g\":0.800000011920929,\"r\":0.874509811401367}},\"c76ae2\":{\"lock\":false,\"pos\":{\"x\":-26.9099178314209,\"y\":1.77890479564667,\"z\":19.4996528625488},\"rot\":{\"x\":-4.98009512739372E-06,\"y\":180.02619934082,\"z\":1.75983004169211E-07},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"c91fef\":{\"lock\":true,\"pos\":{\"x\":-26.5,\"y\":1.7663,\"z\":17},\"rot\":{\"x\":0,\"y\":-0.0001,\"z\":0},\"tint\":{\"a\":0,\"b\":0,\"g\":0,\"r\":0}},\"d03c7b\":{\"lock\":false,\"pos\":{\"x\":35,\"y\":1.558,\"z\":1.5},\"rot\":{\"x\":0.0011,\"y\":90,\"z\":0.0006},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"d3deeb\":{\"lock\":true,\"pos\":{\"x\":5.99999856948853,\"y\":1.51760172843933,\"z\":6.50000333786011},\"rot\":{\"x\":0.0108914552256465,\"y\":179.999816894531,\"z\":0.00494824862107635},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"d7e54e\":{\"lock\":false,\"pos\":{\"x\":14.9999990463257,\"y\":1.50398015975952,\"z\":10.5000038146973},\"rot\":{\"x\":0.0108905201777816,\"y\":180.011245727539,\"z\":0.00494937552139163},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"ed4821\":{\"lock\":true,\"pos\":{\"x\":-31.30397605896,\"y\":1.76630067825317,\"z\":10.9651508331299},\"rot\":{\"x\":4.7331550376839E-06,\"y\":0.000102689169580117,\"z\":1.89697914265707E-07},\"tint\":{\"a\":0,\"b\":0,\"g\":0,\"r\":0}},\"f2a81d\":{\"lock\":false,\"pos\":{\"x\":17.501,\"y\":1.536,\"z\":-6.0196},\"rot\":{\"x\":0.0049,\"y\":89.981,\"z\":359.9891},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"f8961e\":{\"lock\":false,\"pos\":{\"x\":23.5000038146973,\"y\":1.5506796836853,\"z\":-3.00001120567322},\"rot\":{\"x\":0.0108458083122969,\"y\":180.004333496094,\"z\":0.0049500479362905},\"tint\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1}},\"f9947f\":{\"lock\":false,\"pos\":{\"x\":1.99999833106995,\"y\":1.50434243679047,\"z\":6.50000143051147},\"rot\":{\"x\":0.00494610983878374,\"y\":89.9915771484375,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"fad34b\":{\"lock\":false,\"pos\":{\"x\":-20.0000495910645,\"y\":1.77890622615814,\"z\":2.99994659423828},\"rot\":{\"x\":-5.0725234359561E-06,\"y\":180.005477905273,\"z\":1.14185958466351E-07},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"fb5176\":{\"lock\":false,\"pos\":{\"x\":-7.50000143051147,\"y\":1.50668370723724,\"z\":14.5000028610229},\"rot\":{\"x\":0.0049461736343801,\"y\":89.9914398193359,\"z\":359.989105224609},\"tint\":{\"a\":1,\"b\":0.604529500007629,\"g\":0.604529500007629,\"r\":0.604529500007629}},\"fe0c46\":{\"lock\":true,\"pos\":{\"x\":-34,\"y\":1.7663,\"z\":12.5},\"rot\":{\"x\":0,\"y\":0.0001,\"z\":0},\"tint\":{\"a\":0,\"b\":0,\"g\":0,\"r\":0}}}}","XmlUI":"","ContainedObjects":[{"GUID":"01469d","Name":"CardCustom","Transform":{"posX":15,"posY":1.51986587,"posZ":22.5000038,"rotX":0.0108916815,"rotY":179.997879,"rotZ":0.004947897,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"061b0f","Name":"Custom_Model_Bag","Transform":{"posX":-31.5021229,"posY":1.83530045,"posZ":13.5050507,"rotX":-0.000005929467,"rotY":180.002686,"rotZ":-1.53315966e-7,"scaleX":0.7,"scaleY":0.7,"scaleZ":0.7},"Nickname":"Multijoueur épique","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":1,"g":1,"b":1},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"MaterialIndex":-1,"MeshIndex":-1,"CustomMesh":{"MeshURL":"https://pastebin.com/raw/ALrYhQGb","DiffuseURL":"http://cloud-3.steamusercontent.com/ugc/1932636510528591705/02DC1C54165DD4FC8E9FBC46539ECBF9498BF8F0/","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":3,"TypeIndex":6,"CustomShader":{"SpecularColor":{"r":1,"g":1,"b":1},"SpecularIntensity":0,"SpecularSharpness":2,"FresnelStrength":0},"CastShadows":true},"Bag":{"Order":0},"LuaScript":"-- Utility memory bag by Directsun\r\n-- Version 2.7.0\r\n-- Fork of Memory Bag 2.0 by MrStump\r\n--\r\n-- Want to contribute? Create an issue or fork the code on GitHub and submit a pull request:\r\n-- https://github.com/sunflowermans/TTS-UtilityMemoryBag\r\n\r\n\r\nfunction updateSave()\r\n    local data_to_save = {[\"ml\"]=memoryList}\r\n    saved_data = JSON.encode(data_to_save)\r\n    self.script_state = saved_data\r\nend\r\n\r\nfunction combineMemoryFromBagsWithin()\r\n    local bagObjList = self.getObjects()\r\n    for _, bagObj in ipairs(bagObjList) do\r\n        local data = bagObj.lua_script_state\r\n        if data ~= nil then\r\n            local j = JSON.decode(data)\r\n            if j ~= nil and j.ml ~= nil then\r\n                for guid, entry in pairs(j.ml) do\r\n                    memoryList[guid] = entry\r\n                end\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\nfunction updateMemoryWithMoves()\r\n    memoryList = memoryListBackup\r\n    --get the first transposed object's coordinates\r\n    local obj = getObjectFromGUID(moveGuid)\r\n\r\n    -- p1 is where needs to go, p2 is where it was\r\n    local refObjPos = memoryList[moveGuid].pos\r\n    local deltaPos = findOffsetDistance(obj.getPosition(), refObjPos, nil)\r\n    local movedRotation = obj.getRotation()\r\n    for guid, entry in pairs(memoryList) do\r\n        memoryList[guid].pos.x = entry.pos.x - deltaPos.x\r\n        memoryList[guid].pos.y = entry.pos.y - deltaPos.y\r\n        memoryList[guid].pos.z = entry.pos.z - deltaPos.z\r\n        -- memoryList[guid].rot.x = movedRotation.x\r\n        -- memoryList[guid].rot.y = movedRotation.y\r\n        -- memoryList[guid].rot.z = movedRotation.z\r\n    end\r\n\r\n    --theList[obj.getGUID()] = {\r\n    --    pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n    --    rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n    --    lock=obj.getLock()\r\n    --}\r\n    moveList = {}\r\nend\r\n\r\nfunction onload(saved_data)\r\n\r\n    fresh = true\r\n    if saved_data ~= \"\" then\r\n        local loaded_data = JSON.decode(saved_data)\r\n        --Set up information off of loaded_data\r\n        memoryList = loaded_data.ml\r\n    else\r\n        --Set up information for if there is no saved saved data\r\n        memoryList = {}\r\n\r\n    end\r\n\r\n    moveList = {}\r\n    moveGuid = nil\r\n\r\n    if next(memoryList) == nil then\r\n        createSetupButton()\r\n    else\r\n        fresh = false\r\n        createMemoryActionButtons()\r\n    end\r\nend\r\n\r\n\r\n--Beginning Setup\r\n\r\n\r\n--Make setup button\r\nfunction createSetupButton()\r\n    self.createButton({\r\n        label=\"Config\", click_function=\"buttonClick_setup\", function_owner=self,\r\n        position={0,0.3,2}, rotation={0,0,0}, height=350, width=800,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\nend\r\n\r\n--Triggered by Transpose button\r\nfunction buttonClick_transpose()\r\n    moveGuid = nil\r\n    broadcastToAll(\"Select one object and move it- all objects will move relative to the new location\", {0.75, 0.75, 1})\r\n    memoryListBackup = duplicateTable(memoryList)\r\n    memoryList = {}\r\n    moveList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createButtonsOnAllObjects(true)\r\n    createSetupActionButtons(true)\r\nend\r\n\r\n--Triggered by setup button,\r\nfunction buttonClick_setup()\r\n    memoryListBackup = duplicateTable(memoryList)\r\n    memoryList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createButtonsOnAllObjects(false)\r\n    createSetupActionButtons(false)\r\nend\r\n\r\nfunction getAllObjectsInMemory()\r\n    local objTable = {}\r\n    local curObj = {}\r\n\r\n    for guid in pairs(memoryListBackup) do\r\n        curObj = getObjectFromGUID(guid)\r\n        table.insert(objTable, curObj)\r\n    end\r\n\r\n    return objTable\r\n    -- return getAllObjects()\r\nend\r\n\r\n--Creates selection buttons on objects\r\nfunction createButtonsOnAllObjects(move)\r\n    buttonIndexMap = {}\r\n    local howManyButtons = 0\r\n\r\n    local objsToHaveButtons = {}\r\n    if move == true then\r\n        objsToHaveButtons = getAllObjectsInMemory()\r\n    else\r\n        objsToHaveButtons = getAllObjects()\r\n    end\r\n\r\n    for _, obj in ipairs(objsToHaveButtons) do\r\n        if obj ~= self then\r\n            --On a normal bag, the button positions aren't the same size as the bag.\r\n            globalScaleFactor = 1 * 1/self.getScale().x\r\n            --Super sweet math to set button positions\r\n            local selfPos = self.getPosition()\r\n            local objPos = obj.getPosition()\r\n            local deltaPos = findOffsetDistance(selfPos, objPos, obj)\r\n            local objPos = rotateLocalCoordinates(deltaPos, self)\r\n            objPos.x = -objPos.x * globalScaleFactor\r\n            objPos.y = objPos.y * globalScaleFactor +2\r\n            objPos.z = objPos.z * globalScaleFactor\r\n            --Workaround for custom PDFs\r\n            if obj.Book then\r\n                objPos.y = objPos.y + 0.5\r\n            end\r\n            --Offset rotation of bag\r\n            local rot = self.getRotation()\r\n            rot.y = -rot.y + 180\r\n            --Create function\r\n            local funcName = \"selectButton_\" .. howManyButtons\r\n            local func = function() buttonClick_selection(obj, move) end\r\n            local color = {0.75,0.25,0.25,0.6}\r\n            local colorMove = {0,0,1,0.6}\r\n            if move == true then\r\n                color = colorMove\r\n            end\r\n            self.setVar(funcName, func)\r\n            self.createButton({\r\n                click_function=funcName, function_owner=self,\r\n                position=objPos, rotation=rot, height=1000, width=1000,\r\n                color=color,\r\n            })\r\n            buttonIndexMap[obj.getGUID()] = howManyButtons\r\n            howManyButtons = howManyButtons + 1\r\n        end\r\n    end\r\nend\r\n\r\n--Creates submit and cancel buttons\r\nfunction createSetupActionButtons(move)\r\n    self.createButton({\r\n       label=\"Annuler\", click_function=\"buttonClick_cancel\", function_owner=self,\r\n       position={-1.15,0.3,2.1}, rotation={0,0,0}, height=350, width=1100,\r\n       font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n\r\n    self.createButton({\r\n      label=\"Valider\", click_function=\"buttonClick_submit\", function_owner=self,\r\n      position={-1.15,0.3,2.8}, rotation={0,0,0}, height=350, width=1100,\r\n      font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n\r\n    if move == false then\r\n      self.createButton({\r\n          label=\"Ajouter\", click_function=\"buttonClick_add\", function_owner=self,\r\n          position={1.15,0.3,2.1}, rotation={0,0,0}, height=350, width=1100,\r\n          font_size=250, color={0,0,0}, font_color={0.25,1,0.25}\r\n        })\r\n\r\n        self.createButton({\r\n            label=\"Sélection\", click_function=\"editDragSelection\", function_owner=self,\r\n            position={-1.15,0.3,3.5}, rotation={0,0,0}, height=350, width=1100,\r\n            font_size=250, color={0,0,0}, font_color={1,1,1}\r\n        })\r\n\r\n        if fresh == false then\r\n            self.createButton({\r\n                label=\"Mise à Jour\", click_function=\"buttonClick_setNew\", function_owner=self,\r\n                position={1.15,0.3,3.5}, rotation={0,0,0}, height=350, width=1100,\r\n                font_size=180, color={0,0,0}, font_color={0.75,0.75,1}\r\n            })\r\n            self.createButton({\r\n                label=\"Retirer\", click_function=\"buttonClick_remove\", function_owner=self,\r\n                position={1.15,0.3,2.8}, rotation={0,0,0}, height=350, width=1100,\r\n                font_size=250, color={0,0,0}, font_color={1,0.25,0.25}\r\n            })\r\n        end\r\n    end\r\n\r\n    self.createButton({\r\n        label=\"Reset\", click_function=\"buttonClick_reset\", function_owner=self,\r\n        position={0,0.3,-2}, rotation={0,0,0}, height=350, width=800,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\nend\r\n\r\n\r\n--During Setup\r\n\r\n\r\n--Checks or unchecks buttons\r\nfunction buttonClick_selection(obj, move)\r\n    local index = buttonIndexMap[obj.getGUID()]\r\n    local colorMove = {0,0,1,0.6}\r\n    local color = {0,1,0,0.6}\r\n\r\n    previousGuid = selectedGuid\r\n    selectedGuid = obj.getGUID()\r\n\r\n    theList = memoryList\r\n    if move == true then\r\n        theList = moveList\r\n        if previousGuid ~= nil and previousGuid ~= selectedGuid then\r\n            local prevObj = getObjectFromGUID(previousGuid)\r\n            prevObj.highlightOff()\r\n            self.editButton({index=previousIndex, color=colorMove})\r\n            theList[previousGuid] = nil\r\n        end\r\n        previousIndex = index\r\n    end\r\n\r\n    if theList[selectedGuid] == nil then\r\n        self.editButton({index=index, color=color})\r\n        --Adding pos/rot to memory table\r\n        local pos, rot = obj.getPosition(), obj.getRotation()\r\n        --I need to add it like this or it won't save due to indexing issue\r\n        theList[obj.getGUID()] = {\r\n            pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n            rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n            lock=obj.getLock(),\r\n            tint=obj.getColorTint()\r\n        }\r\n        obj.highlightOn({0,1,0})\r\n    else\r\n        color = {0.75,0.25,0.25,0.6}\r\n        if move == true then\r\n            color = colorMove\r\n        end\r\n        self.editButton({index=index, color=color})\r\n        theList[obj.getGUID()] = nil\r\n        obj.highlightOff()\r\n    end\r\nend\r\n\r\nfunction editDragSelection(bagObj, player, remove)\r\n    local selectedObjs = Player[player].getSelectedObjects()\r\n    if not remove then\r\n        for _, obj in ipairs(selectedObjs) do\r\n            local index = buttonIndexMap[obj.getGUID()]\r\n            --Ignore if already in the memory list, or does not have a button\r\n            if index and not memoryList[obj.getGUID()] then\r\n                self.editButton({index=index, color={0,1,0,0.6}})\r\n                --Adding pos/rot to memory table\r\n                local pos, rot = obj.getPosition(), obj.getRotation()\r\n                --I need to add it like this or it won't save due to indexing issue\r\n                memoryList[obj.getGUID()] = {\r\n                    pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n                    rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n                    lock=obj.getLock(),\r\n                    tint=obj.getColorTint()\r\n                }\r\n                obj.highlightOn({0,1,0})\r\n            end\r\n        end\r\n    else\r\n        for _, obj in ipairs(selectedObjs) do\r\n            local index = buttonIndexMap[obj.getGUID()]\r\n            if index and memoryList[obj.getGUID()] then\r\n                color = {0.75,0.25,0.25,0.6}\r\n                self.editButton({index=index, color=color})\r\n                memoryList[obj.getGUID()] = nil\r\n                obj.highlightOff()\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\n--Cancels selection process\r\nfunction buttonClick_cancel()\r\n    memoryList = memoryListBackup\r\n    moveList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    if next(memoryList) == nil then\r\n        createSetupButton()\r\n    else\r\n        createMemoryActionButtons()\r\n    end\r\n    removeAllHighlights()\r\n    broadcastToAll(\"Sélection annulée\", {1,1,1})\r\n    moveGuid = nil\r\nend\r\n\r\n--Saves selections\r\nfunction buttonClick_submit()\r\n    fresh = false\r\n    if next(moveList) ~= nil then\r\n        for guid in pairs(moveList) do\r\n            moveGuid = guid\r\n        end\r\n        if memoryListBackup[moveGuid] == nil then\r\n            broadcastToAll(\"Item selected for moving is not already in memory\", {1, 0.25, 0.25})\r\n        else\r\n            broadcastToAll(\"Moving all items in memory relative to new objects position!\", {0.75, 0.75, 1})\r\n            self.clearButtons()\r\n            self.clearInputs()\r\n            createMemoryActionButtons()\r\n            local count = 0\r\n            for guid in pairs(moveList) do\r\n                moveGuid = guid\r\n                count = count + 1\r\n                local obj = getObjectFromGUID(guid)\r\n                if obj ~= nil then obj.highlightOff() end\r\n            end\r\n            updateMemoryWithMoves()\r\n            updateSave()\r\n            buttonClick_place()\r\n        end\r\n    elseif next(memoryList) == nil and moveGuid == nil then\r\n        memoryList = memoryListBackup\r\n        broadcastToAll(\"No selections made.\", {0.75, 0.25, 0.25})\r\n    end\r\n    combineMemoryFromBagsWithin()\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    updateSave()\r\n    moveGuid = nil\r\nend\r\n\r\nfunction combineTables(first_table, second_table)\r\n    for k,v in pairs(second_table) do first_table[k] = v end\r\nend\r\n\r\nfunction buttonClick_add()\r\n    fresh = false\r\n    combineTables(memoryList, memoryListBackup)\r\n    broadcastToAll(\"Adding internal bags and selections to existing memory\", {0.25, 0.75, 0.25})\r\n    combineMemoryFromBagsWithin()\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    updateSave()\r\nend\r\n\r\nfunction buttonClick_remove()\r\n    broadcastToAll(\"Removing Selected Entries From Memory\", {1.0, 0.25, 0.25})\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        memoryListBackup[guid] = nil\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Removed\", {1,1,1})\r\n    memoryList = memoryListBackup\r\n    updateSave()\r\nend\r\n\r\nfunction buttonClick_setNew()\r\n    broadcastToAll(\"Setting new position relative to items in memory\", {0.75, 0.75, 1})\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        guid = obj.guid\r\n        if memoryListBackup[guid] ~= nil then\r\n            count = count + 1\r\n            memoryListBackup[guid].pos = obj.getPosition()\r\n            memoryListBackup[guid].rot = obj.getRotation()\r\n            memoryListBackup[guid].lock = obj.getLock()\r\n            memoryListBackup[guid].tint = obj.getColorTint()\r\n        end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    memoryList = memoryListBackup\r\n    updateSave()\r\nend\r\n\r\n--Resets bag to starting status\r\nfunction buttonClick_reset()\r\n    fresh = true\r\n    memoryList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createSetupButton()\r\n    removeAllHighlights()\r\n    broadcastToAll(\"Tool Reset\", {1,1,1})\r\n    updateSave()\r\nend\r\n\r\n\r\n--After Setup\r\n\r\n\r\n--Creates recall and place buttons\r\nfunction createMemoryActionButtons()\r\n    self.createButton({\r\n        label=\"Placer\", click_function=\"buttonClick_place\", function_owner=self,\r\n        position={0,0.3,2}, rotation={0,0,0}, height=350, width=1000,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    self.createButton({\r\n        label=\"Ranger\", click_function=\"buttonClick_recall\", function_owner=self,\r\n        position={0,0.3,2.8}, rotation={0,0,0}, height=350, width=1000,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    self.createButton({\r\n        label=\"Config\", click_function=\"buttonClick_setup\", function_owner=self,\r\n        position={2,0.3,0}, rotation={0,90,0}, height=350, width=800,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    ---    self.createButton({\r\n    ---      label=\"Bouger\", click_function=\"buttonClick_transpose\", function_owner=self,\r\n    ---      position={-2,0.3,0.8}, rotation={0,270,0}, height=350, width=800,\r\n    ---      font_size=250, color={0,0,0}, font_color={0.75,0.75,1}\r\n    ---  \r\nend\r\n\r\n--Sends objects from bag/table to their saved position/rotation\r\nfunction buttonClick_place()\r\n    local bagObjList = self.getObjects()\r\n    for guid, entry in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        --If obj is out on the table, move it to the saved pos/rot\r\n        if obj ~= nil then\r\n            obj.setPositionSmooth(entry.pos)\r\n            obj.setRotationSmooth(entry.rot)\r\n            obj.setLock(entry.lock)\r\n            obj.setColorTint(entry.tint)\r\n        else\r\n            --If obj is inside of the bag\r\n            for _, bagObj in ipairs(bagObjList) do\r\n                if bagObj.guid == guid then\r\n                    local item = self.takeObject({\r\n                        guid=guid, position=entry.pos, rotation=entry.rot, smooth=false\r\n                    })\r\n                    item.setLock(entry.lock)\r\n                    item.setColorTint(entry.tint)\r\n                    break\r\n                end\r\n            end\r\n        end\r\n    end\r\n    broadcastToAll(\"Objets placés\", {1,1,1})\r\nend\r\n\r\n--Recalls objects to bag from table\r\nfunction buttonClick_recall()\r\n    for guid, entry in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then self.putObject(obj) end\r\n    end\r\n    broadcastToAll(\"Objets rangés\", {1,1,1})\r\nend\r\n\r\n\r\n--Utility functions\r\n\r\n\r\n--Find delta (difference) between 2 x/y/z coordinates\r\nfunction findOffsetDistance(p1, p2, obj)\r\n    local yOffset = 0\r\n    if obj ~= nil then\r\n        local bounds = obj.getBounds()\r\n        yOffset = (bounds.size.y - bounds.offset.y)\r\n    end\r\n    local deltaPos = {}\r\n    deltaPos.x = (p2.x-p1.x)\r\n    deltaPos.y = (p2.y-p1.y) + yOffset\r\n    deltaPos.z = (p2.z-p1.z)\r\n    return deltaPos\r\nend\r\n\r\n--Used to rotate a set of coordinates by an angle\r\nfunction rotateLocalCoordinates(desiredPos, obj)\r\n    local objPos, objRot = obj.getPosition(), obj.getRotation()\r\n    local angle = math.rad(objRot.y)\r\n    local x = desiredPos.x * math.cos(angle) - desiredPos.z * math.sin(angle)\r\n    local z = desiredPos.x * math.sin(angle) + desiredPos.z * math.cos(angle)\r\n    --return {x=objPos.x+x, y=objPos.y+desiredPos.y, z=objPos.z+z}\r\n    return {x=x, y=desiredPos.y, z=z}\r\nend\r\n\r\nfunction rotateMyCoordinates(desiredPos, obj)\r\n    local angle = math.rad(obj.getRotation().y)\r\n    local x = desiredPos.x * math.sin(angle)\r\n    local z = desiredPos.z * math.cos(angle)\r\n    return {x=x, y=desiredPos.y, z=z}\r\nend\r\n\r\n--Coroutine delay, in seconds\r\nfunction wait(time)\r\n    local start = os.time()\r\n    repeat coroutine.yield(0) until os.time() > start + time\r\nend\r\n\r\n--Duplicates a table (needed to prevent it making reference to the same objects)\r\nfunction duplicateTable(oldTable)\r\n    local newTable = {}\r\n    for k, v in pairs(oldTable) do\r\n        newTable[k] = v\r\n    end\r\n    return newTable\r\nend\r\n\r\n--Moves scripted highlight from all objects\r\nfunction removeAllHighlights()\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        obj.highlightOff()\r\n    end\r\nend\r\n\r\n--Round number (num) to the Nth decimal (dec)\r\nfunction round(num, dec)\r\n    local mult = 10^(dec or 0)\r\n    return math.floor(num * mult + 0.5) / mult\r\nend\r\n\r\n\r\n--[[\r\nThis object provides access to a variable stored on the \"Global script\".\r\nThe variable holds the GUIDs for every Utility Memory Bag in the scene.\r\nExample:\r\n{'805ebd', '35cc21', 'fc8886', 'f50264', '5f5f63'}\r\n--]]\r\nAllMemoryBagsInScene = {\r\n    NAME_OF_GLOBAL_VARIABLE = \"_UtilityMemoryBag_AllMemoryBagsInScene\"\r\n}\r\n\r\nfunction AllMemoryBagsInScene:add(guid)\r\n    local guids = Global.getTable(self.NAME_OF_GLOBAL_VARIABLE) or {}\r\n    table.insert(guids, guid)\r\n    Global.setTable(self.NAME_OF_GLOBAL_VARIABLE, guids)\r\nend\r\n\r\nfunction AllMemoryBagsInScene:getGuidList()\r\n    return Global.getTable(self.NAME_OF_GLOBAL_VARIABLE) or {}\r\nend","LuaScriptState":"{\"ml\":{\"098203\":{\"lock\":false,\"pos\":{\"x\":17.5,\"y\":1.5419,\"z\":-5.9999},\"rot\":{\"x\":-0.0001,\"y\":90.0013,\"z\":0},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"d03c7b\":{\"lock\":false,\"pos\":{\"x\":35,\"y\":1.558,\"z\":1.5},\"rot\":{\"x\":0.0011,\"y\":90,\"z\":0.0006},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"f2a81d\":{\"lock\":false,\"pos\":{\"x\":17.501,\"y\":1.536,\"z\":-6.0196},\"rot\":{\"x\":0.0049,\"y\":89.981,\"z\":359.9891},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}}}}","XmlUI":"","ContainedObjects":[{"GUID":"d03c7b","Name":"Card","Transform":{"posX":35,"posY":1.55799925,"posZ":1.5,"rotX":0.00107026647,"rotY":89.99999,"rotZ":0.000591058866,"scaleX":1.64563763,"scaleY":1,"scaleZ":1.64563763},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"health\": -2,\n  \"id\": \"85037\",\n  \"traits\": \"Monster. Ooze. Elite.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306708,"SidewaysCard":true,"CustomDeck":{"3067":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"f2a81d","Name":"Deck","Transform":{"posX":17.5009975,"posY":1.53599644,"posZ":-6.019596,"rotX":0.00494422857,"rotY":89.98107,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Deck acte multi épique","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":true,"DeckIDs":[306806,306305,306803],"CustomDeck":{"3063":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0},"3068":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"257474","Name":"Card","Transform":{"posX":-22.4999447,"posY":5.056076,"posZ":24,"rotX":-1.12681811e-7,"rotY":89.9809341,"rotZ":0.000005068586,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85008\",\n  \"type\": \"Act\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306806,"SidewaysCard":true,"CustomDeck":{"3068":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"2b6d03","Name":"Card","Transform":{"posX":-22.4999447,"posY":4.856076,"posZ":24,"rotX":-1.12681811e-7,"rotY":89.9809341,"rotZ":0.000005068586,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85007\",\n  \"type\": \"Act\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306305,"SidewaysCard":true,"CustomDeck":{"3063":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"9d202a","Name":"Card","Transform":{"posX":-22.4999447,"posY":1.877318,"posZ":24,"rotX":0.00288808835,"rotY":89.9809341,"rotZ":-0.00352937938,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85005\",\n  \"type\": \"Act\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306803,"SidewaysCard":true,"CustomDeck":{"3068":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]}]},{"GUID":"0ae88f","Name":"CardCustom","Transform":{"posX":5.99999857,"posY":1.516081,"posZ":-1.49999654,"rotX":0.0108917616,"rotY":179.997864,"rotZ":0.004947803,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"2b78cf","Name":"Custom_Tile","Transform":{"posX":5.99999857,"posY":1.50314164,"posZ":1.99999988,"rotX":0.0108923446,"rotY":179.991547,"rotZ":0.004950594,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"2c8d02","Name":"Card","Transform":{"posX":-26.4365139,"posY":1.828905,"posZ":2.97432756,"rotX":0.000007979345,"rotY":180.4172,"rotZ":-0.000012484109,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 7,\n  \"id\": \"85042\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306419,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"2cf647","Name":"Custom_Model_Bag","Transform":{"posX":-21,"posY":1.8353,"posZ":13.5,"rotX":0,"rotY":179.9966,"rotZ":0,"scaleX":0.7,"scaleY":0.7,"scaleZ":0.7},"Nickname":"bag coin aléatoire","Description":"merci à Chr1Z pour le script","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.614982545,"g":0,"b":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"MaterialIndex":-1,"MeshIndex":-1,"CustomMesh":{"MeshURL":"https://pastebin.com/raw/ALrYhQGb","DiffuseURL":"http://cloud-3.steamusercontent.com/ugc/1932636510528824496/84176351C810CF0B7BDD482E417BDD15456AF83E/","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":3,"TypeIndex":6,"CustomShader":{"SpecularColor":{"r":1,"g":1,"b":1},"SpecularIntensity":0,"SpecularSharpness":2,"FresnelStrength":0},"CastShadows":true},"Bag":{"Order":0},"LuaScript":"-- Random memory bag\r\n-- based on Utility memory bag by Directsun (Version 2.7.0)\r\n\r\nlocal CONFIG = {\r\n    MEMORY_GROUP = {\r\n        -- This determines how many frames to wait before actually placing objects onto the table when the \"Place\" button is clicked.\r\n        -- This gives the other bags time to recall their objects.\r\n        -- The delay ONLY occurs if other bags have objects out.\r\n        FRAME_DELAY_BEFORE_PLACING_OBJECTS = 30\r\n    }\r\n}\r\n\r\nmath.randomseed(os.time())\r\n\r\n--[[ Memory Bag Groups ]]\r\n--[[ Utility Memory Bags may be added to a named group, called a \"memory group\".\r\nYou can add a bag to a group through the bag's UI: \"Setup\" > \"Group Name\" (to the left of the bag).\r\nOnly one bag from a group may have it's contents placed on the table at a time.\r\nWhen \"Place\" is clicked on a bag, the other bags in it's memory group are recalled.\r\nBy default a memory bag is not in any group. It's memory group is \"nil\". --]]\r\n\r\nmemoryGroupName = { memoryBag = self }\r\nfunction memoryGroupName:get()\r\n    return self._name\r\nend\r\n\r\nfunction memoryGroupName:set(newName)\r\n    GlobalMemoryGroups:unregisterBagInGroup(self:get(), self.memoryBag.getGUID())\r\n    GlobalMemoryGroups:registerBagInGroup(newName, self.memoryBag.getGUID())\r\n\r\n    if newName == \"\" then\r\n        self._name = nil\r\n    else\r\n        self._name = newName\r\n    end\r\nend\r\n\r\n-- Click the \"Recall\" button on all other bags in my memory group.\r\nfunction recallOtherBagsInMyGroup()\r\n    for _, bag in ipairs(getOtherBagsInMyGroup()) do\r\n        bag.call('buttonClick_recall')\r\n    end\r\nend\r\n\r\n-- Return \"true\" if another bag in my memory group has any objects out on the table.\r\nfunction anyOtherBagsInMyGroupArePlaced()\r\n    for _, bag in ipairs(getOtherBagsInMyGroup()) do\r\n        local state = bag.call('areAnyOfMyObjectsPlaced')\r\n        if state then return true end\r\n    end\r\n\r\n    return false\r\nend\r\n\r\n-- Return \"true\" if at least one object from this memory bag is out on the table.\r\nfunction areAnyOfMyObjectsPlaced()\r\n    for guid, _ in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then\r\n            return true\r\n        end\r\n    end\r\n    return false\r\nend\r\n\r\nfunction getOtherBagsInMyGroup()\r\n    local bags = {}\r\n    for bagGuid, _ in pairs(GlobalMemoryGroups:getGroup(memoryGroupName:get())) do\r\n        if bagGuid ~= self.getGUID() then\r\n            bag = getObjectFromGUID(bagGuid)\r\n            -- \"bag\" is nill if it has been deleted since the last time onLoad() was called.\r\n            if bag ~= nil then\r\n                table.insert(bags, bag)\r\n            end\r\n        end\r\n    end\r\n    return bags\r\nend\r\n\r\n--[[\r\nThis object provides access to a variable stored on the \"Global script\".\r\nThe variable holds the names & guids of all memory bag groups.\r\nThe global variable is a table and holds data like this:\r\n{\r\n    'My First Group Name' = {\r\n        '805ebd' = {},\r\n        '35cc21' = {},\r\n        'fc8886' = {},\r\n    },\r\n    'My Second Group Name' = {\r\n        'f50264' = {},\r\n        '5f5f63' = {},\r\n    },\r\n}\r\n--]]\r\nGlobalMemoryGroups = { NAME_OF_GLOBAL_VARIABLE = '_GlobalUtilityMemoryBagGroups' }\r\n\r\n-- Call me inside this script's \"onLoad()\" method!\r\nfunction GlobalMemoryGroups:onLoad(myGuid)\r\n    -- Create and initialize the global variable if it doesn't already exist:\r\n    if self:_getGroups() == nil then\r\n        self:_setGroups({})\r\n    end\r\nend\r\n\r\n-- Return the GUIDs of all bags in the \"groupName\". The return value is a dictionary that maps [GUID -> empty table].\r\nfunction GlobalMemoryGroups:getGroup(groupName)\r\n    guids = self:_getGroups()[groupName] or {}\r\n    return guids\r\nend\r\n\r\n-- Registers a bag in a memory group. Creates a new group if one doesn't exist.\r\nfunction GlobalMemoryGroups:registerBagInGroup(groupName, bagGuid)\r\n    if groupName == nil or groupName == \"\" then\r\n        return\r\n    end\r\n\r\n    self:_tryCreateNewGroup(groupName)\r\n    local groups = self:_getGroups()\r\n    groups[groupName][bagGuid] = {}\r\n    self:_setGroups(groups)\r\nend\r\n\r\n-- Removes this bag from the memory group.\r\nfunction GlobalMemoryGroups:unregisterBagInGroup(groupName, bagGuid)\r\n    local groups = self:_getGroups()\r\n    local group = groups[groupName]\r\n    if group ~= nil then\r\n        group[bagGuid] = nil\r\n        self:_setGroups(groups)\r\n    end\r\nend\r\n\r\n-- Return the global variable, which is a table holding all memory group names & guids.\r\nfunction GlobalMemoryGroups:_getGroups()\r\n    return Global.getTable(self.NAME_OF_GLOBAL_VARIABLE)\r\nend\r\n\r\n-- Override the global variable (i.e. the entire table).\r\nfunction GlobalMemoryGroups:_setGroups(newTable)\r\n    Global.setTable(self.NAME_OF_GLOBAL_VARIABLE, newTable)\r\nend\r\n\r\n-- Add a new memory group named \"groupName\" to the global variable, if one doesn't already exist.\r\nfunction GlobalMemoryGroups:_tryCreateNewGroup(groupName)\r\n    local groups = self:_getGroups()\r\n    if groups[groupName] == nil then\r\n        groups[groupName] = {}\r\n        self:_setGroups(groups)\r\n    end\r\nend\r\n\r\n-- This object controls the \"Group Name\" input text field that is part of the bag's ingame UI.\r\ngroupNameInput = {\r\n    greyedOutText     = \"Group Name\",\r\n    widthPerCharacter = 100,\r\n    padding           = 4,\r\n    memoryBag         = self\r\n}\r\nfunction groupNameInput:create(optionalStartingValue)\r\n    local effectiveText = optionalStartingValue or self.greyedOutText\r\n    local width = self:computeWidth(effectiveText)\r\n\r\n    self.memoryBag.createInput({\r\n        label = self.greyedOutText,\r\n        value = optionalStartingValue or nil,\r\n        alignment = 3, -- Center aligned\r\n        input_function = \"groupNameInput_onCharacterTyped\", function_owner = self.memoryBag,\r\n        position = { 2.1, 0.3, 0 }, rotation = { 0, 270, 0 }, width = width, height = 350,\r\n        font_size = 250, color = { 0, 0, 0 }, font_color = { 1, 1, 1 },\r\n    })\r\nend\r\n\r\nfunction groupNameInput:computeWidth(text)\r\n    return (string.len(text) + self.padding) * self.widthPerCharacter\r\nend\r\n\r\nfunction groupNameInput:updatedWidth(text)\r\n    self.memoryBag.editInput({\r\n        index = 0,\r\n        width = self:computeWidth(text)\r\n    })\r\nend\r\n\r\nfunction groupNameInput:onCharacterTyped(text, stillEditing)\r\n    if stillEditing then\r\n        self:updatedWidth(text)\r\n    else\r\n        if text == \"\" then\r\n            self:updatedWidth(self.greyedOutText)\r\n        end\r\n    end\r\nend\r\n\r\nfunction groupNameInput_onCharacterTyped(memoryBag, playerColor, text, stillEditing)\r\n    groupNameInput:onCharacterTyped(text, stillEditing)\r\nend\r\n\r\nfunction groupNameInput:setGroupNameToInputField()\r\n    local inputFields = self.memoryBag.getInputs()\r\n    if inputFields ~= nil then\r\n        -- Get input field 0, which corresponds to the groupNameInput.\r\n        -- Unfortunately \"self.getInputs()\" doesn't return the inputs in a guaranteed order.\r\n        local nameField = nil\r\n        for _, field in ipairs(inputFields) do\r\n            if field.index == 0 then\r\n                nameField = field\r\n            end\r\n        end\r\n\r\n        memoryGroupName:set(nameField.value)\r\n    end\r\nend\r\n\r\nfunction updateSave()\r\n    local data_to_save = { [\"ml\"] = memoryList, [\"groupName\"] = memoryGroupName:get() }\r\n    saved_data = JSON.encode(data_to_save)\r\n    self.script_state = saved_data\r\nend\r\n\r\nfunction combineMemoryFromBagsWithin()\r\n    local bagObjList = self.getObjects()\r\n    for _, bagObj in ipairs(bagObjList) do\r\n        local data = bagObj.lua_script_state\r\n        if data ~= nil then\r\n            local j = JSON.decode(data)\r\n            if j ~= nil and j.ml ~= nil then\r\n                for guid, entry in pairs(j.ml) do\r\n                    memoryList[guid] = entry\r\n                end\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\nfunction updateMemoryWithMoves()\r\n    memoryList = memoryListBackup\r\n    --get the first transposed object's coordinates\r\n    local obj = getObjectFromGUID(moveGuid)\r\n\r\n    -- p1 is where needs to go, p2 is where it was\r\n    local refObjPos = memoryList[moveGuid].pos\r\n    local deltaPos = findOffsetDistance(obj.getPosition(), refObjPos, nil)\r\n    local movedRotation = obj.getRotation()\r\n    for guid, entry in pairs(memoryList) do\r\n        memoryList[guid].pos.x = entry.pos.x - deltaPos.x\r\n        memoryList[guid].pos.y = entry.pos.y - deltaPos.y\r\n        memoryList[guid].pos.z = entry.pos.z - deltaPos.z\r\n    end\r\n    moveList = {}\r\nend\r\n\r\nfunction onload(saved_data)\r\n    GlobalMemoryGroups:onLoad(self.getGUID())\r\n    AllMemoryBagsInScene:add(self.getGUID())\r\n\r\n    fresh = true\r\n    if saved_data ~= \"\" then\r\n        local loaded_data = JSON.decode(saved_data)\r\n        --Set up information off of loaded_data\r\n        memoryList = loaded_data.ml\r\n        memoryGroupName:set(loaded_data.groupName)\r\n    else\r\n        --Set up information for if there is no saved saved data\r\n        memoryList = {}\r\n        memoryGroupName:set(nil)\r\n    end\r\n\r\n    moveList = {}\r\n    moveGuid = nil\r\n\r\n    if next(memoryList) == nil then\r\n        createSetupButton()\r\n    else\r\n        fresh = false\r\n        createMemoryActionButtons()\r\n    end\r\nend\r\n\r\n--Beginning Setup\r\n\r\n--Make setup button\r\nfunction createSetupButton()\r\n    self.createButton({\r\n      label=\"Config\", click_function=\"buttonClick_setup\", function_owner=self,\r\n      position={0,0.3,2}, rotation={0,0,0}, height=350, width=800,\r\n      font_size=250, color={0,0,0}, font_color={1,1,1}\r\n  })\r\nend\r\n\r\n--Triggered by Transpose button\r\nfunction buttonClick_transpose()\r\n    moveGuid = nil\r\n    broadcastToAll(\"Select one object and move it- all objects will move relative to the new location\", { 0.75, 0.75, 1 })\r\n    memoryListBackup = duplicateTable(memoryList)\r\n    memoryList = {}\r\n    moveList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createButtonsOnAllObjects(true)\r\n    createSetupActionButtons(true)\r\nend\r\n\r\n--Triggered by setup button,\r\nfunction buttonClick_setup()\r\n    memoryListBackup = duplicateTable(memoryList)\r\n    memoryList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createButtonsOnAllObjects(false)\r\n    createSetupActionButtons(false)\r\nend\r\n\r\nfunction getAllObjectsInMemory()\r\n    local objTable = {}\r\n    local curObj = {}\r\n\r\n    for guid in pairs(memoryListBackup) do\r\n        curObj = getObjectFromGUID(guid)\r\n        table.insert(objTable, curObj)\r\n    end\r\n\r\n    return objTable\r\nend\r\n\r\n--Creates selection buttons on objects\r\nfunction createButtonsOnAllObjects(move)\r\n    buttonIndexMap = {}\r\n    local howManyButtons = 0\r\n\r\n    local objsToHaveButtons = {}\r\n    if move == true then\r\n        objsToHaveButtons = getAllObjectsInMemory()\r\n    else\r\n        objsToHaveButtons = getAllObjects()\r\n    end\r\n\r\n    for _, obj in ipairs(objsToHaveButtons) do\r\n        if obj ~= self then\r\n            --On a normal bag, the button positions aren't the same size as the bag.\r\n            globalScaleFactor = 1 * 1 / self.getScale().x\r\n            --Super sweet math to set button positions\r\n            local selfPos = self.getPosition()\r\n            local objPos = obj.getPosition()\r\n            local deltaPos = findOffsetDistance(selfPos, objPos, obj)\r\n            local objPos = rotateLocalCoordinates(deltaPos, self)\r\n            objPos.x = -objPos.x * globalScaleFactor\r\n            objPos.y = objPos.y * globalScaleFactor + 2\r\n            objPos.z = objPos.z * globalScaleFactor\r\n            --Workaround for custom PDFs\r\n            if obj.Book then\r\n                objPos.y = objPos.y + 0.5\r\n            end\r\n            --Offset rotation of bag\r\n            local rot = self.getRotation()\r\n            rot.y = -rot.y + 180\r\n            --Create function\r\n            local funcName = \"selectButton_\" .. howManyButtons\r\n            local func = function() buttonClick_selection(obj, move) end\r\n            local color = { 0.75, 0.25, 0.25, 0.6 }\r\n            local colorMove = { 0, 0, 1, 0.6 }\r\n            if move == true then\r\n                color = colorMove\r\n            end\r\n            self.setVar(funcName, func)\r\n            self.createButton({\r\n                click_function = funcName, function_owner = self,\r\n                position = objPos, rotation = rot, height = 1000, width = 1000,\r\n                color = color,\r\n            })\r\n            buttonIndexMap[obj.getGUID()] = howManyButtons\r\n            howManyButtons = howManyButtons + 1\r\n        end\r\n    end\r\nend\r\n\r\n  --Creates submit and cancel buttons\r\n  function createSetupActionButtons(move)\r\n      self.createButton({\r\n         label=\"Annuler\", click_function=\"buttonClick_cancel\", function_owner=self,\r\n         position={-1.15,0.3,2.1}, rotation={0,0,0}, height=350, width=1100,\r\n         font_size=250, color={0,0,0}, font_color={1,1,1}\r\n      })\r\n\r\n      self.createButton({\r\n        label=\"Valider\", click_function=\"buttonClick_submit\", function_owner=self,\r\n        position={-1.15,0.3,2.8}, rotation={0,0,0}, height=350, width=1100,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n      })\r\n\r\n      if move == false then\r\n        self.createButton({\r\n            label=\"Ajouter\", click_function=\"buttonClick_add\", function_owner=self,\r\n            position={1.15,0.3,2.1}, rotation={0,0,0}, height=350, width=1100,\r\n            font_size=250, color={0,0,0}, font_color={0.25,1,0.25}\r\n          })\r\n\r\n          self.createButton({\r\n              label=\"Sélection\", click_function=\"editDragSelection\", function_owner=self,\r\n              position={-1.15,0.3,3.5}, rotation={0,0,0}, height=350, width=1100,\r\n              font_size=250, color={0,0,0}, font_color={1,1,1}\r\n          })\r\n\r\n          if fresh == false then\r\n              self.createButton({\r\n                  label=\"Mise à Jour\", click_function=\"buttonClick_setNew\", function_owner=self,\r\n                  position={1.15,0.3,3.5}, rotation={0,0,0}, height=350, width=1100,\r\n                  font_size=180, color={0,0,0}, font_color={0.75,0.75,1}\r\n              })\r\n              self.createButton({\r\n                  label=\"Retirer\", click_function=\"buttonClick_remove\", function_owner=self,\r\n                  position={1.15,0.3,2.8}, rotation={0,0,0}, height=350, width=1100,\r\n                  font_size=250, color={0,0,0}, font_color={1,0.25,0.25}\r\n              })\r\n          end\r\n      end\r\n\r\n      self.createButton({\r\n          label=\"Reset\", click_function=\"buttonClick_reset\", function_owner=self,\r\n          position={0,0.3,-2}, rotation={0,0,0}, height=350, width=800,\r\n          font_size=250, color={0,0,0}, font_color={1,1,1}\r\n      })\r\n  end\r\n\r\n\r\n--During Setup\r\n\r\n--Checks or unchecks buttons\r\nfunction buttonClick_selection(obj, move)\r\n    local index = buttonIndexMap[obj.getGUID()]\r\n    local colorMove = { 0, 0, 1, 0.6 }\r\n    local color = { 0, 1, 0, 0.6 }\r\n\r\n    previousGuid = selectedGuid\r\n    selectedGuid = obj.getGUID()\r\n\r\n    theList = memoryList\r\n    if move == true then\r\n        theList = moveList\r\n        if previousGuid ~= nil and previousGuid ~= selectedGuid then\r\n            local prevObj = getObjectFromGUID(previousGuid)\r\n            prevObj.highlightOff()\r\n            self.editButton({ index = previousIndex, color = colorMove })\r\n            theList[previousGuid] = nil\r\n        end\r\n        previousIndex = index\r\n    end\r\n\r\n    if theList[selectedGuid] == nil then\r\n        self.editButton({ index = index, color = color })\r\n        --Adding pos/rot to memory table\r\n        local pos, rot = obj.getPosition(), obj.getRotation()\r\n        --I need to add it like this or it won't save due to indexing issue\r\n        theList[obj.getGUID()] = {\r\n            pos = { x = round(pos.x, 4), y = round(pos.y, 4), z = round(pos.z, 4) },\r\n            rot = { x = round(rot.x, 4), y = round(rot.y, 4), z = round(rot.z, 4) },\r\n            lock = obj.getLock(),\r\n            tint = obj.getColorTint()\r\n        }\r\n        obj.highlightOn({ 0, 1, 0 })\r\n    else\r\n        color = { 0.75, 0.25, 0.25, 0.6 }\r\n        if move == true then\r\n            color = colorMove\r\n        end\r\n        self.editButton({ index = index, color = color })\r\n        theList[obj.getGUID()] = nil\r\n        obj.highlightOff()\r\n    end\r\nend\r\n\r\nfunction editDragSelection(bagObj, player, remove)\r\n    local selectedObjs = Player[player].getSelectedObjects()\r\n    if not remove then\r\n        for _, obj in ipairs(selectedObjs) do\r\n            local index = buttonIndexMap[obj.getGUID()]\r\n            --Ignore if already in the memory list, or does not have a button\r\n            if index and not memoryList[obj.getGUID()] then\r\n                self.editButton({ index = index, color = { 0, 1, 0, 0.6 } })\r\n                --Adding pos/rot to memory table\r\n                local pos, rot = obj.getPosition(), obj.getRotation()\r\n                --I need to add it like this or it won't save due to indexing issue\r\n                memoryList[obj.getGUID()] = {\r\n                    pos = { x = round(pos.x, 4), y = round(pos.y, 4), z = round(pos.z, 4) },\r\n                    rot = { x = round(rot.x, 4), y = round(rot.y, 4), z = round(rot.z, 4) },\r\n                    lock = obj.getLock(),\r\n                    tint = obj.getColorTint()\r\n                }\r\n                obj.highlightOn({ 0, 1, 0 })\r\n            end\r\n        end\r\n    else\r\n        for _, obj in ipairs(selectedObjs) do\r\n            local index = buttonIndexMap[obj.getGUID()]\r\n            if index and memoryList[obj.getGUID()] then\r\n                color = { 0.75, 0.25, 0.25, 0.6 }\r\n                self.editButton({ index = index, color = color })\r\n                memoryList[obj.getGUID()] = nil\r\n                obj.highlightOff()\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\n--Cancels selection process\r\nfunction buttonClick_cancel()\r\n    memoryList = memoryListBackup\r\n    moveList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    if next(memoryList) == nil then\r\n        createSetupButton()\r\n    else\r\n        createMemoryActionButtons()\r\n    end\r\n    removeAllHighlights()\r\n    broadcastToAll(\"Sélection annulée\", { 1, 1, 1 })\r\n    moveGuid = nil\r\nend\r\n\r\n--Saves selections\r\nfunction buttonClick_submit()\r\n    fresh = false\r\n    if next(moveList) ~= nil then\r\n        for guid in pairs(moveList) do\r\n            moveGuid = guid\r\n        end\r\n        if memoryListBackup[moveGuid] == nil then\r\n            broadcastToAll(\"Item selected for moving is not already in memory\", { 1, 0.25, 0.25 })\r\n        else\r\n            broadcastToAll(\"Moving all items in memory relative to new objects position!\", { 0.75, 0.75, 1 })\r\n            self.clearButtons()\r\n            self.clearInputs()\r\n            createMemoryActionButtons()\r\n            local count = 0\r\n            for guid in pairs(moveList) do\r\n                moveGuid = guid\r\n                count = count + 1\r\n                local obj = getObjectFromGUID(guid)\r\n                if obj ~= nil then obj.highlightOff() end\r\n            end\r\n            updateMemoryWithMoves()\r\n            updateSave()\r\n            buttonClick_place()\r\n        end\r\n    elseif next(memoryList) == nil and moveGuid == nil then\r\n        memoryList = memoryListBackup\r\n        broadcastToAll(\"No selections made.\", { 0.75, 0.25, 0.25 })\r\n    end\r\n    combineMemoryFromBagsWithin()\r\n    groupNameInput:setGroupNameToInputField()\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count .. \" Objects Saved\", { 1, 1, 1 })\r\n    updateSave()\r\n    moveGuid = nil\r\nend\r\n\r\nfunction combineTables(first_table, second_table)\r\n    for k, v in pairs(second_table) do first_table[k] = v end\r\nend\r\n\r\nfunction buttonClick_add()\r\n    fresh = false\r\n    combineTables(memoryList, memoryListBackup)\r\n    broadcastToAll(\"Adding internal bags and selections to existing memory\", { 0.25, 0.75, 0.25 })\r\n    combineMemoryFromBagsWithin()\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count .. \" Objects Saved\", { 1, 1, 1 })\r\n    updateSave()\r\nend\r\n\r\nfunction buttonClick_remove()\r\n    broadcastToAll(\"Removing Selected Entries From Memory\", { 1.0, 0.25, 0.25 })\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        memoryListBackup[guid] = nil\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count .. \" Objects Removed\", { 1, 1, 1 })\r\n    memoryList = memoryListBackup\r\n    updateSave()\r\nend\r\n\r\nfunction buttonClick_setNew()\r\n    broadcastToAll(\"Setting new position relative to items in memory\", { 0.75, 0.75, 1 })\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        guid = obj.guid\r\n        if memoryListBackup[guid] ~= nil then\r\n            count = count + 1\r\n            memoryListBackup[guid].pos = obj.getPosition()\r\n            memoryListBackup[guid].rot = obj.getRotation()\r\n            memoryListBackup[guid].lock = obj.getLock()\r\n            memoryListBackup[guid].tint = obj.getColorTint()\r\n        end\r\n    end\r\n    broadcastToAll(count .. \" Objects Saved\", { 1, 1, 1 })\r\n    memoryList = memoryListBackup\r\n    updateSave()\r\nend\r\n\r\n--Resets bag to starting status\r\nfunction buttonClick_reset()\r\n    fresh = true\r\n    memoryList = {}\r\n    memoryGroupName:set(nil)\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createSetupButton()\r\n    removeAllHighlights()\r\n    broadcastToAll(\"Tool Reset\", { 1, 1, 1 })\r\n    updateSave()\r\nend\r\n\r\n--After Setup\r\n\r\n--Creates recall and place buttons\r\nfunction createMemoryActionButtons()\r\n    self.createButton({\r\n        label=\"Placer au hasard\", click_function=\"buttonClick_place\", function_owner=self,\r\n        position={0,0.3,2}, rotation={0,0,0}, height=350, width=2000,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    self.createButton({\r\n        label=\"Ranger\", click_function=\"buttonClick_recall\", function_owner=self,\r\n        position={0,0.3,2.8}, rotation={0,0,0}, height=350, width=1000,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    self.createButton({\r\n        label=\"Config\", click_function=\"buttonClick_setup\", function_owner=self,\r\n        position={2,0.3,0}, rotation={0,90,0}, height=350, width=800,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    ---    self.createButton({\r\n    ---      label=\"Bouger\", click_function=\"buttonClick_transpose\", function_owner=self,\r\n    ---      position={-2,0.3,0.8}, rotation={0,270,0}, height=350, width=800,\r\n    ---      font_size=250, color={0,0,0}, font_color={0.75,0.75,1}\r\n    ---\r\nend\r\n\r\n--Sends objects from bag/table to their saved position/rotation\r\nfunction buttonClick_place()\r\n    if anyOtherBagsInMyGroupArePlaced() then\r\n        recallOtherBagsInMyGroup()\r\n        Wait.frames(_placeObjects, CONFIG.MEMORY_GROUP.FRAME_DELAY_BEFORE_PLACING_OBJECTS)\r\n    else\r\n        _placeObjects()\r\n    end\r\nend\r\n\r\nfunction _placeObjects()\r\n    local bagObjList = self.getObjects()\r\n\r\n    -- randomize memorylist position\r\n    local positionList = {}\r\n    for guid, entry in pairs(memoryList) do\r\n        table.insert(positionList, memoryList[guid].pos)\r\n    end\r\n\r\n    for i = #positionList, 2, -1 do\r\n        local j = math.random(i)\r\n        positionList[i], positionList[j] = positionList[j], positionList[i]\r\n    end\r\n\r\n    local i = 1\r\n    for guid, entry in pairs(memoryList) do\r\n        memoryList[guid].pos = positionList[i]\r\n        i = i + 1\r\n    end\r\n\r\n    for guid, entry in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        --If obj is out on the table, move it to the saved pos/rot\r\n        if obj ~= nil then\r\n            obj.setPositionSmooth(entry.pos)\r\n            obj.setRotationSmooth(entry.rot)\r\n            obj.setLock(entry.lock)\r\n            obj.setColorTint(entry.tint)\r\n        else\r\n            --If obj is inside of the bag\r\n            for _, bagObj in ipairs(bagObjList) do\r\n                if bagObj.guid == guid then\r\n                    local item = self.takeObject({\r\n                        guid = guid, position = entry.pos, rotation = entry.rot, smooth = false\r\n                    })\r\n                    item.setLock(entry.lock)\r\n                    item.setColorTint(entry.tint)\r\n                    break\r\n                end\r\n            end\r\n        end\r\n    end\r\n    broadcastToAll(\"Objets placés au hasard\", {1,1,1})\r\nend\r\n\r\n--Recalls objects to bag from table\r\nfunction buttonClick_recall()\r\n    for guid, entry in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then self.putObject(obj) end\r\n    end\r\n    broadcastToAll(\"Objets rangés\", {1,1,1})\r\nend\r\n\r\n--Utility functions\r\n\r\n--Find delta (difference) between 2 x/y/z coordinates\r\nfunction findOffsetDistance(p1, p2, obj)\r\n    local yOffset = 0\r\n    if obj ~= nil then\r\n        local bounds = obj.getBounds()\r\n        yOffset = (bounds.size.y - bounds.offset.y)\r\n    end\r\n    local deltaPos = {}\r\n    deltaPos.x = (p2.x - p1.x)\r\n    deltaPos.y = (p2.y - p1.y) + yOffset\r\n    deltaPos.z = (p2.z - p1.z)\r\n    return deltaPos\r\nend\r\n\r\n--Used to rotate a set of coordinates by an angle\r\nfunction rotateLocalCoordinates(desiredPos, obj)\r\n    local objPos, objRot = obj.getPosition(), obj.getRotation()\r\n    local angle = math.rad(objRot.y)\r\n    local x = desiredPos.x * math.cos(angle) - desiredPos.z * math.sin(angle)\r\n    local z = desiredPos.x * math.sin(angle) + desiredPos.z * math.cos(angle)\r\n    --return {x=objPos.x+x, y=objPos.y+desiredPos.y, z=objPos.z+z}\r\n    return { x = x, y = desiredPos.y, z = z }\r\nend\r\n\r\nfunction rotateMyCoordinates(desiredPos, obj)\r\n    local angle = math.rad(obj.getRotation().y)\r\n    local x = desiredPos.x * math.sin(angle)\r\n    local z = desiredPos.z * math.cos(angle)\r\n    return { x = x, y = desiredPos.y, z = z }\r\nend\r\n\r\n--Coroutine delay, in seconds\r\nfunction wait(time)\r\n    local start = os.time()\r\n    repeat coroutine.yield(0) until os.time() > start + time\r\nend\r\n\r\n--Duplicates a table (needed to prevent it making reference to the same objects)\r\nfunction duplicateTable(oldTable)\r\n    local newTable = {}\r\n    for k, v in pairs(oldTable) do\r\n        newTable[k] = v\r\n    end\r\n    return newTable\r\nend\r\n\r\n--Moves scripted highlight from all objects\r\nfunction removeAllHighlights()\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        obj.highlightOff()\r\n    end\r\nend\r\n\r\n--Round number (num) to the Nth decimal (dec)\r\nfunction round(num, dec)\r\n    local mult = 10 ^ (dec or 0)\r\n    return math.floor(num * mult + 0.5) / mult\r\nend\r\n\r\n--[[ This object provides access to a variable stored on the \"Global script\".\r\nThe variable holds the GUIDs for every Utility Memory Bag in the scene.\r\nExample: {'805ebd', '35cc21', 'fc8886', 'f50264', '5f5f63'} --]]\r\nAllMemoryBagsInScene = {\r\n    NAME_OF_GLOBAL_VARIABLE = \"_UtilityMemoryBag_AllMemoryBagsInScene\"\r\n}\r\n\r\nfunction AllMemoryBagsInScene:add(guid)\r\n    local guids = Global.getTable(self.NAME_OF_GLOBAL_VARIABLE) or {}\r\n    table.insert(guids, guid)\r\n    Global.setTable(self.NAME_OF_GLOBAL_VARIABLE, guids)\r\nend\r\n\r\nfunction AllMemoryBagsInScene:getGuidList()\r\n    return Global.getTable(self.NAME_OF_GLOBAL_VARIABLE) or {}\r\nend\r\n","LuaScriptState":"{\"ml\":{\"2b4096\":{\"lock\":false,\"pos\":{\"x\":-21.50026512146,\"y\":1.77866888046265,\"z\":19.4999504089355},\"rot\":{\"x\":0.00227246317081153,\"y\":180.036270141602,\"z\":359.98388671875},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"43b75f\":{\"lock\":false,\"pos\":{\"x\":-27.5002994537354,\"y\":1.77866888046265,\"z\":19.499906539917},\"rot\":{\"x\":0.0022723819129169,\"y\":180.025985717773,\"z\":359.98388671875},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"49ac45\":{\"lock\":false,\"pos\":{\"x\":-20.9098873138428,\"y\":1.82793986797333,\"z\":19.4995727539063},\"rot\":{\"x\":0.00302357575856149,\"y\":180.03630065918,\"z\":0.0715577453374863},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"5239e6\":{\"lock\":false,\"pos\":{\"x\":-26.3195762634277,\"y\":1.88135004043579,\"z\":19.4993629455566},\"rot\":{\"x\":0.00340429926291108,\"y\":180.027770996094,\"z\":0.0956790596246719},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"6572d8\":{\"lock\":false,\"pos\":{\"x\":-20.3195629119873,\"y\":1.88189816474915,\"z\":19.4991931915283},\"rot\":{\"x\":0.00300828623585403,\"y\":180.034194946289,\"z\":0.0715579837560654},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"764377\":{\"lock\":false,\"pos\":{\"x\":-25.7296104431152,\"y\":1.94014871120453,\"z\":19.4993057250977},\"rot\":{\"x\":0.00326459342613816,\"y\":180.020034790039,\"z\":0.0956796109676361},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"7e3931\":{\"lock\":false,\"pos\":{\"x\":-31.8093280792236,\"y\":1.94049680233002,\"z\":19.4836711883545},\"rot\":{\"x\":0.00330737815238535,\"y\":180.154251098633,\"z\":0.0956804305315018},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"a762fe\":{\"lock\":false,\"pos\":{\"x\":-32.3992881774902,\"y\":1.88166451454163,\"z\":19.4851131439209},\"rot\":{\"x\":0.00337715819478035,\"y\":180.158081054688,\"z\":0.0956800356507301},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"a7fb18\":{\"lock\":false,\"pos\":{\"x\":-19.7295818328857,\"y\":1.9405118227005,\"z\":19.4990406036377},\"rot\":{\"x\":0.00330254272557795,\"y\":180.03010559082,\"z\":0.0956823974847794},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"d5023c\":{\"lock\":false,\"pos\":{\"x\":-32.4999961853027,\"y\":1.77991259098053,\"z\":26.0000686645508},\"rot\":{\"x\":359.962280273438,\"y\":179.960586547852,\"z\":8.98252983461134E-06},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}}}}","XmlUI":"","ContainedObjects":[{"GUID":"2b4096","Name":"Card","Transform":{"posX":-20.90986,"posY":1.82802439,"posZ":19.4995728,"rotX":0.00302884053,"rotY":180.0363,"rotZ":0.0715545,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85020\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 1,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306212,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"43b75f","Name":"Card","Transform":{"posX":-27.5003,"posY":1.77866876,"posZ":19.4999065,"rotX":0.00227261172,"rotY":180.02597,"rotZ":359.9839,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85019\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 2,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306211,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"49ac45","Name":"Card","Transform":{"posX":-26.31949,"posY":1.87710035,"posZ":19.4993515,"rotX":0.00300578168,"rotY":180.0364,"rotZ":0.07154982,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85017\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 1,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306208,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"5239e6","Name":"Card","Transform":{"posX":-31.80921,"posY":1.92634654,"posZ":19.4836655,"rotX":0.00354898232,"rotY":180.0278,"rotZ":0.0956730843,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85019\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 2,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306214,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"6572d8","Name":"Card","Transform":{"posX":-21.5002785,"posY":1.77866888,"posZ":19.499958,"rotX":0.002273024,"rotY":180.03421,"rotZ":359.9839,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85014\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 1,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306205,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"764377","Name":"Card","Transform":{"posX":-19.7294369,"posY":1.92602539,"posZ":19.49904,"rotX":0.003446175,"rotY":180.020035,"rotZ":0.09567736,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85015\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 1,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306206,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"7e3931","Name":"Card","Transform":{"posX":-32.3992,"posY":1.87725759,"posZ":19.4851055,"rotX":0.003036707,"rotY":180.1543,"rotZ":0.07155504,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85018\",\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306210,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"a762fe","Name":"Card","Transform":{"posX":-25.7294922,"posY":1.9261626,"posZ":19.4992981,"rotX":0.003228413,"rotY":180.158157,"rotZ":0.0956740156,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85018\",\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306209,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"a7fb18","Name":"Card","Transform":{"posX":-32.50002,"posY":1.77890432,"posZ":26.00007,"rotX":-0.000005131346,"rotY":180.030121,"rotZ":3.861126e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85020\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 1,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306213,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"d5023c","Name":"Card","Transform":{"posX":-20.31946,"posY":1.87712073,"posZ":19.4991932,"rotX":0.00314465072,"rotY":179.960617,"rotZ":0.07155345,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85016\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 1,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306207,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"2eee61","Name":"CardCustom","Transform":{"posX":5.99999857,"posY":1.52216387,"posZ":30.5000038,"rotX":0.0108916443,"rotY":179.997589,"rotZ":0.00494775642,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"32c650","Name":"CardCustom","Transform":{"posX":-3.00000143,"posY":1.52142048,"posZ":22.5000038,"rotX":0.0108917318,"rotY":179.997879,"rotZ":0.00494791055,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"3989a8","Name":"Custom_Model","Transform":{"posX":-20.5,"posY":1.7663,"posZ":17,"rotX":0,"rotY":-0.0003,"rotZ":0,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Text Tool","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0,"g":0,"b":0,"a":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":false,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":false,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomMesh":{"MeshURL":"http://cloud-3.steamusercontent.com/ugc/1478820768302617365/27883B7913E0E69143C3AA03493B7E7C4E8C29C0/","DiffuseURL":"","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":1,"TypeIndex":0,"CastShadows":true},"LuaScript":"-- Code for bag to identify text tool objects\r\nmovableTextTool_cowgoesmoo33 = true\r\n\r\n-- Number of characters before the text box width expands.\r\nEXPAND_INTERVAL = 20\r\n\r\n-- This table controls what is passed between save/load\r\ndata = {}\r\n\r\nfunction onLoad(saved_data)\r\n  if saved_data ~= '' then\r\n    data = JSON.decode(saved_data)\r\n    if data.text ~= '' then\r\n      self.interactable = data.interactable\r\n      staticMode()\r\n      return\r\n    end\r\n  else\r\n    data = {size=200, color=Color(0,0,0), text='', interactable=true,\r\n        enter_to_finish=false, autolock=false, autolift=false,\r\n        hover_height=0.05, box_transparency=1}\r\n  end\r\n\r\n  inputMode()\r\nend\r\n\r\n-- True if in the middle of delay after pressing Enter (with enter_to_finish on)\r\nfinishing = false\r\nfunction input_func(obj, color, input, stillEditing)\r\n  local params = getBox(input)\r\n  if params then\r\n    params.value = input\r\n    self.editInput(params)\r\n  end\r\n\r\n  if not stillEditing then\r\n    data.text = input\r\n    updateState()\r\n    if input ~= '' then staticMode(color) end\r\n  elseif data.enter_to_finish then\r\n    -- If enter is pressed: remove last newline and force finish\r\n    if not finishing and input:sub(-1) == '\\n' then\r\n      finishing = true\r\n      -- Delay to avoid user's Enter keypress being detected (opens chat box)\r\n      Wait.frames(function()\r\n        input = input:sub(1, -2)\r\n        data.text = input\r\n        updateState()\r\n        if input ~= '' then staticMode(color) else inputMode() end\r\n        finishing = false\r\n      end, 10)\r\n    end\r\n  end\r\nend\r\n\r\n-- When the inpupt box appears and lets the player type in it.\r\nfunction inputMode()\r\n  self.clearContextMenu()\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n\r\n  local size = getBox(data.text, true)\r\n\r\n  self.createInput({\r\n    input_function = \"input_func\",\r\n    function_owner = self,\r\n    label          = \"Type Here\",\r\n    alignment      = 3,\r\n    position       = {x=0, y=data.hover_height, z=0},\r\n    rotation       = {0, 180, 0},\r\n    width          = size.width,\r\n    height         = size.height,\r\n    color          = getBackground(data.color),\r\n    font_color     = data.color,\r\n    font_size      = data.size,\r\n    value          = data.text,\r\n  })\r\n\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\nend\r\n\r\n-- When the input box disappears and displays the text.\r\nfunction staticMode(player)\r\n  self.clearContextMenu()\r\n  if data.autolock then\r\n    self.locked = true\r\n  end\r\n  if self.getInputs() and #self.getInputs() ~= 0 then\r\n    self.removeInput(0)\r\n  end\r\n\r\n  -- Clear from selecting player\r\n  if player then\r\n    self.removeFromPlayerSelection(player)\r\n  end\r\n\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  self.createButton({\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=self,\r\n    position={0,data.hover_height,0}, rotation={0,180,0}, height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  })\r\n\r\n  self.addContextMenuItem('Edit Text', function(color)\r\n    self.removeFromPlayerSelection(color)\r\n    inputMode()\r\n  end)\r\n  self.addContextMenuItem('Clear', function(color)\r\n    applyMultiple(color, 'clear', _, true)\r\n  end)\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\n  self.addContextMenuItem('Permanently Attach', attemptAttach)\r\n  self.addContextMenuItem('Permalock', function(color)\r\n    applyMultiple(color, 'permalock', _, true)\r\n  end)\r\nend\r\n\r\nfunction changeSize(params)\r\n  local delta = params[1]\r\n  local newSize = data.size + delta\r\n  if newSize > 800  or newSize < 50 then\r\n    return\r\n  end\r\n  data.size = newSize\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_size=data.size})\r\n  else\r\n    local size = getBox(data.text, true)\r\n    self.editInput({width=size.width, height=size.height, font_size=data.size})\r\n  end\r\nend\r\n\r\nfunction setColor(params)\r\n  if params and params[1] then\r\n    data.color = params[1]\r\n  else\r\n    data.color = self.getColorTint():setAt('a', 1) -- Take on color of object tint\r\n  end\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_color=data.color})\r\n  else\r\n    self.editInput({font_color=data.color, color=getBackground(data.color)})\r\n  end\r\nend\r\n\r\nfunction getBackground(color) --determines whether to use black or white depending on luminance\r\n  local r,g,b = Color(color):get()\r\n\r\n  local lum = 0.2126*r + 0.7152*g + 0.0722*b\r\n  if lum > 0.75 then\r\n    return {0.2,0.2,0.2, data.box_transparency}\r\n  else\r\n    return {1,1,1, data.box_transparency}\r\n  end\r\nend\r\n\r\nfunction clear()\r\n  data.text = ''\r\n  updateState()\r\n  inputMode()\r\nend\r\n\r\nfunction permalock()\r\n  self.interactable = false\r\n  data.interactable = false\r\n  updateState()\r\nend\r\n\r\nlocal target_script = [[\r\nfunction onLoad(script_state)\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    for _,entry in ipairs(state) do\r\n      self.createButton(entry)\r\n    end\r\n    self.addContextMenuItem('Clear All Text', function(color)\r\n      self.clearContextMenu()\r\n      self.clearButtons()\r\n      self.script_state = ''\r\n      self.script_code = ''\r\n    end)\r\n  end\r\nend\r\n]]\r\n\r\nfunction attemptAttach(player_color)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  local attachee\r\n  local attachers = {}\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if obj ~= self then\r\n        table.insert(attachers, obj)\r\n      end\r\n    else\r\n      if attachee then\r\n        broadcastToColor(\"More than one target selected.\", player_color)\r\n        return\r\n      else\r\n        attachee = obj\r\n      end\r\n    end\r\n  end\r\n  if attachee then\r\n    local code = attachee.script_code\r\n    if code and code ~= '' and code ~= target_script then\r\n      broadcastToColor(\"Warning: script on card has been overriden. Rewind time to undo.\", player_color)\r\n    end\r\n    for i,attacher in ipairs(attachers) do\r\n      attacher.call('attach', {target = attachee})\r\n    end\r\n    attach({target = attachee})\r\n    local type, flip = attachee.type, attachee.getRotation().z\r\n    if (type == 'Card' or type == 'Deck') and flip > 175 and flip < 185 then\r\n      broadcastToColor(\"Warning: text will not display if card or deck is facing down.\", player_color)\r\n    end\r\n  else\r\n    broadcastToColor(\"You must have a target object in your selection (using click-and-drag or Ctrl+Click) to use this option.\", player_color)\r\n  end\r\nend\r\n\r\nfunction attach(params)\r\n  local target = params.target\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  local textRotation = self.getRotation():sub(target.getRotation())\r\n    :add(Vector(180, 0, 180))\r\n\r\n  local textPosition = target.positionToLocal(\r\n    self.getPosition():add(Vector(0, data.hover_height, 0))\r\n  )\r\n  textPosition.x = -textPosition.x\r\n\r\n  local textScale = {}\r\n  textScale.x = self.getScale().x / target.getScale().x\r\n  textScale.y = self.getScale().x / target.getScale().y\r\n  textScale.z = self.getScale().x / target.getScale().z\r\n\r\n  local details = {\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=nil,\r\n    position=textPosition,\r\n    rotation=textRotation,\r\n    scale=textScale,\r\n    height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  }\r\n\r\n  target.createButton(details)\r\n\r\n  local script_state = target.script_state\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    table.insert(state, details)\r\n    target.script_state = JSON.encode(state)\r\n  else\r\n    target.script_state = JSON.encode({[1]=details})\r\n  end\r\n\r\n  target.script_code = target_script\r\n\r\n  self.destruct()\r\nend\r\n\r\nfunction applyMultiple(player_color, func_string, params, static_only)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if not static_only or obj.call('isStatic') then\r\n        obj.call(func_string, params)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction isStatic()\r\n  local input = self.getInputs()\r\n  return not input or #input == 0\r\nend\r\n\r\nfunction getBox(input, force)\r\n  local maxLength, lineCount = EXPAND_INTERVAL, 1\r\n  local lineLength = 0\r\n  for i = 1, #input do\r\n    local c = input:sub(i,i)\r\n    if c == '\\n' then\r\n      lineCount = lineCount + 1\r\n      if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n      lineLength = 0\r\n    else\r\n      lineLength = lineLength + 1\r\n    end\r\n  end\r\n  if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n\r\n  newWidth = data.size * maxLength * 0.9\r\n  newHeight = data.size * lineCount + 23\r\n\r\n  if force or boxWidth ~= newWidth or boxHeight ~= newHeight then\r\n    boxWidth, boxHeight = newWidth, newHeight\r\n    return {width = boxWidth, height = boxHeight}\r\n  end\r\n  return nil\r\nend\r\n\r\ntemp_lift = nil\r\nfunction onPickUp(player_color)\r\n  if data.autolift then\r\n    local player = Player[player_color]\r\n    temp_lift = player.lift_height\r\n    player.lift_height = 0\r\n  end\r\nend\r\n\r\nfunction onDrop(player_color)\r\n  if data.autolift and temp_lift then\r\n    Player[player_color].lift_height = temp_lift\r\n  end\r\nend\r\n\r\n-- Should be called every time data is modified, allows info to be saved on copy/paste\r\nfunction updateState()\r\n  self.script_state = JSON.encode(data)\r\nend\r\n\r\nfunction onSave()\r\n  self.script_state = JSON.encode(data)\r\n  return self.script_state\r\nend","LuaScriptState":"{\"autolift\":false,\"autolock\":false,\"box_transparency\":1,\"color\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1},\"enter_to_finish\":false,\"hover_height\":0.05,\"interactable\":true,\"size\":200,\"text\":\"4 Zones de Quarantaine\"}","XmlUI":""},{"GUID":"3a6bb8","Name":"Custom_Tile","Transform":{"posX":10.4999981,"posY":1.50664985,"posZ":22.5000038,"rotX":0.0049461904,"rotY":89.99158,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"46f500","Name":"Custom_Tile","Transform":{"posX":10.4999981,"posY":1.50360847,"posZ":6.500001,"rotX":0.004946042,"rotY":89.99166,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"483110","Name":"Card","Transform":{"posX":-27.0741215,"posY":1.77890575,"posZ":2.97144151,"rotX":2.25687575e-8,"rotY":180.417313,"rotZ":-0.0000337208367,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 7,\n  \"id\": \"85042\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306418,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"4a63ca","Name":"Custom_Model_Bag","Transform":{"posX":-20,"posY":1.8578,"posZ":7,"rotX":0,"rotY":180.0011,"rotZ":0,"scaleX":0.9249998,"scaleY":0.9249998,"scaleZ":0.9249998},"Nickname":"Sets carte histoire \"incursion Mi-Go\"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":1,"g":1,"b":1},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"MaterialIndex":-1,"MeshIndex":-1,"CustomMesh":{"MeshURL":"https://pastebin.com/raw/ALrYhQGb","DiffuseURL":"http://cloud-3.steamusercontent.com/ugc/1932636510528836575/84423A489260C96E8F6E6EAAE0E2822FD1F0D582/","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":3,"TypeIndex":6,"CustomShader":{"SpecularColor":{"r":1,"g":1,"b":1},"SpecularIntensity":0,"SpecularSharpness":2,"FresnelStrength":0},"CastShadows":true},"Bag":{"Order":2},"LuaScript":"","LuaScriptState":"{\"ml\":[]}","XmlUI":"","ContainedObjects":[{"GUID":"54f237","Name":"Deck","Transform":{"posX":-20,"posY":2.009074,"posZ":7.5,"rotX":-9.173407e-7,"rotY":179.995987,"rotZ":1.42722641e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":false,"DeckIDs":[306900,306909,293619,307017],"CustomDeck":{"2936":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0},"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0},"3070":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"9d613e","Name":"Card","Transform":{"posX":-26.5000076,"posY":1.87234879,"posZ":6.99999,"rotX":-0.000553848338,"rotY":179.99556,"rotZ":-0.000516230066,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Neutral\",\n  \"cycle\": \"Standalone\",\n  \"health\": 3,\n  \"id\": \"85025\",\n  \"sanity\": 1,\n  \"traits\": \"Bystander. Miskatonic.\",\n  \"type\": \"Asset\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306900,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"5015a5","Name":"Card","Transform":{"posX":-26.5000076,"posY":5.06089163,"posZ":6.99999,"rotX":-0.00000499793532,"rotY":179.99556,"rotZ":2.943303e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 2,\n  \"healthPerInv\": \"true\",\n  \"id\": \"85036\",\n  \"traits\": \"Monster. Mi-Go. Elite.\",\n  \"type\": \"Enemy\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306909,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"529994","Name":"Card","Transform":{"posX":-26.5000076,"posY":5.26089144,"posZ":6.99999,"rotX":-0.00000499793532,"rotY":179.99556,"rotZ":2.943303e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Universal Solvent","Description":"","GMNotes":"{\n  \"class\": \"Neutral\",\n  \"cost\": 2,\n  \"cycle\": \"Standalone\",\n  \"id\": \"85029\",\n  \"intellectIcons\": 1,\n  \"traits\": \"Item. Science.\",\n  \"type\": \"Asset\",\n  \"uses\": {\n    \"count\": 4,\n    \"token\": \"resource\",\n    \"type\": \"Supply\"\n  },\n  \"wildIcons\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":293619,"SidewaysCard":false,"CustomDeck":{"2936":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"a43f44","Name":"Card","Transform":{"posX":-26.5000076,"posY":1.88598561,"posZ":6.99999,"rotX":0.00296506169,"rotY":179.99556,"rotZ":-0.0013885058,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85021\",\n  \"traits\": \"Part 1.\",\n  \"type\": \"Story\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":307017,"SidewaysCard":false,"CustomDeck":{"3070":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"32a69c","Name":"Deck","Transform":{"posX":-22.5,"posY":2.00255251,"posZ":7.5,"rotX":-0.00000471631074,"rotY":180.000244,"rotZ":-4.05648024e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":false,"DeckIDs":[306902,293621,307015],"CustomDeck":{"2936":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0},"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0},"3070":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"5cf477","Name":"Card","Transform":{"posX":-28.9999981,"posY":4.85607767,"posZ":6.99999332,"rotX":-0.00000504569925,"rotY":180.0003,"rotZ":-5.79520645e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 4,\n  \"healthPerInv\": \"true\",\n  \"id\": \"85027\",\n  \"traits\": \"Monster. Servitor. Mi-Go. Elite.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306902,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"a59041","Name":"Card","Transform":{"posX":-28.9999981,"posY":5.05607748,"posZ":6.99999332,"rotX":-0.00000504569925,"rotY":180.0003,"rotZ":-5.79520645e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Mi-Go Weapon","Description":"","GMNotes":"{\n  \"class\": \"Neutral\",\n  \"combatIcons\": 1,\n  \"cost\": 2,\n  \"cycle\": \"Standalone\",\n  \"id\": \"85031\",\n  \"traits\": \"Weapon. Science.\",\n  \"type\": \"Asset\",\n  \"uses\": {\n    \"count\": 3,\n    \"token\": \"resource\",\n    \"type\": \"Ammo\"\n  },\n  \"wildIcons\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":293621,"SidewaysCard":false,"CustomDeck":{"2936":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"92aeba","Name":"Card","Transform":{"posX":-28.9999981,"posY":1.87737787,"posZ":6.99999332,"rotX":-0.000405237137,"rotY":180.0003,"rotZ":-0.00221723341,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85023\",\n  \"traits\": \"Part 1.\",\n  \"type\": \"Story\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":307015,"SidewaysCard":false,"CustomDeck":{"3070":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"0fa462","Name":"Deck","Transform":{"posX":-26,"posY":2.00736642,"posZ":7,"rotX":-0.00000491978744,"rotY":180.000519,"rotZ":-2.900222e-8,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":false,"DeckIDs":[306908,293622,306903,307018],"CustomDeck":{"2936":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0},"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0},"3070":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"6aa846","Name":"Card","Transform":{"posX":-32.50001,"posY":4.773618,"posZ":6.499948,"rotX":-0.00000517423859,"rotY":180.000031,"rotZ":6.66690738e-8,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 2,\n  \"healthPerInv\": \"true\",\n  \"id\": \"85035\",\n  \"traits\": \"Monster. Mi-Go. Elite.\",\n  \"type\": \"Enemy\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306908,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"5b6c96","Name":"Card","Transform":{"posX":-32.50001,"posY":5.06089163,"posZ":6.499948,"rotX":-0.000005125185,"rotY":180.000031,"rotZ":-7.21934557e-9,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Lt. Wilson Stewart ","Description":"","GMNotes":"{\n  \"class\": \"Neutral\",\n  \"cost\": 2,\n  \"cycle\": \"Standalone\",\n  \"health\": 2,\n  \"id\": \"85032\",\n  \"sanity\": 2,\n  \"traits\": \"Ally. Agency. Veteran.\",\n  \"type\": \"Asset\",\n  \"wildIcons\": 1,\n  \"willpowerIcons\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":293622,"SidewaysCard":false,"CustomDeck":{"2936":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"0d4a41","Name":"Card","Transform":{"posX":-32.50001,"posY":5.26089144,"posZ":6.499948,"rotX":-0.000005125185,"rotY":180.000031,"rotZ":-7.21934557e-9,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Neutral\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85028\",\n  \"type\": \"Asset\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306903,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"5f9bac","Name":"Card","Transform":{"posX":-32.50001,"posY":1.885993,"posZ":6.499948,"rotX":0.00224705855,"rotY":180.000031,"rotZ":-0.0017546016,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85024\",\n  \"traits\": \"Part 1.\",\n  \"type\": \"Story\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":307018,"SidewaysCard":false,"CustomDeck":{"3070":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"0caba3","Name":"Deck","Transform":{"posX":-28.5,"posY":2.007367,"posZ":7.5,"rotX":-0.000005158043,"rotY":179.995132,"rotZ":4.889532e-8,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":false,"DeckIDs":[306901,306907,293620,307016],"CustomDeck":{"2936":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0},"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0},"3070":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"59fca6","Name":"Card","Transform":{"posX":-35.00002,"posY":1.87234879,"posZ":6.99996042,"rotX":-0.000555212551,"rotY":179.99472,"rotZ":-0.0005106429,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Neutral\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85026\",\n  \"traits\": \"Item.\",\n  \"type\": \"Asset\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306901,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"a5b528","Name":"Card","Transform":{"posX":-35.00002,"posY":5.06089163,"posZ":6.99996042,"rotX":-0.00000528819828,"rotY":179.99472,"rotZ":7.871257e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 2,\n  \"healthPerInv\": \"true\",\n  \"id\": \"85034\",\n  \"traits\": \"Monster. Mi-Go. Elite.\",\n  \"type\": \"Enemy\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306907,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"efb58e","Name":"Card","Transform":{"posX":-35.00002,"posY":5.26089144,"posZ":6.99996042,"rotX":-0.00000528819828,"rotY":179.99472,"rotZ":7.871257e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Pet Oozeling","Description":"","GMNotes":"{\n  \"agilityIcons\": 1,\n  \"class\": \"Neutral\",\n  \"cost\": 2,\n  \"cycle\": \"Standalone\",\n  \"health\": 3,\n  \"id\": \"85030\",\n  \"traits\": \"Ally. Monster. Ooze.\",\n  \"type\": \"Asset\",\n  \"wildIcons\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":293620,"SidewaysCard":false,"CustomDeck":{"2936":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"d3acfe","Name":"Card","Transform":{"posX":-35.00002,"posY":1.88598335,"posZ":6.99996042,"rotX":0.0029324186,"rotY":179.99472,"rotZ":-0.00358716422,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85022\",\n  \"traits\": \"Part 1.\",\n  \"type\": \"Story\",\n  \"victory\": 1\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":307016,"SidewaysCard":false,"CustomDeck":{"3070":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]}]},{"GUID":"4ff304","Name":"Custom_Tile","Transform":{"posX":1.49999678,"posY":1.50590634,"posZ":14.5000029,"rotX":0.004946256,"rotY":89.99148,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"5359e8","Name":"CardCustom","Transform":{"posX":5.999998,"posY":1.52064323,"posZ":22.5000057,"rotX":0.0108917868,"rotY":179.997726,"rotZ":0.00494781835,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"538522","Name":"CardCustom","Transform":{"posX":-3.00000238,"posY":1.518379,"posZ":6.500003,"rotX":0.0108917411,"rotY":179.997513,"rotZ":0.004947733,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"548427","Name":"Card","Transform":{"posX":-32.98965,"posY":1.82890379,"posZ":19.486763,"rotX":0.00000698357235,"rotY":180.160019,"rotZ":-0.0000115169223,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85012\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306203,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"5d8be3","Name":"Custom_Tile","Transform":{"posX":1.49999845,"posY":1.5074271,"posZ":22.5000038,"rotX":0.00494614569,"rotY":89.99158,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"6147ae","Name":"Custom_PDF","Transform":{"posX":-19,"posY":1.47986,"posZ":-5.500007,"rotX":-4.59967069e-8,"rotY":180.0017,"rotZ":-5.18388674e-8,"scaleX":2.05722,"scaleY":1,"scaleZ":2.05722},"Nickname":"Le Dévoreur de toute chose","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":1,"g":1,"b":1},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomPDF":{"PDFUrl":"http://cloud-3.steamusercontent.com/ugc/1936013662297851796/DD9A810FDF85B0AC664AD3790B39884C3C37C1FD/","PDFPassword":"","PDFPage":0,"PDFPageOffset":0},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"61ae50","Name":"CardCustom","Transform":{"posX":14.9999981,"posY":1.51834524,"posZ":14.5000029,"rotX":0.0108916331,"rotY":179.99765,"rotZ":0.004947825,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"62ced0","Name":"Custom_Model_Bag","Transform":{"posX":-28.0023613,"posY":1.83530045,"posZ":13.5040112,"rotX":-0.000004896727,"rotY":180.002548,"rotZ":3.97426447e-7,"scaleX":0.7,"scaleY":0.7,"scaleZ":0.7},"Nickname":"Groupe unique","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":1,"g":1,"b":1},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"MaterialIndex":-1,"MeshIndex":-1,"CustomMesh":{"MeshURL":"https://pastebin.com/raw/ALrYhQGb","DiffuseURL":"http://cloud-3.steamusercontent.com/ugc/1932636510528590924/9B20F28E3CE6172A74394ADD06861FC5414F9FE8/","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":3,"TypeIndex":6,"CustomShader":{"SpecularColor":{"r":1,"g":1,"b":1},"SpecularIntensity":0,"SpecularSharpness":2,"FresnelStrength":0},"CastShadows":true},"Bag":{"Order":0},"LuaScript":"-- Utility memory bag by Directsun\r\n-- Version 2.7.0\r\n-- Fork of Memory Bag 2.0 by MrStump\r\n--\r\n-- Want to contribute? Create an issue or fork the code on GitHub and submit a pull request:\r\n-- https://github.com/sunflowermans/TTS-UtilityMemoryBag\r\n\r\n\r\nfunction updateSave()\r\n    local data_to_save = {[\"ml\"]=memoryList}\r\n    saved_data = JSON.encode(data_to_save)\r\n    self.script_state = saved_data\r\nend\r\n\r\nfunction combineMemoryFromBagsWithin()\r\n    local bagObjList = self.getObjects()\r\n    for _, bagObj in ipairs(bagObjList) do\r\n        local data = bagObj.lua_script_state\r\n        if data ~= nil then\r\n            local j = JSON.decode(data)\r\n            if j ~= nil and j.ml ~= nil then\r\n                for guid, entry in pairs(j.ml) do\r\n                    memoryList[guid] = entry\r\n                end\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\nfunction updateMemoryWithMoves()\r\n    memoryList = memoryListBackup\r\n    --get the first transposed object's coordinates\r\n    local obj = getObjectFromGUID(moveGuid)\r\n\r\n    -- p1 is where needs to go, p2 is where it was\r\n    local refObjPos = memoryList[moveGuid].pos\r\n    local deltaPos = findOffsetDistance(obj.getPosition(), refObjPos, nil)\r\n    local movedRotation = obj.getRotation()\r\n    for guid, entry in pairs(memoryList) do\r\n        memoryList[guid].pos.x = entry.pos.x - deltaPos.x\r\n        memoryList[guid].pos.y = entry.pos.y - deltaPos.y\r\n        memoryList[guid].pos.z = entry.pos.z - deltaPos.z\r\n        -- memoryList[guid].rot.x = movedRotation.x\r\n        -- memoryList[guid].rot.y = movedRotation.y\r\n        -- memoryList[guid].rot.z = movedRotation.z\r\n    end\r\n\r\n    --theList[obj.getGUID()] = {\r\n    --    pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n    --    rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n    --    lock=obj.getLock()\r\n    --}\r\n    moveList = {}\r\nend\r\n\r\nfunction onload(saved_data)\r\n\r\n    fresh = true\r\n    if saved_data ~= \"\" then\r\n        local loaded_data = JSON.decode(saved_data)\r\n        --Set up information off of loaded_data\r\n        memoryList = loaded_data.ml\r\n    else\r\n        --Set up information for if there is no saved saved data\r\n        memoryList = {}\r\n\r\n    end\r\n\r\n    moveList = {}\r\n    moveGuid = nil\r\n\r\n    if next(memoryList) == nil then\r\n        createSetupButton()\r\n    else\r\n        fresh = false\r\n        createMemoryActionButtons()\r\n    end\r\nend\r\n\r\n\r\n--Beginning Setup\r\n\r\n\r\n--Make setup button\r\nfunction createSetupButton()\r\n    self.createButton({\r\n        label=\"Config\", click_function=\"buttonClick_setup\", function_owner=self,\r\n        position={0,0.3,2}, rotation={0,0,0}, height=350, width=800,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\nend\r\n\r\n--Triggered by Transpose button\r\nfunction buttonClick_transpose()\r\n    moveGuid = nil\r\n    broadcastToAll(\"Select one object and move it- all objects will move relative to the new location\", {0.75, 0.75, 1})\r\n    memoryListBackup = duplicateTable(memoryList)\r\n    memoryList = {}\r\n    moveList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createButtonsOnAllObjects(true)\r\n    createSetupActionButtons(true)\r\nend\r\n\r\n--Triggered by setup button,\r\nfunction buttonClick_setup()\r\n    memoryListBackup = duplicateTable(memoryList)\r\n    memoryList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createButtonsOnAllObjects(false)\r\n    createSetupActionButtons(false)\r\nend\r\n\r\nfunction getAllObjectsInMemory()\r\n    local objTable = {}\r\n    local curObj = {}\r\n\r\n    for guid in pairs(memoryListBackup) do\r\n        curObj = getObjectFromGUID(guid)\r\n        table.insert(objTable, curObj)\r\n    end\r\n\r\n    return objTable\r\n    -- return getAllObjects()\r\nend\r\n\r\n--Creates selection buttons on objects\r\nfunction createButtonsOnAllObjects(move)\r\n    buttonIndexMap = {}\r\n    local howManyButtons = 0\r\n\r\n    local objsToHaveButtons = {}\r\n    if move == true then\r\n        objsToHaveButtons = getAllObjectsInMemory()\r\n    else\r\n        objsToHaveButtons = getAllObjects()\r\n    end\r\n\r\n    for _, obj in ipairs(objsToHaveButtons) do\r\n        if obj ~= self then\r\n            --On a normal bag, the button positions aren't the same size as the bag.\r\n            globalScaleFactor = 1 * 1/self.getScale().x\r\n            --Super sweet math to set button positions\r\n            local selfPos = self.getPosition()\r\n            local objPos = obj.getPosition()\r\n            local deltaPos = findOffsetDistance(selfPos, objPos, obj)\r\n            local objPos = rotateLocalCoordinates(deltaPos, self)\r\n            objPos.x = -objPos.x * globalScaleFactor\r\n            objPos.y = objPos.y * globalScaleFactor +2\r\n            objPos.z = objPos.z * globalScaleFactor\r\n            --Workaround for custom PDFs\r\n            if obj.Book then\r\n                objPos.y = objPos.y + 0.5\r\n            end\r\n            --Offset rotation of bag\r\n            local rot = self.getRotation()\r\n            rot.y = -rot.y + 180\r\n            --Create function\r\n            local funcName = \"selectButton_\" .. howManyButtons\r\n            local func = function() buttonClick_selection(obj, move) end\r\n            local color = {0.75,0.25,0.25,0.6}\r\n            local colorMove = {0,0,1,0.6}\r\n            if move == true then\r\n                color = colorMove\r\n            end\r\n            self.setVar(funcName, func)\r\n            self.createButton({\r\n                click_function=funcName, function_owner=self,\r\n                position=objPos, rotation=rot, height=1000, width=1000,\r\n                color=color,\r\n            })\r\n            buttonIndexMap[obj.getGUID()] = howManyButtons\r\n            howManyButtons = howManyButtons + 1\r\n        end\r\n    end\r\nend\r\n\r\n--Creates submit and cancel buttons\r\nfunction createSetupActionButtons(move)\r\n    self.createButton({\r\n       label=\"Annuler\", click_function=\"buttonClick_cancel\", function_owner=self,\r\n       position={-1.15,0.3,2.1}, rotation={0,0,0}, height=350, width=1100,\r\n       font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n\r\n    self.createButton({\r\n      label=\"Valider\", click_function=\"buttonClick_submit\", function_owner=self,\r\n      position={-1.15,0.3,2.8}, rotation={0,0,0}, height=350, width=1100,\r\n      font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n\r\n    if move == false then\r\n      self.createButton({\r\n          label=\"Ajouter\", click_function=\"buttonClick_add\", function_owner=self,\r\n          position={1.15,0.3,2.1}, rotation={0,0,0}, height=350, width=1100,\r\n          font_size=250, color={0,0,0}, font_color={0.25,1,0.25}\r\n        })\r\n\r\n        self.createButton({\r\n            label=\"Sélection\", click_function=\"editDragSelection\", function_owner=self,\r\n            position={-1.15,0.3,3.5}, rotation={0,0,0}, height=350, width=1100,\r\n            font_size=250, color={0,0,0}, font_color={1,1,1}\r\n        })\r\n\r\n        if fresh == false then\r\n            self.createButton({\r\n                label=\"Mise à Jour\", click_function=\"buttonClick_setNew\", function_owner=self,\r\n                position={1.15,0.3,3.5}, rotation={0,0,0}, height=350, width=1100,\r\n                font_size=180, color={0,0,0}, font_color={0.75,0.75,1}\r\n            })\r\n            self.createButton({\r\n                label=\"Retirer\", click_function=\"buttonClick_remove\", function_owner=self,\r\n                position={1.15,0.3,2.8}, rotation={0,0,0}, height=350, width=1100,\r\n                font_size=250, color={0,0,0}, font_color={1,0.25,0.25}\r\n            })\r\n        end\r\n    end\r\n\r\n    self.createButton({\r\n        label=\"Reset\", click_function=\"buttonClick_reset\", function_owner=self,\r\n        position={0,0.3,-2}, rotation={0,0,0}, height=350, width=800,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\nend\r\n\r\n\r\n--During Setup\r\n\r\n\r\n--Checks or unchecks buttons\r\nfunction buttonClick_selection(obj, move)\r\n    local index = buttonIndexMap[obj.getGUID()]\r\n    local colorMove = {0,0,1,0.6}\r\n    local color = {0,1,0,0.6}\r\n\r\n    previousGuid = selectedGuid\r\n    selectedGuid = obj.getGUID()\r\n\r\n    theList = memoryList\r\n    if move == true then\r\n        theList = moveList\r\n        if previousGuid ~= nil and previousGuid ~= selectedGuid then\r\n            local prevObj = getObjectFromGUID(previousGuid)\r\n            prevObj.highlightOff()\r\n            self.editButton({index=previousIndex, color=colorMove})\r\n            theList[previousGuid] = nil\r\n        end\r\n        previousIndex = index\r\n    end\r\n\r\n    if theList[selectedGuid] == nil then\r\n        self.editButton({index=index, color=color})\r\n        --Adding pos/rot to memory table\r\n        local pos, rot = obj.getPosition(), obj.getRotation()\r\n        --I need to add it like this or it won't save due to indexing issue\r\n        theList[obj.getGUID()] = {\r\n            pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n            rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n            lock=obj.getLock(),\r\n            tint=obj.getColorTint()\r\n        }\r\n        obj.highlightOn({0,1,0})\r\n    else\r\n        color = {0.75,0.25,0.25,0.6}\r\n        if move == true then\r\n            color = colorMove\r\n        end\r\n        self.editButton({index=index, color=color})\r\n        theList[obj.getGUID()] = nil\r\n        obj.highlightOff()\r\n    end\r\nend\r\n\r\nfunction editDragSelection(bagObj, player, remove)\r\n    local selectedObjs = Player[player].getSelectedObjects()\r\n    if not remove then\r\n        for _, obj in ipairs(selectedObjs) do\r\n            local index = buttonIndexMap[obj.getGUID()]\r\n            --Ignore if already in the memory list, or does not have a button\r\n            if index and not memoryList[obj.getGUID()] then\r\n                self.editButton({index=index, color={0,1,0,0.6}})\r\n                --Adding pos/rot to memory table\r\n                local pos, rot = obj.getPosition(), obj.getRotation()\r\n                --I need to add it like this or it won't save due to indexing issue\r\n                memoryList[obj.getGUID()] = {\r\n                    pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n                    rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n                    lock=obj.getLock(),\r\n                    tint=obj.getColorTint()\r\n                }\r\n                obj.highlightOn({0,1,0})\r\n            end\r\n        end\r\n    else\r\n        for _, obj in ipairs(selectedObjs) do\r\n            local index = buttonIndexMap[obj.getGUID()]\r\n            if index and memoryList[obj.getGUID()] then\r\n                color = {0.75,0.25,0.25,0.6}\r\n                self.editButton({index=index, color=color})\r\n                memoryList[obj.getGUID()] = nil\r\n                obj.highlightOff()\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\n--Cancels selection process\r\nfunction buttonClick_cancel()\r\n    memoryList = memoryListBackup\r\n    moveList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    if next(memoryList) == nil then\r\n        createSetupButton()\r\n    else\r\n        createMemoryActionButtons()\r\n    end\r\n    removeAllHighlights()\r\n    broadcastToAll(\"Sélection annulée\", {1,1,1})\r\n    moveGuid = nil\r\nend\r\n\r\n--Saves selections\r\nfunction buttonClick_submit()\r\n    fresh = false\r\n    if next(moveList) ~= nil then\r\n        for guid in pairs(moveList) do\r\n            moveGuid = guid\r\n        end\r\n        if memoryListBackup[moveGuid] == nil then\r\n            broadcastToAll(\"Item selected for moving is not already in memory\", {1, 0.25, 0.25})\r\n        else\r\n            broadcastToAll(\"Moving all items in memory relative to new objects position!\", {0.75, 0.75, 1})\r\n            self.clearButtons()\r\n            self.clearInputs()\r\n            createMemoryActionButtons()\r\n            local count = 0\r\n            for guid in pairs(moveList) do\r\n                moveGuid = guid\r\n                count = count + 1\r\n                local obj = getObjectFromGUID(guid)\r\n                if obj ~= nil then obj.highlightOff() end\r\n            end\r\n            updateMemoryWithMoves()\r\n            updateSave()\r\n            buttonClick_place()\r\n        end\r\n    elseif next(memoryList) == nil and moveGuid == nil then\r\n        memoryList = memoryListBackup\r\n        broadcastToAll(\"No selections made.\", {0.75, 0.25, 0.25})\r\n    end\r\n    combineMemoryFromBagsWithin()\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    updateSave()\r\n    moveGuid = nil\r\nend\r\n\r\nfunction combineTables(first_table, second_table)\r\n    for k,v in pairs(second_table) do first_table[k] = v end\r\nend\r\n\r\nfunction buttonClick_add()\r\n    fresh = false\r\n    combineTables(memoryList, memoryListBackup)\r\n    broadcastToAll(\"Adding internal bags and selections to existing memory\", {0.25, 0.75, 0.25})\r\n    combineMemoryFromBagsWithin()\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    updateSave()\r\nend\r\n\r\nfunction buttonClick_remove()\r\n    broadcastToAll(\"Removing Selected Entries From Memory\", {1.0, 0.25, 0.25})\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for guid in pairs(memoryList) do\r\n        count = count + 1\r\n        memoryListBackup[guid] = nil\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then obj.highlightOff() end\r\n    end\r\n    broadcastToAll(count..\" Objects Removed\", {1,1,1})\r\n    memoryList = memoryListBackup\r\n    updateSave()\r\nend\r\n\r\nfunction buttonClick_setNew()\r\n    broadcastToAll(\"Setting new position relative to items in memory\", {0.75, 0.75, 1})\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createMemoryActionButtons()\r\n    local count = 0\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        guid = obj.guid\r\n        if memoryListBackup[guid] ~= nil then\r\n            count = count + 1\r\n            memoryListBackup[guid].pos = obj.getPosition()\r\n            memoryListBackup[guid].rot = obj.getRotation()\r\n            memoryListBackup[guid].lock = obj.getLock()\r\n            memoryListBackup[guid].tint = obj.getColorTint()\r\n        end\r\n    end\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n    memoryList = memoryListBackup\r\n    updateSave()\r\nend\r\n\r\n--Resets bag to starting status\r\nfunction buttonClick_reset()\r\n    fresh = true\r\n    memoryList = {}\r\n    self.clearButtons()\r\n    self.clearInputs()\r\n    createSetupButton()\r\n    removeAllHighlights()\r\n    broadcastToAll(\"Tool Reset\", {1,1,1})\r\n    updateSave()\r\nend\r\n\r\n\r\n--After Setup\r\n\r\n\r\n--Creates recall and place buttons\r\nfunction createMemoryActionButtons()\r\n    self.createButton({\r\n        label=\"Placer\", click_function=\"buttonClick_place\", function_owner=self,\r\n        position={0,0.3,2}, rotation={0,0,0}, height=350, width=1000,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    self.createButton({\r\n        label=\"Ranger\", click_function=\"buttonClick_recall\", function_owner=self,\r\n        position={0,0.3,2.8}, rotation={0,0,0}, height=350, width=1000,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    self.createButton({\r\n        label=\"Config\", click_function=\"buttonClick_setup\", function_owner=self,\r\n        position={2,0.3,0}, rotation={0,90,0}, height=350, width=800,\r\n        font_size=250, color={0,0,0}, font_color={1,1,1}\r\n    })\r\n    ---    self.createButton({\r\n    ---      label=\"Bouger\", click_function=\"buttonClick_transpose\", function_owner=self,\r\n    ---      position={-2,0.3,0.8}, rotation={0,270,0}, height=350, width=800,\r\n    ---      font_size=250, color={0,0,0}, font_color={0.75,0.75,1}\r\n    ---  \r\nend\r\n\r\n--Sends objects from bag/table to their saved position/rotation\r\nfunction buttonClick_place()\r\n    local bagObjList = self.getObjects()\r\n    for guid, entry in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        --If obj is out on the table, move it to the saved pos/rot\r\n        if obj ~= nil then\r\n            obj.setPositionSmooth(entry.pos)\r\n            obj.setRotationSmooth(entry.rot)\r\n            obj.setLock(entry.lock)\r\n            obj.setColorTint(entry.tint)\r\n        else\r\n            --If obj is inside of the bag\r\n            for _, bagObj in ipairs(bagObjList) do\r\n                if bagObj.guid == guid then\r\n                    local item = self.takeObject({\r\n                        guid=guid, position=entry.pos, rotation=entry.rot, smooth=false\r\n                    })\r\n                    item.setLock(entry.lock)\r\n                    item.setColorTint(entry.tint)\r\n                    break\r\n                end\r\n            end\r\n        end\r\n    end\r\n    broadcastToAll(\"Objets placés\", {1,1,1})\r\nend\r\n\r\n--Recalls objects to bag from table\r\nfunction buttonClick_recall()\r\n    for guid, entry in pairs(memoryList) do\r\n        local obj = getObjectFromGUID(guid)\r\n        if obj ~= nil then self.putObject(obj) end\r\n    end\r\n    broadcastToAll(\"Objets rangés\", {1,1,1})\r\nend\r\n\r\n\r\n--Utility functions\r\n\r\n\r\n--Find delta (difference) between 2 x/y/z coordinates\r\nfunction findOffsetDistance(p1, p2, obj)\r\n    local yOffset = 0\r\n    if obj ~= nil then\r\n        local bounds = obj.getBounds()\r\n        yOffset = (bounds.size.y - bounds.offset.y)\r\n    end\r\n    local deltaPos = {}\r\n    deltaPos.x = (p2.x-p1.x)\r\n    deltaPos.y = (p2.y-p1.y) + yOffset\r\n    deltaPos.z = (p2.z-p1.z)\r\n    return deltaPos\r\nend\r\n\r\n--Used to rotate a set of coordinates by an angle\r\nfunction rotateLocalCoordinates(desiredPos, obj)\r\n    local objPos, objRot = obj.getPosition(), obj.getRotation()\r\n    local angle = math.rad(objRot.y)\r\n    local x = desiredPos.x * math.cos(angle) - desiredPos.z * math.sin(angle)\r\n    local z = desiredPos.x * math.sin(angle) + desiredPos.z * math.cos(angle)\r\n    --return {x=objPos.x+x, y=objPos.y+desiredPos.y, z=objPos.z+z}\r\n    return {x=x, y=desiredPos.y, z=z}\r\nend\r\n\r\nfunction rotateMyCoordinates(desiredPos, obj)\r\n    local angle = math.rad(obj.getRotation().y)\r\n    local x = desiredPos.x * math.sin(angle)\r\n    local z = desiredPos.z * math.cos(angle)\r\n    return {x=x, y=desiredPos.y, z=z}\r\nend\r\n\r\n--Coroutine delay, in seconds\r\nfunction wait(time)\r\n    local start = os.time()\r\n    repeat coroutine.yield(0) until os.time() > start + time\r\nend\r\n\r\n--Duplicates a table (needed to prevent it making reference to the same objects)\r\nfunction duplicateTable(oldTable)\r\n    local newTable = {}\r\n    for k, v in pairs(oldTable) do\r\n        newTable[k] = v\r\n    end\r\n    return newTable\r\nend\r\n\r\n--Moves scripted highlight from all objects\r\nfunction removeAllHighlights()\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        obj.highlightOff()\r\n    end\r\nend\r\n\r\n--Round number (num) to the Nth decimal (dec)\r\nfunction round(num, dec)\r\n    local mult = 10^(dec or 0)\r\n    return math.floor(num * mult + 0.5) / mult\r\nend\r\n\r\n\r\n--[[\r\nThis object provides access to a variable stored on the \"Global script\".\r\nThe variable holds the GUIDs for every Utility Memory Bag in the scene.\r\nExample:\r\n{'805ebd', '35cc21', 'fc8886', 'f50264', '5f5f63'}\r\n--]]\r\nAllMemoryBagsInScene = {\r\n    NAME_OF_GLOBAL_VARIABLE = \"_UtilityMemoryBag_AllMemoryBagsInScene\"\r\n}\r\n\r\nfunction AllMemoryBagsInScene:add(guid)\r\n    local guids = Global.getTable(self.NAME_OF_GLOBAL_VARIABLE) or {}\r\n    table.insert(guids, guid)\r\n    Global.setTable(self.NAME_OF_GLOBAL_VARIABLE, guids)\r\nend\r\n\r\nfunction AllMemoryBagsInScene:getGuidList()\r\n    return Global.getTable(self.NAME_OF_GLOBAL_VARIABLE) or {}\r\nend","LuaScriptState":"{\"ml\":{\"32a399\":{\"lock\":false,\"pos\":{\"x\":17.5,\"y\":1.5419,\"z\":-5.9999},\"rot\":{\"x\":-0.0001,\"y\":89.9997,\"z\":0},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"7e350d\":{\"lock\":false,\"pos\":{\"x\":17.5039,\"y\":1.536,\"z\":-6.0055},\"rot\":{\"x\":0.0049,\"y\":89.9244,\"z\":359.9891},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}},\"92575b\":{\"lock\":false,\"pos\":{\"x\":35,\"y\":1.558,\"z\":1.5},\"rot\":{\"x\":0.0011,\"y\":90.0005,\"z\":0.0006},\"tint\":{\"a\":1,\"b\":0.713235259056091,\"g\":0.713235259056091,\"r\":0.713235259056091}}}}","XmlUI":"","ContainedObjects":[{"GUID":"7e350d","Name":"Deck","Transform":{"posX":17.5038986,"posY":1.53599882,"posZ":-6.0054965,"rotX":0.00493364967,"rotY":89.92453,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Deck acte groupe unique","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":true,"DeckIDs":[306607,306305,306604],"CustomDeck":{"3063":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0},"3066":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"45dd3f","Name":"Card","Transform":{"posX":-17.99997,"posY":5.056076,"posZ":23.00003,"rotX":3.94496666e-8,"rotY":89.9811,"rotZ":0.000004928578,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85009\",\n  \"type\": \"Act\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306607,"SidewaysCard":true,"CustomDeck":{"3066":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"25f5a1","Name":"Card","Transform":{"posX":-17.99997,"posY":4.85607624,"posZ":23.00003,"rotX":3.94496666e-8,"rotY":89.9811,"rotZ":0.000004928578,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85007\",\n  \"type\": \"Act\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306305,"SidewaysCard":true,"CustomDeck":{"3063":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"0bfcb3","Name":"Card","Transform":{"posX":-17.99997,"posY":1.87731171,"posZ":23.00003,"rotX":0.002184521,"rotY":89.9811,"rotZ":-0.00276014861,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"clueThresholdPerInvestigator\": 2,\n  \"cycle\": \"Standalone\",\n  \"id\": \"85006\",\n  \"type\": \"Act\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306604,"SidewaysCard":true,"CustomDeck":{"3066":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"92575b","Name":"Card","Transform":{"posX":35,"posY":1.55799925,"posZ":1.5,"rotX":0.00107024494,"rotY":90.0005,"rotZ":0.000591136457,"scaleX":1.64563763,"scaleY":1,"scaleZ":1.64563763},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"health\": 15,\n  \"healthPerInv\": \"true\",\n  \"id\": \"85038\",\n  \"traits\": \"Monster. Ooze. Elite.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306509,"SidewaysCard":true,"CustomDeck":{"3065":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"6345b1","Name":"Custom_Tile","Transform":{"posX":5.99999857,"posY":1.50627816,"posZ":18.5000038,"rotX":0.0108933412,"rotY":179.980438,"rotZ":0.004948306,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"6978c3","Name":"Deck","Transform":{"posX":-23.00004,"posY":1.80067372,"posZ":6.99995041,"rotX":-0.000005153664,"rotY":180.001038,"rotZ":1.26295943e-8,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":false,"DeckIDs":[306905,306906,306904],"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"908313","Name":"Card","Transform":{"posX":-23.0000458,"posY":4.85607767,"posZ":6.999938,"rotX":-0.00000494218739,"rotY":180.00119,"rotZ":8.959296e-8,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 1,\n  \"id\": \"85033\",\n  \"traits\": \"Monster. Mi-Go.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306905,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"9f2f1f","Name":"Card","Transform":{"posX":-23.0000458,"posY":5.05607748,"posZ":6.999938,"rotX":-0.00000494218739,"rotY":180.00119,"rotZ":8.959296e-8,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 1,\n  \"id\": \"85033\",\n  \"traits\": \"Monster. Mi-Go.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306906,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"8eb8e2","Name":"Card","Transform":{"posX":-23.0000458,"posY":1.87731957,"posZ":6.999938,"rotX":-0.00234442041,"rotY":180.00119,"rotZ":-0.00102073385,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 1,\n  \"id\": \"85033\",\n  \"traits\": \"Monster. Mi-Go.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306904,"SidewaysCard":false,"CustomDeck":{"3069":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"69fd89","Name":"Custom_Tile","Transform":{"posX":14.9999981,"posY":1.50550091,"posZ":18.5000038,"rotX":0.010892381,"rotY":179.991577,"rotZ":0.0049503604,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"6fffbd","Name":"Custom_Model","Transform":{"posX":-24.5,"posY":1.7663,"posZ":12.5,"rotX":0,"rotY":-0.0001,"rotZ":0,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Text Tool","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0,"g":0,"b":0,"a":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":false,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":false,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomMesh":{"MeshURL":"http://cloud-3.steamusercontent.com/ugc/1478820768302617365/27883B7913E0E69143C3AA03493B7E7C4E8C29C0/","DiffuseURL":"","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":1,"TypeIndex":0,"CastShadows":true},"LuaScript":"-- Code for bag to identify text tool objects\r\nmovableTextTool_cowgoesmoo33 = true\r\n\r\n-- Number of characters before the text box width expands.\r\nEXPAND_INTERVAL = 20\r\n\r\n-- This table controls what is passed between save/load\r\ndata = {}\r\n\r\nfunction onLoad(saved_data)\r\n  if saved_data ~= '' then\r\n    data = JSON.decode(saved_data)\r\n    if data.text ~= '' then\r\n      self.interactable = data.interactable\r\n      staticMode()\r\n      return\r\n    end\r\n  else\r\n    data = {size=200, color=Color(0,0,0), text='', interactable=true,\r\n        enter_to_finish=false, autolock=false, autolift=false,\r\n        hover_height=0.05, box_transparency=1}\r\n  end\r\n\r\n  inputMode()\r\nend\r\n\r\n-- True if in the middle of delay after pressing Enter (with enter_to_finish on)\r\nfinishing = false\r\nfunction input_func(obj, color, input, stillEditing)\r\n  local params = getBox(input)\r\n  if params then\r\n    params.value = input\r\n    self.editInput(params)\r\n  end\r\n\r\n  if not stillEditing then\r\n    data.text = input\r\n    updateState()\r\n    if input ~= '' then staticMode(color) end\r\n  elseif data.enter_to_finish then\r\n    -- If enter is pressed: remove last newline and force finish\r\n    if not finishing and input:sub(-1) == '\\n' then\r\n      finishing = true\r\n      -- Delay to avoid user's Enter keypress being detected (opens chat box)\r\n      Wait.frames(function()\r\n        input = input:sub(1, -2)\r\n        data.text = input\r\n        updateState()\r\n        if input ~= '' then staticMode(color) else inputMode() end\r\n        finishing = false\r\n      end, 10)\r\n    end\r\n  end\r\nend\r\n\r\n-- When the inpupt box appears and lets the player type in it.\r\nfunction inputMode()\r\n  self.clearContextMenu()\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n\r\n  local size = getBox(data.text, true)\r\n\r\n  self.createInput({\r\n    input_function = \"input_func\",\r\n    function_owner = self,\r\n    label          = \"Type Here\",\r\n    alignment      = 3,\r\n    position       = {x=0, y=data.hover_height, z=0},\r\n    rotation       = {0, 180, 0},\r\n    width          = size.width,\r\n    height         = size.height,\r\n    color          = getBackground(data.color),\r\n    font_color     = data.color,\r\n    font_size      = data.size,\r\n    value          = data.text,\r\n  })\r\n\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\nend\r\n\r\n-- When the input box disappears and displays the text.\r\nfunction staticMode(player)\r\n  self.clearContextMenu()\r\n  if data.autolock then\r\n    self.locked = true\r\n  end\r\n  if self.getInputs() and #self.getInputs() ~= 0 then\r\n    self.removeInput(0)\r\n  end\r\n\r\n  -- Clear from selecting player\r\n  if player then\r\n    self.removeFromPlayerSelection(player)\r\n  end\r\n\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  self.createButton({\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=self,\r\n    position={0,data.hover_height,0}, rotation={0,180,0}, height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  })\r\n\r\n  self.addContextMenuItem('Edit Text', function(color)\r\n    self.removeFromPlayerSelection(color)\r\n    inputMode()\r\n  end)\r\n  self.addContextMenuItem('Clear', function(color)\r\n    applyMultiple(color, 'clear', _, true)\r\n  end)\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\n  self.addContextMenuItem('Permanently Attach', attemptAttach)\r\n  self.addContextMenuItem('Permalock', function(color)\r\n    applyMultiple(color, 'permalock', _, true)\r\n  end)\r\nend\r\n\r\nfunction changeSize(params)\r\n  local delta = params[1]\r\n  local newSize = data.size + delta\r\n  if newSize > 800  or newSize < 50 then\r\n    return\r\n  end\r\n  data.size = newSize\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_size=data.size})\r\n  else\r\n    local size = getBox(data.text, true)\r\n    self.editInput({width=size.width, height=size.height, font_size=data.size})\r\n  end\r\nend\r\n\r\nfunction setColor(params)\r\n  if params and params[1] then\r\n    data.color = params[1]\r\n  else\r\n    data.color = self.getColorTint():setAt('a', 1) -- Take on color of object tint\r\n  end\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_color=data.color})\r\n  else\r\n    self.editInput({font_color=data.color, color=getBackground(data.color)})\r\n  end\r\nend\r\n\r\nfunction getBackground(color) --determines whether to use black or white depending on luminance\r\n  local r,g,b = Color(color):get()\r\n\r\n  local lum = 0.2126*r + 0.7152*g + 0.0722*b\r\n  if lum > 0.75 then\r\n    return {0.2,0.2,0.2, data.box_transparency}\r\n  else\r\n    return {1,1,1, data.box_transparency}\r\n  end\r\nend\r\n\r\nfunction clear()\r\n  data.text = ''\r\n  updateState()\r\n  inputMode()\r\nend\r\n\r\nfunction permalock()\r\n  self.interactable = false\r\n  data.interactable = false\r\n  updateState()\r\nend\r\n\r\nlocal target_script = [[\r\nfunction onLoad(script_state)\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    for _,entry in ipairs(state) do\r\n      self.createButton(entry)\r\n    end\r\n    self.addContextMenuItem('Clear All Text', function(color)\r\n      self.clearContextMenu()\r\n      self.clearButtons()\r\n      self.script_state = ''\r\n      self.script_code = ''\r\n    end)\r\n  end\r\nend\r\n]]\r\n\r\nfunction attemptAttach(player_color)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  local attachee\r\n  local attachers = {}\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if obj ~= self then\r\n        table.insert(attachers, obj)\r\n      end\r\n    else\r\n      if attachee then\r\n        broadcastToColor(\"More than one target selected.\", player_color)\r\n        return\r\n      else\r\n        attachee = obj\r\n      end\r\n    end\r\n  end\r\n  if attachee then\r\n    local code = attachee.script_code\r\n    if code and code ~= '' and code ~= target_script then\r\n      broadcastToColor(\"Warning: script on card has been overriden. Rewind time to undo.\", player_color)\r\n    end\r\n    for i,attacher in ipairs(attachers) do\r\n      attacher.call('attach', {target = attachee})\r\n    end\r\n    attach({target = attachee})\r\n    local type, flip = attachee.type, attachee.getRotation().z\r\n    if (type == 'Card' or type == 'Deck') and flip > 175 and flip < 185 then\r\n      broadcastToColor(\"Warning: text will not display if card or deck is facing down.\", player_color)\r\n    end\r\n  else\r\n    broadcastToColor(\"You must have a target object in your selection (using click-and-drag or Ctrl+Click) to use this option.\", player_color)\r\n  end\r\nend\r\n\r\nfunction attach(params)\r\n  local target = params.target\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  local textRotation = self.getRotation():sub(target.getRotation())\r\n    :add(Vector(180, 0, 180))\r\n\r\n  local textPosition = target.positionToLocal(\r\n    self.getPosition():add(Vector(0, data.hover_height, 0))\r\n  )\r\n  textPosition.x = -textPosition.x\r\n\r\n  local textScale = {}\r\n  textScale.x = self.getScale().x / target.getScale().x\r\n  textScale.y = self.getScale().x / target.getScale().y\r\n  textScale.z = self.getScale().x / target.getScale().z\r\n\r\n  local details = {\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=nil,\r\n    position=textPosition,\r\n    rotation=textRotation,\r\n    scale=textScale,\r\n    height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  }\r\n\r\n  target.createButton(details)\r\n\r\n  local script_state = target.script_state\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    table.insert(state, details)\r\n    target.script_state = JSON.encode(state)\r\n  else\r\n    target.script_state = JSON.encode({[1]=details})\r\n  end\r\n\r\n  target.script_code = target_script\r\n\r\n  self.destruct()\r\nend\r\n\r\nfunction applyMultiple(player_color, func_string, params, static_only)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if not static_only or obj.call('isStatic') then\r\n        obj.call(func_string, params)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction isStatic()\r\n  local input = self.getInputs()\r\n  return not input or #input == 0\r\nend\r\n\r\nfunction getBox(input, force)\r\n  local maxLength, lineCount = EXPAND_INTERVAL, 1\r\n  local lineLength = 0\r\n  for i = 1, #input do\r\n    local c = input:sub(i,i)\r\n    if c == '\\n' then\r\n      lineCount = lineCount + 1\r\n      if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n      lineLength = 0\r\n    else\r\n      lineLength = lineLength + 1\r\n    end\r\n  end\r\n  if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n\r\n  newWidth = data.size * maxLength * 0.9\r\n  newHeight = data.size * lineCount + 23\r\n\r\n  if force or boxWidth ~= newWidth or boxHeight ~= newHeight then\r\n    boxWidth, boxHeight = newWidth, newHeight\r\n    return {width = boxWidth, height = boxHeight}\r\n  end\r\n  return nil\r\nend\r\n\r\ntemp_lift = nil\r\nfunction onPickUp(player_color)\r\n  if data.autolift then\r\n    local player = Player[player_color]\r\n    temp_lift = player.lift_height\r\n    player.lift_height = 0\r\n  end\r\nend\r\n\r\nfunction onDrop(player_color)\r\n  if data.autolift and temp_lift then\r\n    Player[player_color].lift_height = temp_lift\r\n  end\r\nend\r\n\r\n-- Should be called every time data is modified, allows info to be saved on copy/paste\r\nfunction updateState()\r\n  self.script_state = JSON.encode(data)\r\nend\r\n\r\nfunction onSave()\r\n  self.script_state = JSON.encode(data)\r\n  return self.script_state\r\nend","LuaScriptState":"{\"autolift\":false,\"autolock\":false,\"box_transparency\":1,\"color\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1},\"enter_to_finish\":false,\"hover_height\":0.05,\"interactable\":true,\"size\":550,\"text\":\"2)\"}","XmlUI":""},{"GUID":"700c1f","Name":"CardCustom","Transform":{"posX":-3.000005,"posY":1.51989973,"posZ":14.5000038,"rotX":0.0108901411,"rotY":180.015686,"rotZ":0.00495116645,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"703535","Name":"Card","Transform":{"posX":6.00001049,"posY":1.51912248,"posZ":14.5000038,"rotX":0.0108889826,"rotY":180.02977,"rotZ":0.00495394459,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85010\",\n  \"locationBack\": {\n    \"connections\": \"\",\n    \"icons\": \"\",\n    \"uses\": {\n      \"countPerInvestigator\": 2,\n      \"token\": \"clue\",\n      \"type\": \"Clue\"\n    }\n  },\n  \"traits\": \"Oozified.\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306201,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"71210c","Name":"Custom_Tile","Transform":{"posX":19.4999981,"posY":1.50435185,"posZ":14.5000029,"rotX":0.00494620949,"rotY":89.99167,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"7234af","Name":"Custom_Tile","Transform":{"posX":5.99999857,"posY":1.5047574,"posZ":10.5000038,"rotX":0.0108929239,"rotY":179.985779,"rotZ":0.004949215,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"81cac9","Name":"CardCustom","Transform":{"posX":15,"posY":1.51672935,"posZ":6.00000334,"rotX":0.01089071,"rotY":180.01062,"rotZ":0.004950281,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"8431e1","Name":"CardCustom","Transform":{"posX":24,"posY":1.517568,"posZ":14.5000029,"rotX":0.0108917784,"rotY":179.9973,"rotZ":0.00494762976,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"88e8cf","Name":"Custom_Tile","Transform":{"posX":-3.00000143,"posY":1.5070554,"posZ":18.5000038,"rotX":0.0108919395,"rotY":179.995636,"rotZ":0.004951042,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"89ac42","Name":"Custom_Model","Transform":{"posX":-32.5,"posY":1.7663,"posZ":17,"rotX":0,"rotY":0.0005,"rotZ":0,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Text Tool","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0,"g":0,"b":0,"a":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":false,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":false,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomMesh":{"MeshURL":"http://cloud-3.steamusercontent.com/ugc/1478820768302617365/27883B7913E0E69143C3AA03493B7E7C4E8C29C0/","DiffuseURL":"","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":1,"TypeIndex":0,"CastShadows":true},"LuaScript":"-- Code for bag to identify text tool objects\r\nmovableTextTool_cowgoesmoo33 = true\r\n\r\n-- Number of characters before the text box width expands.\r\nEXPAND_INTERVAL = 20\r\n\r\n-- This table controls what is passed between save/load\r\ndata = {}\r\n\r\nfunction onLoad(saved_data)\r\n  if saved_data ~= '' then\r\n    data = JSON.decode(saved_data)\r\n    if data.text ~= '' then\r\n      self.interactable = data.interactable\r\n      staticMode()\r\n      return\r\n    end\r\n  else\r\n    data = {size=200, color=Color(0,0,0), text='', interactable=true,\r\n        enter_to_finish=false, autolock=false, autolift=false,\r\n        hover_height=0.05, box_transparency=1}\r\n  end\r\n\r\n  inputMode()\r\nend\r\n\r\n-- True if in the middle of delay after pressing Enter (with enter_to_finish on)\r\nfinishing = false\r\nfunction input_func(obj, color, input, stillEditing)\r\n  local params = getBox(input)\r\n  if params then\r\n    params.value = input\r\n    self.editInput(params)\r\n  end\r\n\r\n  if not stillEditing then\r\n    data.text = input\r\n    updateState()\r\n    if input ~= '' then staticMode(color) end\r\n  elseif data.enter_to_finish then\r\n    -- If enter is pressed: remove last newline and force finish\r\n    if not finishing and input:sub(-1) == '\\n' then\r\n      finishing = true\r\n      -- Delay to avoid user's Enter keypress being detected (opens chat box)\r\n      Wait.frames(function()\r\n        input = input:sub(1, -2)\r\n        data.text = input\r\n        updateState()\r\n        if input ~= '' then staticMode(color) else inputMode() end\r\n        finishing = false\r\n      end, 10)\r\n    end\r\n  end\r\nend\r\n\r\n-- When the inpupt box appears and lets the player type in it.\r\nfunction inputMode()\r\n  self.clearContextMenu()\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n\r\n  local size = getBox(data.text, true)\r\n\r\n  self.createInput({\r\n    input_function = \"input_func\",\r\n    function_owner = self,\r\n    label          = \"Type Here\",\r\n    alignment      = 3,\r\n    position       = {x=0, y=data.hover_height, z=0},\r\n    rotation       = {0, 180, 0},\r\n    width          = size.width,\r\n    height         = size.height,\r\n    color          = getBackground(data.color),\r\n    font_color     = data.color,\r\n    font_size      = data.size,\r\n    value          = data.text,\r\n  })\r\n\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\nend\r\n\r\n-- When the input box disappears and displays the text.\r\nfunction staticMode(player)\r\n  self.clearContextMenu()\r\n  if data.autolock then\r\n    self.locked = true\r\n  end\r\n  if self.getInputs() and #self.getInputs() ~= 0 then\r\n    self.removeInput(0)\r\n  end\r\n\r\n  -- Clear from selecting player\r\n  if player then\r\n    self.removeFromPlayerSelection(player)\r\n  end\r\n\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  self.createButton({\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=self,\r\n    position={0,data.hover_height,0}, rotation={0,180,0}, height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  })\r\n\r\n  self.addContextMenuItem('Edit Text', function(color)\r\n    self.removeFromPlayerSelection(color)\r\n    inputMode()\r\n  end)\r\n  self.addContextMenuItem('Clear', function(color)\r\n    applyMultiple(color, 'clear', _, true)\r\n  end)\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\n  self.addContextMenuItem('Permanently Attach', attemptAttach)\r\n  self.addContextMenuItem('Permalock', function(color)\r\n    applyMultiple(color, 'permalock', _, true)\r\n  end)\r\nend\r\n\r\nfunction changeSize(params)\r\n  local delta = params[1]\r\n  local newSize = data.size + delta\r\n  if newSize > 800  or newSize < 50 then\r\n    return\r\n  end\r\n  data.size = newSize\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_size=data.size})\r\n  else\r\n    local size = getBox(data.text, true)\r\n    self.editInput({width=size.width, height=size.height, font_size=data.size})\r\n  end\r\nend\r\n\r\nfunction setColor(params)\r\n  if params and params[1] then\r\n    data.color = params[1]\r\n  else\r\n    data.color = self.getColorTint():setAt('a', 1) -- Take on color of object tint\r\n  end\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_color=data.color})\r\n  else\r\n    self.editInput({font_color=data.color, color=getBackground(data.color)})\r\n  end\r\nend\r\n\r\nfunction getBackground(color) --determines whether to use black or white depending on luminance\r\n  local r,g,b = Color(color):get()\r\n\r\n  local lum = 0.2126*r + 0.7152*g + 0.0722*b\r\n  if lum > 0.75 then\r\n    return {0.2,0.2,0.2, data.box_transparency}\r\n  else\r\n    return {1,1,1, data.box_transparency}\r\n  end\r\nend\r\n\r\nfunction clear()\r\n  data.text = ''\r\n  updateState()\r\n  inputMode()\r\nend\r\n\r\nfunction permalock()\r\n  self.interactable = false\r\n  data.interactable = false\r\n  updateState()\r\nend\r\n\r\nlocal target_script = [[\r\nfunction onLoad(script_state)\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    for _,entry in ipairs(state) do\r\n      self.createButton(entry)\r\n    end\r\n    self.addContextMenuItem('Clear All Text', function(color)\r\n      self.clearContextMenu()\r\n      self.clearButtons()\r\n      self.script_state = ''\r\n      self.script_code = ''\r\n    end)\r\n  end\r\nend\r\n]]\r\n\r\nfunction attemptAttach(player_color)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  local attachee\r\n  local attachers = {}\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if obj ~= self then\r\n        table.insert(attachers, obj)\r\n      end\r\n    else\r\n      if attachee then\r\n        broadcastToColor(\"More than one target selected.\", player_color)\r\n        return\r\n      else\r\n        attachee = obj\r\n      end\r\n    end\r\n  end\r\n  if attachee then\r\n    local code = attachee.script_code\r\n    if code and code ~= '' and code ~= target_script then\r\n      broadcastToColor(\"Warning: script on card has been overriden. Rewind time to undo.\", player_color)\r\n    end\r\n    for i,attacher in ipairs(attachers) do\r\n      attacher.call('attach', {target = attachee})\r\n    end\r\n    attach({target = attachee})\r\n    local type, flip = attachee.type, attachee.getRotation().z\r\n    if (type == 'Card' or type == 'Deck') and flip > 175 and flip < 185 then\r\n      broadcastToColor(\"Warning: text will not display if card or deck is facing down.\", player_color)\r\n    end\r\n  else\r\n    broadcastToColor(\"You must have a target object in your selection (using click-and-drag or Ctrl+Click) to use this option.\", player_color)\r\n  end\r\nend\r\n\r\nfunction attach(params)\r\n  local target = params.target\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  local textRotation = self.getRotation():sub(target.getRotation())\r\n    :add(Vector(180, 0, 180))\r\n\r\n  local textPosition = target.positionToLocal(\r\n    self.getPosition():add(Vector(0, data.hover_height, 0))\r\n  )\r\n  textPosition.x = -textPosition.x\r\n\r\n  local textScale = {}\r\n  textScale.x = self.getScale().x / target.getScale().x\r\n  textScale.y = self.getScale().x / target.getScale().y\r\n  textScale.z = self.getScale().x / target.getScale().z\r\n\r\n  local details = {\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=nil,\r\n    position=textPosition,\r\n    rotation=textRotation,\r\n    scale=textScale,\r\n    height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  }\r\n\r\n  target.createButton(details)\r\n\r\n  local script_state = target.script_state\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    table.insert(state, details)\r\n    target.script_state = JSON.encode(state)\r\n  else\r\n    target.script_state = JSON.encode({[1]=details})\r\n  end\r\n\r\n  target.script_code = target_script\r\n\r\n  self.destruct()\r\nend\r\n\r\nfunction applyMultiple(player_color, func_string, params, static_only)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if not static_only or obj.call('isStatic') then\r\n        obj.call(func_string, params)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction isStatic()\r\n  local input = self.getInputs()\r\n  return not input or #input == 0\r\nend\r\n\r\nfunction getBox(input, force)\r\n  local maxLength, lineCount = EXPAND_INTERVAL, 1\r\n  local lineLength = 0\r\n  for i = 1, #input do\r\n    local c = input:sub(i,i)\r\n    if c == '\\n' then\r\n      lineCount = lineCount + 1\r\n      if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n      lineLength = 0\r\n    else\r\n      lineLength = lineLength + 1\r\n    end\r\n  end\r\n  if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n\r\n  newWidth = data.size * maxLength * 0.9\r\n  newHeight = data.size * lineCount + 23\r\n\r\n  if force or boxWidth ~= newWidth or boxHeight ~= newHeight then\r\n    boxWidth, boxHeight = newWidth, newHeight\r\n    return {width = boxWidth, height = boxHeight}\r\n  end\r\n  return nil\r\nend\r\n\r\ntemp_lift = nil\r\nfunction onPickUp(player_color)\r\n  if data.autolift then\r\n    local player = Player[player_color]\r\n    temp_lift = player.lift_height\r\n    player.lift_height = 0\r\n  end\r\nend\r\n\r\nfunction onDrop(player_color)\r\n  if data.autolift and temp_lift then\r\n    Player[player_color].lift_height = temp_lift\r\n  end\r\nend\r\n\r\n-- Should be called every time data is modified, allows info to be saved on copy/paste\r\nfunction updateState()\r\n  self.script_state = JSON.encode(data)\r\nend\r\n\r\nfunction onSave()\r\n  self.script_state = JSON.encode(data)\r\n  return self.script_state\r\nend","LuaScriptState":"{\"autolift\":false,\"autolock\":false,\"box_transparency\":1,\"color\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1},\"enter_to_finish\":false,\"hover_height\":0.05,\"interactable\":true,\"size\":200,\"text\":\"QG, Site de recherche\\n + 2 Zones de Quarantaine\"}","XmlUI":""},{"GUID":"997e6e","Name":"Deck","Transform":{"posX":12.500021,"posY":1.536432,"posZ":-5.99999142,"rotX":0.00494895363,"rotY":90.00443,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":true,"DeckIDs":[306302,306301,306300],"CustomDeck":{"3063":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"e57352","Name":"Card","Transform":{"posX":12.5000191,"posY":4.791836,"posZ":-6.00000048,"rotX":0.004948904,"rotY":90.0046,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"doomThreshold\": 8,\n  \"id\": \"85004\",\n  \"type\": \"Agenda\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306302,"SidewaysCard":true,"CustomDeck":{"3063":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"10fa6a","Name":"Card","Transform":{"posX":12.5000191,"posY":4.5918355,"posZ":-6.00000048,"rotX":0.004948904,"rotY":90.0046,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"doomThreshold\": 6,\n  \"id\": \"85003\",\n  \"type\": \"Agenda\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306301,"SidewaysCard":true,"CustomDeck":{"3063":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"c6e297","Name":"Card","Transform":{"posX":12.5000257,"posY":1.61307788,"posZ":-6.00001574,"rotX":0.0026118746,"rotY":90.0046,"rotZ":359.988068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"doomThreshold\": 6,\n  \"id\": \"85002\",\n  \"type\": \"Agenda\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306300,"SidewaysCard":true,"CustomDeck":{"3063":{"FaceURL":"https://i.imgur.com/s5wnaQ5.jpg","BackURL":"https://i.imgur.com/s61HRxI.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"9ab76d","Name":"Card","Transform":{"posX":-33.58,"posY":1.77890444,"posZ":19.4884129,"rotX":-7.163847e-7,"rotY":180.160156,"rotZ":-0.00002722331,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85011\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306202,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"9cae28","Name":"Card","Transform":{"posX":23.4999752,"posY":1.51380932,"posZ":-5.49988461,"rotX":0.0108873118,"rotY":180.047745,"rotZ":0.00495726475,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306200,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"9d2e11","Name":"Custom_Model","Transform":{"posX":-28.0004177,"posY":1.76630068,"posZ":11.0194178,"rotX":0.00000530092439,"rotY":-0.000355626427,"rotZ":-1.98829326e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Text Tool","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0,"g":0,"b":0,"a":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":false,"Snap":false,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":false,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomMesh":{"MeshURL":"http://cloud-3.steamusercontent.com/ugc/1478820768302617365/27883B7913E0E69143C3AA03493B7E7C4E8C29C0/","DiffuseURL":"","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":1,"TypeIndex":0,"CastShadows":true},"LuaScript":"-- Code for bag to identify text tool objects\r\nmovableTextTool_cowgoesmoo33 = true\r\n\r\n-- Number of characters before the text box width expands.\r\nEXPAND_INTERVAL = 20\r\n\r\n-- This table controls what is passed between save/load\r\ndata = {}\r\n\r\nfunction onLoad(saved_data)\r\n  if saved_data ~= '' then\r\n    data = JSON.decode(saved_data)\r\n    if data.text ~= '' then\r\n      self.interactable = data.interactable\r\n      staticMode()\r\n      return\r\n    end\r\n  else\r\n    data = {size=200, color=Color(0,0,0), text='', interactable=true,\r\n        enter_to_finish=false, autolock=false, autolift=false,\r\n        hover_height=0.05, box_transparency=1}\r\n  end\r\n\r\n  inputMode()\r\nend\r\n\r\n-- True if in the middle of delay after pressing Enter (with enter_to_finish on)\r\nfinishing = false\r\nfunction input_func(obj, color, input, stillEditing)\r\n  local params = getBox(input)\r\n  if params then\r\n    params.value = input\r\n    self.editInput(params)\r\n  end\r\n\r\n  if not stillEditing then\r\n    data.text = input\r\n    updateState()\r\n    if input ~= '' then staticMode(color) end\r\n  elseif data.enter_to_finish then\r\n    -- If enter is pressed: remove last newline and force finish\r\n    if not finishing and input:sub(-1) == '\\n' then\r\n      finishing = true\r\n      -- Delay to avoid user's Enter keypress being detected (opens chat box)\r\n      Wait.frames(function()\r\n        input = input:sub(1, -2)\r\n        data.text = input\r\n        updateState()\r\n        if input ~= '' then staticMode(color) else inputMode() end\r\n        finishing = false\r\n      end, 10)\r\n    end\r\n  end\r\nend\r\n\r\n-- When the inpupt box appears and lets the player type in it.\r\nfunction inputMode()\r\n  self.clearContextMenu()\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n\r\n  local size = getBox(data.text, true)\r\n\r\n  self.createInput({\r\n    input_function = \"input_func\",\r\n    function_owner = self,\r\n    label          = \"Type Here\",\r\n    alignment      = 3,\r\n    position       = {x=0, y=data.hover_height, z=0},\r\n    rotation       = {0, 180, 0},\r\n    width          = size.width,\r\n    height         = size.height,\r\n    color          = getBackground(data.color),\r\n    font_color     = data.color,\r\n    font_size      = data.size,\r\n    value          = data.text,\r\n  })\r\n\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\nend\r\n\r\n-- When the input box disappears and displays the text.\r\nfunction staticMode(player)\r\n  self.clearContextMenu()\r\n  if data.autolock then\r\n    self.locked = true\r\n  end\r\n  if self.getInputs() and #self.getInputs() ~= 0 then\r\n    self.removeInput(0)\r\n  end\r\n\r\n  -- Clear from selecting player\r\n  if player then\r\n    self.removeFromPlayerSelection(player)\r\n  end\r\n\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  self.createButton({\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=self,\r\n    position={0,data.hover_height,0}, rotation={0,180,0}, height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  })\r\n\r\n  self.addContextMenuItem('Edit Text', function(color)\r\n    self.removeFromPlayerSelection(color)\r\n    inputMode()\r\n  end)\r\n  self.addContextMenuItem('Clear', function(color)\r\n    applyMultiple(color, 'clear', _, true)\r\n  end)\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\n  self.addContextMenuItem('Permanently Attach', attemptAttach)\r\n  self.addContextMenuItem('Permalock', function(color)\r\n    applyMultiple(color, 'permalock', _, true)\r\n  end)\r\nend\r\n\r\nfunction changeSize(params)\r\n  local delta = params[1]\r\n  local newSize = data.size + delta\r\n  if newSize > 800  or newSize < 50 then\r\n    return\r\n  end\r\n  data.size = newSize\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_size=data.size})\r\n  else\r\n    local size = getBox(data.text, true)\r\n    self.editInput({width=size.width, height=size.height, font_size=data.size})\r\n  end\r\nend\r\n\r\nfunction setColor(params)\r\n  if params and params[1] then\r\n    data.color = params[1]\r\n  else\r\n    data.color = self.getColorTint():setAt('a', 1) -- Take on color of object tint\r\n  end\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_color=data.color})\r\n  else\r\n    self.editInput({font_color=data.color, color=getBackground(data.color)})\r\n  end\r\nend\r\n\r\nfunction getBackground(color) --determines whether to use black or white depending on luminance\r\n  local r,g,b = Color(color):get()\r\n\r\n  local lum = 0.2126*r + 0.7152*g + 0.0722*b\r\n  if lum > 0.75 then\r\n    return {0.2,0.2,0.2, data.box_transparency}\r\n  else\r\n    return {1,1,1, data.box_transparency}\r\n  end\r\nend\r\n\r\nfunction clear()\r\n  data.text = ''\r\n  updateState()\r\n  inputMode()\r\nend\r\n\r\nfunction permalock()\r\n  self.interactable = false\r\n  data.interactable = false\r\n  updateState()\r\nend\r\n\r\nlocal target_script = [[\r\nfunction onLoad(script_state)\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    for _,entry in ipairs(state) do\r\n      self.createButton(entry)\r\n    end\r\n    self.addContextMenuItem('Clear All Text', function(color)\r\n      self.clearContextMenu()\r\n      self.clearButtons()\r\n      self.script_state = ''\r\n      self.script_code = ''\r\n    end)\r\n  end\r\nend\r\n]]\r\n\r\nfunction attemptAttach(player_color)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  local attachee\r\n  local attachers = {}\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if obj ~= self then\r\n        table.insert(attachers, obj)\r\n      end\r\n    else\r\n      if attachee then\r\n        broadcastToColor(\"More than one target selected.\", player_color)\r\n        return\r\n      else\r\n        attachee = obj\r\n      end\r\n    end\r\n  end\r\n  if attachee then\r\n    local code = attachee.script_code\r\n    if code and code ~= '' and code ~= target_script then\r\n      broadcastToColor(\"Warning: script on card has been overriden. Rewind time to undo.\", player_color)\r\n    end\r\n    for i,attacher in ipairs(attachers) do\r\n      attacher.call('attach', {target = attachee})\r\n    end\r\n    attach({target = attachee})\r\n    local type, flip = attachee.type, attachee.getRotation().z\r\n    if (type == 'Card' or type == 'Deck') and flip > 175 and flip < 185 then\r\n      broadcastToColor(\"Warning: text will not display if card or deck is facing down.\", player_color)\r\n    end\r\n  else\r\n    broadcastToColor(\"You must have a target object in your selection (using click-and-drag or Ctrl+Click) to use this option.\", player_color)\r\n  end\r\nend\r\n\r\nfunction attach(params)\r\n  local target = params.target\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  local textRotation = self.getRotation():sub(target.getRotation())\r\n    :add(Vector(180, 0, 180))\r\n\r\n  local textPosition = target.positionToLocal(\r\n    self.getPosition():add(Vector(0, data.hover_height, 0))\r\n  )\r\n  textPosition.x = -textPosition.x\r\n\r\n  local textScale = {}\r\n  textScale.x = self.getScale().x / target.getScale().x\r\n  textScale.y = self.getScale().x / target.getScale().y\r\n  textScale.z = self.getScale().x / target.getScale().z\r\n\r\n  local details = {\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=nil,\r\n    position=textPosition,\r\n    rotation=textRotation,\r\n    scale=textScale,\r\n    height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  }\r\n\r\n  target.createButton(details)\r\n\r\n  local script_state = target.script_state\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    table.insert(state, details)\r\n    target.script_state = JSON.encode(state)\r\n  else\r\n    target.script_state = JSON.encode({[1]=details})\r\n  end\r\n\r\n  target.script_code = target_script\r\n\r\n  self.destruct()\r\nend\r\n\r\nfunction applyMultiple(player_color, func_string, params, static_only)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if not static_only or obj.call('isStatic') then\r\n        obj.call(func_string, params)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction isStatic()\r\n  local input = self.getInputs()\r\n  return not input or #input == 0\r\nend\r\n\r\nfunction getBox(input, force)\r\n  local maxLength, lineCount = EXPAND_INTERVAL, 1\r\n  local lineLength = 0\r\n  for i = 1, #input do\r\n    local c = input:sub(i,i)\r\n    if c == '\\n' then\r\n      lineCount = lineCount + 1\r\n      if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n      lineLength = 0\r\n    else\r\n      lineLength = lineLength + 1\r\n    end\r\n  end\r\n  if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n\r\n  newWidth = data.size * maxLength * 0.9\r\n  newHeight = data.size * lineCount + 23\r\n\r\n  if force or boxWidth ~= newWidth or boxHeight ~= newHeight then\r\n    boxWidth, boxHeight = newWidth, newHeight\r\n    return {width = boxWidth, height = boxHeight}\r\n  end\r\n  return nil\r\nend\r\n\r\ntemp_lift = nil\r\nfunction onPickUp(player_color)\r\n  if data.autolift then\r\n    local player = Player[player_color]\r\n    temp_lift = player.lift_height\r\n    player.lift_height = 0\r\n  end\r\nend\r\n\r\nfunction onDrop(player_color)\r\n  if data.autolift and temp_lift then\r\n    Player[player_color].lift_height = temp_lift\r\n  end\r\nend\r\n\r\n-- Should be called every time data is modified, allows info to be saved on copy/paste\r\nfunction updateState()\r\n  self.script_state = JSON.encode(data)\r\nend\r\n\r\nfunction onSave()\r\n  self.script_state = JSON.encode(data)\r\n  return self.script_state\r\nend","LuaScriptState":"{\"autolift\":false,\"autolock\":false,\"box_transparency\":1,\"color\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1},\"enter_to_finish\":false,\"hover_height\":0.05,\"interactable\":true,\"size\":200,\"text\":\"Groupe unique\"}","XmlUI":""},{"GUID":"a1af1f","Name":"Custom_Tile","Transform":{"posX":5.99999857,"posY":1.50779891,"posZ":26.5000038,"rotX":0.010892353,"rotY":179.991531,"rotZ":0.00495025329,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"b76184","Name":"Custom_Tile","Transform":{"posX":-3.00000143,"posY":1.50553465,"posZ":10.5000038,"rotX":0.0108927926,"rotY":179.986328,"rotZ":0.00494946,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"bcee25","Name":"Custom_Model","Transform":{"posX":-20.9999886,"posY":1.76630068,"posZ":10.9999752,"rotX":0.0000051418715,"rotY":0.000720200362,"rotZ":-3.30811474e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Text Tool","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0,"g":0,"b":0,"a":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":false,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":false,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomMesh":{"MeshURL":"http://cloud-3.steamusercontent.com/ugc/1478820768302617365/27883B7913E0E69143C3AA03493B7E7C4E8C29C0/","DiffuseURL":"","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":1,"TypeIndex":0,"CastShadows":true},"LuaScript":"-- Code for bag to identify text tool objects\r\nmovableTextTool_cowgoesmoo33 = true\r\n\r\n-- Number of characters before the text box width expands.\r\nEXPAND_INTERVAL = 20\r\n\r\n-- This table controls what is passed between save/load\r\ndata = {}\r\n\r\nfunction onLoad(saved_data)\r\n  if saved_data ~= '' then\r\n    data = JSON.decode(saved_data)\r\n    if data.text ~= '' then\r\n      self.interactable = data.interactable\r\n      staticMode()\r\n      return\r\n    end\r\n  else\r\n    data = {size=200, color=Color(0,0,0), text='', interactable=true,\r\n        enter_to_finish=false, autolock=false, autolift=false,\r\n        hover_height=0.05, box_transparency=1}\r\n  end\r\n\r\n  inputMode()\r\nend\r\n\r\n-- True if in the middle of delay after pressing Enter (with enter_to_finish on)\r\nfinishing = false\r\nfunction input_func(obj, color, input, stillEditing)\r\n  local params = getBox(input)\r\n  if params then\r\n    params.value = input\r\n    self.editInput(params)\r\n  end\r\n\r\n  if not stillEditing then\r\n    data.text = input\r\n    updateState()\r\n    if input ~= '' then staticMode(color) end\r\n  elseif data.enter_to_finish then\r\n    -- If enter is pressed: remove last newline and force finish\r\n    if not finishing and input:sub(-1) == '\\n' then\r\n      finishing = true\r\n      -- Delay to avoid user's Enter keypress being detected (opens chat box)\r\n      Wait.frames(function()\r\n        input = input:sub(1, -2)\r\n        data.text = input\r\n        updateState()\r\n        if input ~= '' then staticMode(color) else inputMode() end\r\n        finishing = false\r\n      end, 10)\r\n    end\r\n  end\r\nend\r\n\r\n-- When the inpupt box appears and lets the player type in it.\r\nfunction inputMode()\r\n  self.clearContextMenu()\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n\r\n  local size = getBox(data.text, true)\r\n\r\n  self.createInput({\r\n    input_function = \"input_func\",\r\n    function_owner = self,\r\n    label          = \"Type Here\",\r\n    alignment      = 3,\r\n    position       = {x=0, y=data.hover_height, z=0},\r\n    rotation       = {0, 180, 0},\r\n    width          = size.width,\r\n    height         = size.height,\r\n    color          = getBackground(data.color),\r\n    font_color     = data.color,\r\n    font_size      = data.size,\r\n    value          = data.text,\r\n  })\r\n\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\nend\r\n\r\n-- When the input box disappears and displays the text.\r\nfunction staticMode(player)\r\n  self.clearContextMenu()\r\n  if data.autolock then\r\n    self.locked = true\r\n  end\r\n  if self.getInputs() and #self.getInputs() ~= 0 then\r\n    self.removeInput(0)\r\n  end\r\n\r\n  -- Clear from selecting player\r\n  if player then\r\n    self.removeFromPlayerSelection(player)\r\n  end\r\n\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  self.createButton({\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=self,\r\n    position={0,data.hover_height,0}, rotation={0,180,0}, height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  })\r\n\r\n  self.addContextMenuItem('Edit Text', function(color)\r\n    self.removeFromPlayerSelection(color)\r\n    inputMode()\r\n  end)\r\n  self.addContextMenuItem('Clear', function(color)\r\n    applyMultiple(color, 'clear', _, true)\r\n  end)\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\n  self.addContextMenuItem('Permanently Attach', attemptAttach)\r\n  self.addContextMenuItem('Permalock', function(color)\r\n    applyMultiple(color, 'permalock', _, true)\r\n  end)\r\nend\r\n\r\nfunction changeSize(params)\r\n  local delta = params[1]\r\n  local newSize = data.size + delta\r\n  if newSize > 800  or newSize < 50 then\r\n    return\r\n  end\r\n  data.size = newSize\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_size=data.size})\r\n  else\r\n    local size = getBox(data.text, true)\r\n    self.editInput({width=size.width, height=size.height, font_size=data.size})\r\n  end\r\nend\r\n\r\nfunction setColor(params)\r\n  if params and params[1] then\r\n    data.color = params[1]\r\n  else\r\n    data.color = self.getColorTint():setAt('a', 1) -- Take on color of object tint\r\n  end\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_color=data.color})\r\n  else\r\n    self.editInput({font_color=data.color, color=getBackground(data.color)})\r\n  end\r\nend\r\n\r\nfunction getBackground(color) --determines whether to use black or white depending on luminance\r\n  local r,g,b = Color(color):get()\r\n\r\n  local lum = 0.2126*r + 0.7152*g + 0.0722*b\r\n  if lum > 0.75 then\r\n    return {0.2,0.2,0.2, data.box_transparency}\r\n  else\r\n    return {1,1,1, data.box_transparency}\r\n  end\r\nend\r\n\r\nfunction clear()\r\n  data.text = ''\r\n  updateState()\r\n  inputMode()\r\nend\r\n\r\nfunction permalock()\r\n  self.interactable = false\r\n  data.interactable = false\r\n  updateState()\r\nend\r\n\r\nlocal target_script = [[\r\nfunction onLoad(script_state)\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    for _,entry in ipairs(state) do\r\n      self.createButton(entry)\r\n    end\r\n    self.addContextMenuItem('Clear All Text', function(color)\r\n      self.clearContextMenu()\r\n      self.clearButtons()\r\n      self.script_state = ''\r\n      self.script_code = ''\r\n    end)\r\n  end\r\nend\r\n]]\r\n\r\nfunction attemptAttach(player_color)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  local attachee\r\n  local attachers = {}\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if obj ~= self then\r\n        table.insert(attachers, obj)\r\n      end\r\n    else\r\n      if attachee then\r\n        broadcastToColor(\"More than one target selected.\", player_color)\r\n        return\r\n      else\r\n        attachee = obj\r\n      end\r\n    end\r\n  end\r\n  if attachee then\r\n    local code = attachee.script_code\r\n    if code and code ~= '' and code ~= target_script then\r\n      broadcastToColor(\"Warning: script on card has been overriden. Rewind time to undo.\", player_color)\r\n    end\r\n    for i,attacher in ipairs(attachers) do\r\n      attacher.call('attach', {target = attachee})\r\n    end\r\n    attach({target = attachee})\r\n    local type, flip = attachee.type, attachee.getRotation().z\r\n    if (type == 'Card' or type == 'Deck') and flip > 175 and flip < 185 then\r\n      broadcastToColor(\"Warning: text will not display if card or deck is facing down.\", player_color)\r\n    end\r\n  else\r\n    broadcastToColor(\"You must have a target object in your selection (using click-and-drag or Ctrl+Click) to use this option.\", player_color)\r\n  end\r\nend\r\n\r\nfunction attach(params)\r\n  local target = params.target\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  local textRotation = self.getRotation():sub(target.getRotation())\r\n    :add(Vector(180, 0, 180))\r\n\r\n  local textPosition = target.positionToLocal(\r\n    self.getPosition():add(Vector(0, data.hover_height, 0))\r\n  )\r\n  textPosition.x = -textPosition.x\r\n\r\n  local textScale = {}\r\n  textScale.x = self.getScale().x / target.getScale().x\r\n  textScale.y = self.getScale().x / target.getScale().y\r\n  textScale.z = self.getScale().x / target.getScale().z\r\n\r\n  local details = {\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=nil,\r\n    position=textPosition,\r\n    rotation=textRotation,\r\n    scale=textScale,\r\n    height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  }\r\n\r\n  target.createButton(details)\r\n\r\n  local script_state = target.script_state\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    table.insert(state, details)\r\n    target.script_state = JSON.encode(state)\r\n  else\r\n    target.script_state = JSON.encode({[1]=details})\r\n  end\r\n\r\n  target.script_code = target_script\r\n\r\n  self.destruct()\r\nend\r\n\r\nfunction applyMultiple(player_color, func_string, params, static_only)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if not static_only or obj.call('isStatic') then\r\n        obj.call(func_string, params)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction isStatic()\r\n  local input = self.getInputs()\r\n  return not input or #input == 0\r\nend\r\n\r\nfunction getBox(input, force)\r\n  local maxLength, lineCount = EXPAND_INTERVAL, 1\r\n  local lineLength = 0\r\n  for i = 1, #input do\r\n    local c = input:sub(i,i)\r\n    if c == '\\n' then\r\n      lineCount = lineCount + 1\r\n      if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n      lineLength = 0\r\n    else\r\n      lineLength = lineLength + 1\r\n    end\r\n  end\r\n  if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n\r\n  newWidth = data.size * maxLength * 0.9\r\n  newHeight = data.size * lineCount + 23\r\n\r\n  if force or boxWidth ~= newWidth or boxHeight ~= newHeight then\r\n    boxWidth, boxHeight = newWidth, newHeight\r\n    return {width = boxWidth, height = boxHeight}\r\n  end\r\n  return nil\r\nend\r\n\r\ntemp_lift = nil\r\nfunction onPickUp(player_color)\r\n  if data.autolift then\r\n    local player = Player[player_color]\r\n    temp_lift = player.lift_height\r\n    player.lift_height = 0\r\n  end\r\nend\r\n\r\nfunction onDrop(player_color)\r\n  if data.autolift and temp_lift then\r\n    Player[player_color].lift_height = temp_lift\r\n  end\r\nend\r\n\r\n-- Should be called every time data is modified, allows info to be saved on copy/paste\r\nfunction updateState()\r\n  self.script_state = JSON.encode(data)\r\nend\r\n\r\nfunction onSave()\r\n  self.script_state = JSON.encode(data)\r\n  return self.script_state\r\nend","LuaScriptState":"{\"autolift\":false,\"autolock\":false,\"box_transparency\":1,\"color\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1},\"enter_to_finish\":false,\"hover_height\":0.05,\"interactable\":true,\"size\":200,\"text\":\"Lieux zone de quarantaine\"}","XmlUI":""},{"GUID":"c05dd6","Name":"Deck","Transform":{"posX":30.4999,"posY":1.70987654,"posZ":-3,"rotX":-0.000591228134,"rotY":179.999908,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":false,"DeckIDs":[306444,306443,306442,306441,306440,306439,306438,306437,306436,306435,306434,306433,306432,306431,306430,306410,306429,306428,306427,306426,306425,306424,306423,306422,306421,306417,306415,306413,306412,306411],"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"1e4078","Name":"Card","Transform":{"posX":30.4999,"posY":10.0277929,"posZ":-3,"rotX":-0.0005910992,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85053\",\n  \"traits\": \"Ooze. Power.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306444,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"923f19","Name":"Card","Transform":{"posX":30.4999,"posY":10.1652794,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85053\",\n  \"traits\": \"Ooze. Power.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306443,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"935fdb","Name":"Card","Transform":{"posX":30.4999,"posY":9.96528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85052\",\n  \"traits\": \"Hazard.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306442,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"99d62e","Name":"Card","Transform":{"posX":30.4999,"posY":9.765279,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85052\",\n  \"traits\": \"Hazard.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306441,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"d70107","Name":"Card","Transform":{"posX":30.4999,"posY":9.565279,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85051\",\n  \"traits\": \"Power.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306440,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"e700de","Name":"Card","Transform":{"posX":30.4999,"posY":9.365279,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85051\",\n  \"traits\": \"Power.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306439,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"c106e4","Name":"Card","Transform":{"posX":30.4999,"posY":9.165279,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85050\",\n  \"traits\": \"Ooze. Obstacle.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306438,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"1ff9ec","Name":"Card","Transform":{"posX":30.4999,"posY":8.96528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85050\",\n  \"traits\": \"Ooze. Obstacle.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306437,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"e530ef","Name":"Card","Transform":{"posX":30.4999,"posY":8.765279,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85049\",\n  \"traits\": \"Ooze. Hazard.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306436,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"81d79a","Name":"Card","Transform":{"posX":30.4999,"posY":8.227793,"posZ":-3,"rotX":-0.0005911544,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85049\",\n  \"traits\": \"Ooze. Hazard.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306435,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"fdbe75","Name":"Card","Transform":{"posX":30.4999,"posY":8.365279,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85048\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306434,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"4827f9","Name":"Card","Transform":{"posX":30.4999,"posY":8.165279,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85048\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306433,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"5c78d6","Name":"Card","Transform":{"posX":30.4999,"posY":7.62779236,"posZ":-3,"rotX":-0.000591114862,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85048\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306432,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"407abd","Name":"Card","Transform":{"posX":30.4999,"posY":7.76527834,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85047\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306431,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"3b1dac","Name":"Card","Transform":{"posX":30.4999,"posY":7.56527853,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85047\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306430,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"55d530","Name":"Card","Transform":{"posX":30.4999,"posY":5.67285776,"posZ":-3.00000072,"rotX":-0.0005899384,"rotY":179.999924,"rotZ":180.001053,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 3,\n  \"id\": \"85039\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306410,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"9c7e45","Name":"Card","Transform":{"posX":30.4999,"posY":7.365279,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85047\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306429,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"0e6085","Name":"Card","Transform":{"posX":30.4999,"posY":7.16527939,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85046\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306428,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"84d76b","Name":"Card","Transform":{"posX":30.4999,"posY":6.96528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85046\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306427,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"511ecd","Name":"Card","Transform":{"posX":30.4999,"posY":6.76528025,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85045\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306426,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"6884ec","Name":"Card","Transform":{"posX":30.4999,"posY":6.56528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85045\",\n  \"traits\": \"Attack.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306425,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"b7f3cf","Name":"Card","Transform":{"posX":30.4999,"posY":6.36528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85044\",\n  \"traits\": \"Power.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306424,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"c9eef4","Name":"Card","Transform":{"posX":30.4999,"posY":6.16528034,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85044\",\n  \"traits\": \"Power.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306423,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"38d83c","Name":"Card","Transform":{"posX":30.4999,"posY":5.96528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85044\",\n  \"traits\": \"Power.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306422,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"a777aa","Name":"Card","Transform":{"posX":30.4999,"posY":5.427794,"posZ":-3,"rotX":-0.0005909749,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85044\",\n  \"traits\": \"Power.\",\n  \"type\": \"Treachery\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306421,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"390037","Name":"Card","Transform":{"posX":30.4999,"posY":5.56528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 4,\n  \"id\": \"85041\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306417,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"f508ad","Name":"Card","Transform":{"posX":30.4999,"posY":5.36528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 5,\n  \"id\": \"85040\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306415,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"b3b208","Name":"Card","Transform":{"posX":30.4999,"posY":5.16528034,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 3,\n  \"id\": \"85039\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306413,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"d6b0e2","Name":"Card","Transform":{"posX":30.4999,"posY":4.96528,"posZ":-3.00000024,"rotX":-0.000591005839,"rotY":179.999924,"rotZ":180.001068,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 3,\n  \"id\": \"85039\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306412,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"591de4","Name":"Card","Transform":{"posX":30.4999027,"posY":1.64541423,"posZ":-2.99999976,"rotX":-0.00163276971,"rotY":179.999924,"rotZ":180.002029,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 3,\n  \"id\": \"85039\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306411,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"c13319","Name":"CardCustom","Transform":{"posX":-12.0000019,"posY":1.520677,"posZ":14.5000029,"rotX":0.0108916461,"rotY":179.997742,"rotZ":0.00494782,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"c1334a","Name":"Deck","Transform":{"posX":-23.000082,"posY":1.79586,"posZ":2.999908,"rotX":-0.000005137113,"rotY":180.004562,"rotZ":7.19153661e-8,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":false,"SidewaysCard":false,"DeckIDs":[306414,306416],"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":"","ContainedObjects":[{"GUID":"9a7f5b","Name":"Card","Transform":{"posX":-23.0001068,"posY":1.870418,"posZ":2.99988413,"rotX":0.000885870948,"rotY":180.004684,"rotZ":-0.00081234955,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 5,\n  \"id\": \"85040\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306414,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"8ca380","Name":"Card","Transform":{"posX":-23.0001068,"posY":1.86865568,"posZ":2.99988413,"rotX":0.00285473978,"rotY":180.004684,"rotZ":-0.00344787887,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"health\": 4,\n  \"id\": \"85041\",\n  \"traits\": \"Monster. Ooze. Manifold.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306416,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""}]},{"GUID":"c425b7","Name":"Custom_Tile","Transform":{"posX":10.4999981,"posY":1.50512922,"posZ":14.5000038,"rotX":0.00494610658,"rotY":89.99157,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"c51491","Name":"Custom_Tile","Transform":{"posX":3.00000024,"posY":1.50178492,"posZ":-6.5,"rotX":0.0108906021,"rotY":180.01149,"rotZ":0.004950498,"scaleX":1.6428808,"scaleY":1,"scaleZ":1.6428808},"Nickname":"Mise en place du Chaos Bag","Description":"Le Dévoreur de Toute Chose","GMNotes":"{\"data\":\"The Blob\",\"easy\":false,\"expert\":false,\"hard\":true,\"normal\":true,\"standalone\":false}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.8745098,"g":0.8,"b":0.7019608},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"http://cloud-3.steamusercontent.com/ugc/2011456161884106028/81BF2DAD34FE18B6788B56E21F16B81E6525AD99/","ImageSecondaryURL":"http://cloud-3.steamusercontent.com/ugc/2011456161884106028/81BF2DAD34FE18B6788B56E21F16B81E6525AD99/","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"\r\njacqueline_guid = '42cd6e'\r\n\r\nbuttonparams = {\r\n   ['easy'] = {label = \"Facile\", click_function = 'modeEasy', z_i = -0.2},\r\n   ['normal'] = {label = \"Standard\", click_function = 'modeNormal', z_i = 0.1},\r\n   ['hard'] = {label = \"Difficile\", click_function = 'modeHard', z_i = 0.4},\r\n   ['expert'] = {label = \"Expert\", click_function = 'modeExpert', z_i = 0.7},\r\n   ['standalone'] = {label = \"Indépendant\", click_function = 'modeStandalone', z_i = 0},\r\n}\r\n\r\nfunction onLoad()\r\n\r\n    metadata = JSON.decode(self.getGMNotes())\r\n    buttontable = {}\r\n    for key, value in pairs(buttonparams) do\r\n        if metadata[key] == true then\r\n            table.insert(buttontable,value)\r\n        end\r\n        \r\n    end\r\n\r\n    for _, button in pairs(buttontable) do\r\n        local data = {\r\n            click_function = button.click_function, \r\n            function_owner = self, \r\n            label = button.label, \r\n            position = {0, 0.1, button.z_i}, \r\n            scale = {0.3, 0.5, 0.3}, \r\n            width = 1500, \r\n            height = 400, \r\n            font_size = 250, \r\n            tooltip = \"Chaos bag du mode \"..button.label,\r\n            color = {0.5647, 0.4627, 0.2353, 1}, \r\n            font_color = {0.9041, 0.8313, 0.7356, 1},\r\n            hover_color = {99/255, 85/255, 48/255},\r\n            press_color = {192/255, 152/255, 94/255} }\r\n        self.createButton(data)\r\n        \r\n    end\r\n    jacqueline = getObjectFromGUID(jacqueline_guid)\r\n    chaosdata = jacqueline.getTable('chaosdata')\r\nend\r\n\r\nfunction modeEasy()\r\n    local  params ={}\r\n     params.mode = 'easy'\r\n     params.data = metadata.data\r\n     jacqueline.call('setChaosBag', params)\r\n  \r\nend\r\n\r\nfunction modeNormal()\r\n      local  params ={}\r\n       params.mode = 'normal'\r\n       params.data = metadata.data\r\n       jacqueline.call('setChaosBag', params)\r\n    \r\nend\r\n\r\nfunction modeHard()\r\n    local  params ={}\r\n     params.mode = 'hard'\r\n     params.data = metadata.data\r\n     jacqueline.call('setChaosBag', params)\r\n  \r\nend\r\n\r\nfunction modeExpert()\r\n    local  params ={}\r\n     params.mode = 'expert'\r\n     params.data = metadata.data\r\n     jacqueline.call('setChaosBag', params)\r\n  \r\nend\r\n\r\nfunction modeStandalone()\r\n    local  params ={}\r\n     params.mode = 'standalone'\r\n     params.data = metadata.data\r\n     jacqueline.call('setChaosBag', params)\r\n  \r\nend","LuaScriptState":"","XmlUI":""},{"GUID":"c76ae2","Name":"Card","Transform":{"posX":-26.9099178,"posY":1.7789048,"posZ":19.4996529,"rotX":-0.000005123478,"rotY":180.026215,"rotZ":9.193364e-8,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"cycle\": \"Standalone\",\n  \"id\": \"85013\",\n  \"type\": \"Location\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306204,"SidewaysCard":false,"CustomDeck":{"3062":{"FaceURL":"https://i.imgur.com/6ao8Cas.jpg","BackURL":"https://i.imgur.com/E6Viksz.jpg","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":true,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"c91fef","Name":"Custom_Model","Transform":{"posX":-26.5,"posY":1.7663,"posZ":17,"rotX":0,"rotY":-0.0001,"rotZ":0,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Text Tool","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0,"g":0,"b":0,"a":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":false,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":false,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomMesh":{"MeshURL":"http://cloud-3.steamusercontent.com/ugc/1478820768302617365/27883B7913E0E69143C3AA03493B7E7C4E8C29C0/","DiffuseURL":"","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":1,"TypeIndex":0,"CastShadows":true},"LuaScript":"-- Code for bag to identify text tool objects\r\nmovableTextTool_cowgoesmoo33 = true\r\n\r\n-- Number of characters before the text box width expands.\r\nEXPAND_INTERVAL = 20\r\n\r\n-- This table controls what is passed between save/load\r\ndata = {}\r\n\r\nfunction onLoad(saved_data)\r\n  if saved_data ~= '' then\r\n    data = JSON.decode(saved_data)\r\n    if data.text ~= '' then\r\n      self.interactable = data.interactable\r\n      staticMode()\r\n      return\r\n    end\r\n  else\r\n    data = {size=200, color=Color(0,0,0), text='', interactable=true,\r\n        enter_to_finish=false, autolock=false, autolift=false,\r\n        hover_height=0.05, box_transparency=1}\r\n  end\r\n\r\n  inputMode()\r\nend\r\n\r\n-- True if in the middle of delay after pressing Enter (with enter_to_finish on)\r\nfinishing = false\r\nfunction input_func(obj, color, input, stillEditing)\r\n  local params = getBox(input)\r\n  if params then\r\n    params.value = input\r\n    self.editInput(params)\r\n  end\r\n\r\n  if not stillEditing then\r\n    data.text = input\r\n    updateState()\r\n    if input ~= '' then staticMode(color) end\r\n  elseif data.enter_to_finish then\r\n    -- If enter is pressed: remove last newline and force finish\r\n    if not finishing and input:sub(-1) == '\\n' then\r\n      finishing = true\r\n      -- Delay to avoid user's Enter keypress being detected (opens chat box)\r\n      Wait.frames(function()\r\n        input = input:sub(1, -2)\r\n        data.text = input\r\n        updateState()\r\n        if input ~= '' then staticMode(color) else inputMode() end\r\n        finishing = false\r\n      end, 10)\r\n    end\r\n  end\r\nend\r\n\r\n-- When the inpupt box appears and lets the player type in it.\r\nfunction inputMode()\r\n  self.clearContextMenu()\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n\r\n  local size = getBox(data.text, true)\r\n\r\n  self.createInput({\r\n    input_function = \"input_func\",\r\n    function_owner = self,\r\n    label          = \"Type Here\",\r\n    alignment      = 3,\r\n    position       = {x=0, y=data.hover_height, z=0},\r\n    rotation       = {0, 180, 0},\r\n    width          = size.width,\r\n    height         = size.height,\r\n    color          = getBackground(data.color),\r\n    font_color     = data.color,\r\n    font_size      = data.size,\r\n    value          = data.text,\r\n  })\r\n\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\nend\r\n\r\n-- When the input box disappears and displays the text.\r\nfunction staticMode(player)\r\n  self.clearContextMenu()\r\n  if data.autolock then\r\n    self.locked = true\r\n  end\r\n  if self.getInputs() and #self.getInputs() ~= 0 then\r\n    self.removeInput(0)\r\n  end\r\n\r\n  -- Clear from selecting player\r\n  if player then\r\n    self.removeFromPlayerSelection(player)\r\n  end\r\n\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  self.createButton({\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=self,\r\n    position={0,data.hover_height,0}, rotation={0,180,0}, height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  })\r\n\r\n  self.addContextMenuItem('Edit Text', function(color)\r\n    self.removeFromPlayerSelection(color)\r\n    inputMode()\r\n  end)\r\n  self.addContextMenuItem('Clear', function(color)\r\n    applyMultiple(color, 'clear', _, true)\r\n  end)\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\n  self.addContextMenuItem('Permanently Attach', attemptAttach)\r\n  self.addContextMenuItem('Permalock', function(color)\r\n    applyMultiple(color, 'permalock', _, true)\r\n  end)\r\nend\r\n\r\nfunction changeSize(params)\r\n  local delta = params[1]\r\n  local newSize = data.size + delta\r\n  if newSize > 800  or newSize < 50 then\r\n    return\r\n  end\r\n  data.size = newSize\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_size=data.size})\r\n  else\r\n    local size = getBox(data.text, true)\r\n    self.editInput({width=size.width, height=size.height, font_size=data.size})\r\n  end\r\nend\r\n\r\nfunction setColor(params)\r\n  if params and params[1] then\r\n    data.color = params[1]\r\n  else\r\n    data.color = self.getColorTint():setAt('a', 1) -- Take on color of object tint\r\n  end\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_color=data.color})\r\n  else\r\n    self.editInput({font_color=data.color, color=getBackground(data.color)})\r\n  end\r\nend\r\n\r\nfunction getBackground(color) --determines whether to use black or white depending on luminance\r\n  local r,g,b = Color(color):get()\r\n\r\n  local lum = 0.2126*r + 0.7152*g + 0.0722*b\r\n  if lum > 0.75 then\r\n    return {0.2,0.2,0.2, data.box_transparency}\r\n  else\r\n    return {1,1,1, data.box_transparency}\r\n  end\r\nend\r\n\r\nfunction clear()\r\n  data.text = ''\r\n  updateState()\r\n  inputMode()\r\nend\r\n\r\nfunction permalock()\r\n  self.interactable = false\r\n  data.interactable = false\r\n  updateState()\r\nend\r\n\r\nlocal target_script = [[\r\nfunction onLoad(script_state)\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    for _,entry in ipairs(state) do\r\n      self.createButton(entry)\r\n    end\r\n    self.addContextMenuItem('Clear All Text', function(color)\r\n      self.clearContextMenu()\r\n      self.clearButtons()\r\n      self.script_state = ''\r\n      self.script_code = ''\r\n    end)\r\n  end\r\nend\r\n]]\r\n\r\nfunction attemptAttach(player_color)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  local attachee\r\n  local attachers = {}\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if obj ~= self then\r\n        table.insert(attachers, obj)\r\n      end\r\n    else\r\n      if attachee then\r\n        broadcastToColor(\"More than one target selected.\", player_color)\r\n        return\r\n      else\r\n        attachee = obj\r\n      end\r\n    end\r\n  end\r\n  if attachee then\r\n    local code = attachee.script_code\r\n    if code and code ~= '' and code ~= target_script then\r\n      broadcastToColor(\"Warning: script on card has been overriden. Rewind time to undo.\", player_color)\r\n    end\r\n    for i,attacher in ipairs(attachers) do\r\n      attacher.call('attach', {target = attachee})\r\n    end\r\n    attach({target = attachee})\r\n    local type, flip = attachee.type, attachee.getRotation().z\r\n    if (type == 'Card' or type == 'Deck') and flip > 175 and flip < 185 then\r\n      broadcastToColor(\"Warning: text will not display if card or deck is facing down.\", player_color)\r\n    end\r\n  else\r\n    broadcastToColor(\"You must have a target object in your selection (using click-and-drag or Ctrl+Click) to use this option.\", player_color)\r\n  end\r\nend\r\n\r\nfunction attach(params)\r\n  local target = params.target\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  local textRotation = self.getRotation():sub(target.getRotation())\r\n    :add(Vector(180, 0, 180))\r\n\r\n  local textPosition = target.positionToLocal(\r\n    self.getPosition():add(Vector(0, data.hover_height, 0))\r\n  )\r\n  textPosition.x = -textPosition.x\r\n\r\n  local textScale = {}\r\n  textScale.x = self.getScale().x / target.getScale().x\r\n  textScale.y = self.getScale().x / target.getScale().y\r\n  textScale.z = self.getScale().x / target.getScale().z\r\n\r\n  local details = {\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=nil,\r\n    position=textPosition,\r\n    rotation=textRotation,\r\n    scale=textScale,\r\n    height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  }\r\n\r\n  target.createButton(details)\r\n\r\n  local script_state = target.script_state\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    table.insert(state, details)\r\n    target.script_state = JSON.encode(state)\r\n  else\r\n    target.script_state = JSON.encode({[1]=details})\r\n  end\r\n\r\n  target.script_code = target_script\r\n\r\n  self.destruct()\r\nend\r\n\r\nfunction applyMultiple(player_color, func_string, params, static_only)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if not static_only or obj.call('isStatic') then\r\n        obj.call(func_string, params)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction isStatic()\r\n  local input = self.getInputs()\r\n  return not input or #input == 0\r\nend\r\n\r\nfunction getBox(input, force)\r\n  local maxLength, lineCount = EXPAND_INTERVAL, 1\r\n  local lineLength = 0\r\n  for i = 1, #input do\r\n    local c = input:sub(i,i)\r\n    if c == '\\n' then\r\n      lineCount = lineCount + 1\r\n      if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n      lineLength = 0\r\n    else\r\n      lineLength = lineLength + 1\r\n    end\r\n  end\r\n  if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n\r\n  newWidth = data.size * maxLength * 0.9\r\n  newHeight = data.size * lineCount + 23\r\n\r\n  if force or boxWidth ~= newWidth or boxHeight ~= newHeight then\r\n    boxWidth, boxHeight = newWidth, newHeight\r\n    return {width = boxWidth, height = boxHeight}\r\n  end\r\n  return nil\r\nend\r\n\r\ntemp_lift = nil\r\nfunction onPickUp(player_color)\r\n  if data.autolift then\r\n    local player = Player[player_color]\r\n    temp_lift = player.lift_height\r\n    player.lift_height = 0\r\n  end\r\nend\r\n\r\nfunction onDrop(player_color)\r\n  if data.autolift and temp_lift then\r\n    Player[player_color].lift_height = temp_lift\r\n  end\r\nend\r\n\r\n-- Should be called every time data is modified, allows info to be saved on copy/paste\r\nfunction updateState()\r\n  self.script_state = JSON.encode(data)\r\nend\r\n\r\nfunction onSave()\r\n  self.script_state = JSON.encode(data)\r\n  return self.script_state\r\nend","LuaScriptState":"{\"autolift\":false,\"autolock\":false,\"box_transparency\":1,\"color\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1},\"enter_to_finish\":false,\"hover_height\":0.05,\"interactable\":true,\"size\":200,\"text\":\"Butte fongique \\n+ 3 Zones de Quarantaine\"}","XmlUI":""},{"GUID":"d3deeb","Name":"CardCustom","Transform":{"posX":5.99999857,"posY":1.51760173,"posZ":6.50000334,"rotX":0.0108914552,"rotY":179.999817,"rotZ":0.004948248,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":1108500,"SidewaysCard":false,"CustomDeck":{"11085":{"FaceURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","BackURL":"http://cloud-3.steamusercontent.com/ugc/1874088192656181477/79874E6695B40674EB042AE509B14E016AC3DB57/","NumWidth":1,"NumHeight":1,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"d7e54e","Name":"Custom_Tile","Transform":{"posX":14.999999,"posY":1.50398016,"posZ":10.5000038,"rotX":0.0108906478,"rotY":180.011215,"rotZ":0.004949703,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"ed4821","Name":"Custom_Model","Transform":{"posX":-31.3039761,"posY":1.76630068,"posZ":10.9651508,"rotX":0.000004733155,"rotY":0.00010268917,"rotZ":1.89697914e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Text Tool","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0,"g":0,"b":0,"a":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":false,"Snap":false,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":false,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomMesh":{"MeshURL":"http://cloud-3.steamusercontent.com/ugc/1478820768302617365/27883B7913E0E69143C3AA03493B7E7C4E8C29C0/","DiffuseURL":"","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":1,"TypeIndex":0,"CastShadows":true},"LuaScript":"-- Code for bag to identify text tool objects\r\nmovableTextTool_cowgoesmoo33 = true\r\n\r\n-- Number of characters before the text box width expands.\r\nEXPAND_INTERVAL = 20\r\n\r\n-- This table controls what is passed between save/load\r\ndata = {}\r\n\r\nfunction onLoad(saved_data)\r\n  if saved_data ~= '' then\r\n    data = JSON.decode(saved_data)\r\n    if data.text ~= '' then\r\n      self.interactable = data.interactable\r\n      staticMode()\r\n      return\r\n    end\r\n  else\r\n    data = {size=200, color=Color(0,0,0), text='', interactable=true,\r\n        enter_to_finish=false, autolock=false, autolift=false,\r\n        hover_height=0.05, box_transparency=1}\r\n  end\r\n\r\n  inputMode()\r\nend\r\n\r\n-- True if in the middle of delay after pressing Enter (with enter_to_finish on)\r\nfinishing = false\r\nfunction input_func(obj, color, input, stillEditing)\r\n  local params = getBox(input)\r\n  if params then\r\n    params.value = input\r\n    self.editInput(params)\r\n  end\r\n\r\n  if not stillEditing then\r\n    data.text = input\r\n    updateState()\r\n    if input ~= '' then staticMode(color) end\r\n  elseif data.enter_to_finish then\r\n    -- If enter is pressed: remove last newline and force finish\r\n    if not finishing and input:sub(-1) == '\\n' then\r\n      finishing = true\r\n      -- Delay to avoid user's Enter keypress being detected (opens chat box)\r\n      Wait.frames(function()\r\n        input = input:sub(1, -2)\r\n        data.text = input\r\n        updateState()\r\n        if input ~= '' then staticMode(color) else inputMode() end\r\n        finishing = false\r\n      end, 10)\r\n    end\r\n  end\r\nend\r\n\r\n-- When the inpupt box appears and lets the player type in it.\r\nfunction inputMode()\r\n  self.clearContextMenu()\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n\r\n  local size = getBox(data.text, true)\r\n\r\n  self.createInput({\r\n    input_function = \"input_func\",\r\n    function_owner = self,\r\n    label          = \"Type Here\",\r\n    alignment      = 3,\r\n    position       = {x=0, y=data.hover_height, z=0},\r\n    rotation       = {0, 180, 0},\r\n    width          = size.width,\r\n    height         = size.height,\r\n    color          = getBackground(data.color),\r\n    font_color     = data.color,\r\n    font_size      = data.size,\r\n    value          = data.text,\r\n  })\r\n\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\nend\r\n\r\n-- When the input box disappears and displays the text.\r\nfunction staticMode(player)\r\n  self.clearContextMenu()\r\n  if data.autolock then\r\n    self.locked = true\r\n  end\r\n  if self.getInputs() and #self.getInputs() ~= 0 then\r\n    self.removeInput(0)\r\n  end\r\n\r\n  -- Clear from selecting player\r\n  if player then\r\n    self.removeFromPlayerSelection(player)\r\n  end\r\n\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  self.createButton({\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=self,\r\n    position={0,data.hover_height,0}, rotation={0,180,0}, height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  })\r\n\r\n  self.addContextMenuItem('Edit Text', function(color)\r\n    self.removeFromPlayerSelection(color)\r\n    inputMode()\r\n  end)\r\n  self.addContextMenuItem('Clear', function(color)\r\n    applyMultiple(color, 'clear', _, true)\r\n  end)\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\n  self.addContextMenuItem('Permanently Attach', attemptAttach)\r\n  self.addContextMenuItem('Permalock', function(color)\r\n    applyMultiple(color, 'permalock', _, true)\r\n  end)\r\nend\r\n\r\nfunction changeSize(params)\r\n  local delta = params[1]\r\n  local newSize = data.size + delta\r\n  if newSize > 800  or newSize < 50 then\r\n    return\r\n  end\r\n  data.size = newSize\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_size=data.size})\r\n  else\r\n    local size = getBox(data.text, true)\r\n    self.editInput({width=size.width, height=size.height, font_size=data.size})\r\n  end\r\nend\r\n\r\nfunction setColor(params)\r\n  if params and params[1] then\r\n    data.color = params[1]\r\n  else\r\n    data.color = self.getColorTint():setAt('a', 1) -- Take on color of object tint\r\n  end\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_color=data.color})\r\n  else\r\n    self.editInput({font_color=data.color, color=getBackground(data.color)})\r\n  end\r\nend\r\n\r\nfunction getBackground(color) --determines whether to use black or white depending on luminance\r\n  local r,g,b = Color(color):get()\r\n\r\n  local lum = 0.2126*r + 0.7152*g + 0.0722*b\r\n  if lum > 0.75 then\r\n    return {0.2,0.2,0.2, data.box_transparency}\r\n  else\r\n    return {1,1,1, data.box_transparency}\r\n  end\r\nend\r\n\r\nfunction clear()\r\n  data.text = ''\r\n  updateState()\r\n  inputMode()\r\nend\r\n\r\nfunction permalock()\r\n  self.interactable = false\r\n  data.interactable = false\r\n  updateState()\r\nend\r\n\r\nlocal target_script = [[\r\nfunction onLoad(script_state)\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    for _,entry in ipairs(state) do\r\n      self.createButton(entry)\r\n    end\r\n    self.addContextMenuItem('Clear All Text', function(color)\r\n      self.clearContextMenu()\r\n      self.clearButtons()\r\n      self.script_state = ''\r\n      self.script_code = ''\r\n    end)\r\n  end\r\nend\r\n]]\r\n\r\nfunction attemptAttach(player_color)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  local attachee\r\n  local attachers = {}\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if obj ~= self then\r\n        table.insert(attachers, obj)\r\n      end\r\n    else\r\n      if attachee then\r\n        broadcastToColor(\"More than one target selected.\", player_color)\r\n        return\r\n      else\r\n        attachee = obj\r\n      end\r\n    end\r\n  end\r\n  if attachee then\r\n    local code = attachee.script_code\r\n    if code and code ~= '' and code ~= target_script then\r\n      broadcastToColor(\"Warning: script on card has been overriden. Rewind time to undo.\", player_color)\r\n    end\r\n    for i,attacher in ipairs(attachers) do\r\n      attacher.call('attach', {target = attachee})\r\n    end\r\n    attach({target = attachee})\r\n    local type, flip = attachee.type, attachee.getRotation().z\r\n    if (type == 'Card' or type == 'Deck') and flip > 175 and flip < 185 then\r\n      broadcastToColor(\"Warning: text will not display if card or deck is facing down.\", player_color)\r\n    end\r\n  else\r\n    broadcastToColor(\"You must have a target object in your selection (using click-and-drag or Ctrl+Click) to use this option.\", player_color)\r\n  end\r\nend\r\n\r\nfunction attach(params)\r\n  local target = params.target\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  local textRotation = self.getRotation():sub(target.getRotation())\r\n    :add(Vector(180, 0, 180))\r\n\r\n  local textPosition = target.positionToLocal(\r\n    self.getPosition():add(Vector(0, data.hover_height, 0))\r\n  )\r\n  textPosition.x = -textPosition.x\r\n\r\n  local textScale = {}\r\n  textScale.x = self.getScale().x / target.getScale().x\r\n  textScale.y = self.getScale().x / target.getScale().y\r\n  textScale.z = self.getScale().x / target.getScale().z\r\n\r\n  local details = {\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=nil,\r\n    position=textPosition,\r\n    rotation=textRotation,\r\n    scale=textScale,\r\n    height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  }\r\n\r\n  target.createButton(details)\r\n\r\n  local script_state = target.script_state\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    table.insert(state, details)\r\n    target.script_state = JSON.encode(state)\r\n  else\r\n    target.script_state = JSON.encode({[1]=details})\r\n  end\r\n\r\n  target.script_code = target_script\r\n\r\n  self.destruct()\r\nend\r\n\r\nfunction applyMultiple(player_color, func_string, params, static_only)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if not static_only or obj.call('isStatic') then\r\n        obj.call(func_string, params)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction isStatic()\r\n  local input = self.getInputs()\r\n  return not input or #input == 0\r\nend\r\n\r\nfunction getBox(input, force)\r\n  local maxLength, lineCount = EXPAND_INTERVAL, 1\r\n  local lineLength = 0\r\n  for i = 1, #input do\r\n    local c = input:sub(i,i)\r\n    if c == '\\n' then\r\n      lineCount = lineCount + 1\r\n      if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n      lineLength = 0\r\n    else\r\n      lineLength = lineLength + 1\r\n    end\r\n  end\r\n  if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n\r\n  newWidth = data.size * maxLength * 0.9\r\n  newHeight = data.size * lineCount + 23\r\n\r\n  if force or boxWidth ~= newWidth or boxHeight ~= newHeight then\r\n    boxWidth, boxHeight = newWidth, newHeight\r\n    return {width = boxWidth, height = boxHeight}\r\n  end\r\n  return nil\r\nend\r\n\r\ntemp_lift = nil\r\nfunction onPickUp(player_color)\r\n  if data.autolift then\r\n    local player = Player[player_color]\r\n    temp_lift = player.lift_height\r\n    player.lift_height = 0\r\n  end\r\nend\r\n\r\nfunction onDrop(player_color)\r\n  if data.autolift and temp_lift then\r\n    Player[player_color].lift_height = temp_lift\r\n  end\r\nend\r\n\r\n-- Should be called every time data is modified, allows info to be saved on copy/paste\r\nfunction updateState()\r\n  self.script_state = JSON.encode(data)\r\nend\r\n\r\nfunction onSave()\r\n  self.script_state = JSON.encode(data)\r\n  return self.script_state\r\nend","LuaScriptState":"{\"autolift\":false,\"autolock\":false,\"box_transparency\":1,\"color\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1},\"enter_to_finish\":false,\"hover_height\":0.05,\"interactable\":true,\"size\":200,\"text\":\"Multijoueur épique\"}","XmlUI":""},{"GUID":"f8961e","Name":"Custom_Token","Transform":{"posX":23.5000038,"posY":1.55067968,"posZ":-3.00001121,"rotX":0.0108962832,"rotY":180.004318,"rotZ":0.004949994,"scaleX":0.3,"scaleY":1,"scaleZ":0.3},"Nickname":"Resources","Description":"Left click - Increase\nRight click - Decrease","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":1,"g":1,"b":1},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"http://cloud-3.steamusercontent.com/ugc/949599153663401115/EAA6D40FC6E15204BBE551BCDED35CC8C75111BF/","ImageSecondaryURL":"","ImageScalar":1,"WidthScale":0,"CustomToken":{"Thickness":0.1,"MergeDistancePixels":5,"StandUp":false,"Stackable":false}},"LuaScript":"MIN_VALUE = -99\r\nMAX_VALUE = 999\r\n\r\nfunction onload(saved_data)\r\n    light_mode = true\r\n    val = 0\r\n\r\n    if saved_data ~= \"\" then\r\n        local loaded_data = JSON.decode(saved_data)\r\n        light_mode = loaded_data[1]\r\n        val = loaded_data[2]\r\n    end\r\n\r\n    createAll()\r\nend\r\n\r\nfunction updateSave()\r\n    local data_to_save = {light_mode, val}\r\n    saved_data = JSON.encode(data_to_save)\r\n    self.script_state = saved_data\r\nend\r\n\r\nfunction createAll()\r\n    s_color = {0,0,0,100}\r\n\n    if light_mode then\r\n        f_color = {1,1,1,100}\r\n    else\r\n        f_color = {0,0,0,100}\r\n    end\r\n\r\n\r\n\r\n    self.createButton({\r\n      label=tostring(val),\r\n      click_function=\"add_subtract\",\r\n      function_owner=self,\r\n      position={0,0.05,0.1},\r\n      height=600,\r\n      width=1000,\r\n      alignment = 3,\r\n      scale={x=1.5, y=1.5, z=1.5},\r\n      font_size=600,\r\n      font_color=f_color,\r\n      color={1,1,1,0}\r\n      })\r\n\r\n\r\n\r\n\r\n    if light_mode then\r\n        lightButtonText = \"[ Set dark ]\"\r\n    else\r\n        lightButtonText = \"[ Set light ]\"\r\n    end\r\n \r\nend\r\n\r\nfunction removeAll()\r\n    self.removeInput(0)\r\n    self.removeInput(1)\r\n    self.removeButton(0)\r\n    self.removeButton(1)\r\n    self.removeButton(2)\r\nend\r\n\r\nfunction reloadAll()\r\n    removeAll()\r\n    createAll()\r\n\r\n    updateSave()\r\nend\r\n\r\nfunction swap_fcolor(_obj, _color, alt_click)\r\n    light_mode = not light_mode\r\n    reloadAll()\r\nend\r\n\r\nfunction swap_align(_obj, _color, alt_click)\r\n    center_mode = not center_mode\r\n    reloadAll()\r\nend\r\n\r\nfunction editName(_obj, _string, value) \r\n    self.setName(value)\r\n    setTooltips()\r\nend\r\n\r\nfunction add_subtract(_obj, _color, alt_click)\r\n    mod = alt_click and -1 or 1\r\n    new_value = math.min(math.max(val + mod, MIN_VALUE), MAX_VALUE)\r\n    if val ~= new_value then\r\n        val = new_value\r\n      updateVal()\r\n        updateSave()\r\n    end\r\nend\r\n\r\nfunction updateVal()\r\n\r\n    self.editButton({\r\n        index = 0,\r\n        label = tostring(val),\r\n\r\n        })\r\nend\r\n\r\nfunction reset_val()\r\n    val = 0\r\n    updateVal()\r\n    updateSave()\r\nend\r\n\r\nfunction setTooltips()\r\n    self.editInput({\r\n        index = 0,\r\n        value = self.getName(),\r\n        tooltip = ttText\r\n        })\r\n    self.editButton({\r\n        index = 0,\r\n        value = tostring(val),\r\n        tooltip = ttText\r\n        })\r\nend\r\n\r\nfunction null()\r\nend\r\n\r\nfunction keepSample(_obj, _string, value) \r\n    reloadAll()\r\nend","LuaScriptState":"[true,0]","XmlUI":""},{"GUID":"f9947f","Name":"Custom_Tile","Transform":{"posX":1.99999833,"posY":1.50434244,"posZ":6.500001,"rotX":0.00494622,"rotY":89.99158,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"fad34b","Name":"Card","Transform":{"posX":-20.00006,"posY":1.77890623,"posZ":2.99993634,"rotX":-0.000004955175,"rotY":180.005646,"rotZ":1.14675132e-7,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"{\n  \"class\": \"Mythos\",\n  \"cycle\": \"Standalone\",\n  \"id\": \"85043\",\n  \"traits\": \"Monster. Ooze. Elite.\",\n  \"type\": \"Enemy\"\n}","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.713235259,"g":0.713235259,"b":0.713235259},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":true,"Hands":true,"CardID":306420,"SidewaysCard":false,"CustomDeck":{"3064":{"FaceURL":"https://i.imgur.com/yh9Zl6U.jpg","BackURL":"http://cloud-3.steamusercontent.com/ugc/931553051989537266/4F8EF28EECA8E2376771AD6B18CA93622216C17A/","NumWidth":10,"NumHeight":7,"BackIsHidden":true,"UniqueBack":false,"Type":0}},"LuaScript":"","LuaScriptState":"","XmlUI":""},{"GUID":"fb5176","Name":"Custom_Tile","Transform":{"posX":-7.50000143,"posY":1.50668371,"posZ":14.5000029,"rotX":0.004946248,"rotY":89.99144,"rotZ":359.9891,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/vppt2my.png","ImageSecondaryURL":"https://i.imgur.com/vppt2my.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":"","States":{"2":{"GUID":"44b0c5","Name":"Custom_Tile","Transform":{"posX":-39.7933121,"posY":1.63758957,"posZ":2.038383,"rotX":359.9201,"rotY":269.9961,"rotZ":0.0168742146,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/HyfE8m8.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""},"3":{"GUID":"5b38c6","Name":"Custom_Tile","Transform":{"posX":-38.8217163,"posY":1.99356019,"posZ":0.4159239,"rotX":359.9201,"rotY":272.9828,"rotZ":0.01687373,"scaleX":0.8,"scaleY":1,"scaleZ":0.8},"Nickname":"","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0.6045295,"g":0.6045295,"b":0.6045295},"LayoutGroupSortIndex":0,"Value":0,"Locked":false,"Grid":true,"Snap":true,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":true,"Tooltip":true,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomImage":{"ImageURL":"https://i.imgur.com/dHKBLoD.png","ImageSecondaryURL":"https://i.imgur.com/HyfE8m8.png","ImageScalar":1,"WidthScale":0,"CustomTile":{"Type":3,"Thickness":0.1,"Stackable":false,"Stretch":true}},"LuaScript":"","LuaScriptState":"","XmlUI":""}}},{"GUID":"fe0c46","Name":"Custom_Model","Transform":{"posX":-34,"posY":1.7663,"posZ":12.5,"rotX":0,"rotY":0.0001,"rotZ":0,"scaleX":1,"scaleY":1,"scaleZ":1},"Nickname":"Text Tool","Description":"","GMNotes":"","AltLookAngle":{"x":0,"y":0,"z":0},"ColorDiffuse":{"r":0,"g":0,"b":0,"a":0},"LayoutGroupSortIndex":0,"Value":0,"Locked":true,"Grid":true,"Snap":false,"IgnoreFoW":false,"MeasureMovement":false,"DragSelectable":true,"Autoraise":true,"Sticky":false,"Tooltip":false,"GridProjection":false,"HideWhenFaceDown":false,"Hands":false,"CustomMesh":{"MeshURL":"http://cloud-3.steamusercontent.com/ugc/1478820768302617365/27883B7913E0E69143C3AA03493B7E7C4E8C29C0/","DiffuseURL":"","NormalURL":"","ColliderURL":"","Convex":true,"MaterialIndex":1,"TypeIndex":0,"CastShadows":true},"LuaScript":"-- Code for bag to identify text tool objects\r\nmovableTextTool_cowgoesmoo33 = true\r\n\r\n-- Number of characters before the text box width expands.\r\nEXPAND_INTERVAL = 20\r\n\r\n-- This table controls what is passed between save/load\r\ndata = {}\r\n\r\nfunction onLoad(saved_data)\r\n  if saved_data ~= '' then\r\n    data = JSON.decode(saved_data)\r\n    if data.text ~= '' then\r\n      self.interactable = data.interactable\r\n      staticMode()\r\n      return\r\n    end\r\n  else\r\n    data = {size=200, color=Color(0,0,0), text='', interactable=true,\r\n        enter_to_finish=false, autolock=false, autolift=false,\r\n        hover_height=0.05, box_transparency=1}\r\n  end\r\n\r\n  inputMode()\r\nend\r\n\r\n-- True if in the middle of delay after pressing Enter (with enter_to_finish on)\r\nfinishing = false\r\nfunction input_func(obj, color, input, stillEditing)\r\n  local params = getBox(input)\r\n  if params then\r\n    params.value = input\r\n    self.editInput(params)\r\n  end\r\n\r\n  if not stillEditing then\r\n    data.text = input\r\n    updateState()\r\n    if input ~= '' then staticMode(color) end\r\n  elseif data.enter_to_finish then\r\n    -- If enter is pressed: remove last newline and force finish\r\n    if not finishing and input:sub(-1) == '\\n' then\r\n      finishing = true\r\n      -- Delay to avoid user's Enter keypress being detected (opens chat box)\r\n      Wait.frames(function()\r\n        input = input:sub(1, -2)\r\n        data.text = input\r\n        updateState()\r\n        if input ~= '' then staticMode(color) else inputMode() end\r\n        finishing = false\r\n      end, 10)\r\n    end\r\n  end\r\nend\r\n\r\n-- When the inpupt box appears and lets the player type in it.\r\nfunction inputMode()\r\n  self.clearContextMenu()\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n\r\n  local size = getBox(data.text, true)\r\n\r\n  self.createInput({\r\n    input_function = \"input_func\",\r\n    function_owner = self,\r\n    label          = \"Type Here\",\r\n    alignment      = 3,\r\n    position       = {x=0, y=data.hover_height, z=0},\r\n    rotation       = {0, 180, 0},\r\n    width          = size.width,\r\n    height         = size.height,\r\n    color          = getBackground(data.color),\r\n    font_color     = data.color,\r\n    font_size      = data.size,\r\n    value          = data.text,\r\n  })\r\n\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\nend\r\n\r\n-- When the input box disappears and displays the text.\r\nfunction staticMode(player)\r\n  self.clearContextMenu()\r\n  if data.autolock then\r\n    self.locked = true\r\n  end\r\n  if self.getInputs() and #self.getInputs() ~= 0 then\r\n    self.removeInput(0)\r\n  end\r\n\r\n  -- Clear from selecting player\r\n  if player then\r\n    self.removeFromPlayerSelection(player)\r\n  end\r\n\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  self.createButton({\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=self,\r\n    position={0,data.hover_height,0}, rotation={0,180,0}, height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  })\r\n\r\n  self.addContextMenuItem('Edit Text', function(color)\r\n    self.removeFromPlayerSelection(color)\r\n    inputMode()\r\n  end)\r\n  self.addContextMenuItem('Clear', function(color)\r\n    applyMultiple(color, 'clear', _, true)\r\n  end)\r\n  self.addContextMenuItem('Color: Object Tint', function(color)\r\n    applyMultiple(color, 'setColor')\r\n  end)\r\n  self.addContextMenuItem('Color: Player', function(color)\r\n    applyMultiple(color, 'setColor', {Color.fromString(color)})\r\n  end)\r\n  self.addContextMenuItem('Color: Black', function(color)\r\n    applyMultiple(color, 'setColor', {Color(0,0,0)})\r\n  end)\r\n  self.addContextMenuItem('Color: White', function(color)\r\n    applyMultiple(color, 'setColor', {Color(1,1,1)})\r\n  end)\r\n  self.addContextMenuItem('Size: Increase', function(color)\r\n    applyMultiple(color, 'changeSize', {50})\r\n  end, true)\r\n  self.addContextMenuItem('Size: Decrease', function(color)\r\n    applyMultiple(color, 'changeSize', {-50})\r\n  end, true)\r\n  self.addContextMenuItem('Permanently Attach', attemptAttach)\r\n  self.addContextMenuItem('Permalock', function(color)\r\n    applyMultiple(color, 'permalock', _, true)\r\n  end)\r\nend\r\n\r\nfunction changeSize(params)\r\n  local delta = params[1]\r\n  local newSize = data.size + delta\r\n  if newSize > 800  or newSize < 50 then\r\n    return\r\n  end\r\n  data.size = newSize\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_size=data.size})\r\n  else\r\n    local size = getBox(data.text, true)\r\n    self.editInput({width=size.width, height=size.height, font_size=data.size})\r\n  end\r\nend\r\n\r\nfunction setColor(params)\r\n  if params and params[1] then\r\n    data.color = params[1]\r\n  else\r\n    data.color = self.getColorTint():setAt('a', 1) -- Take on color of object tint\r\n  end\r\n  updateState()\r\n  if self.getButtons() and #self.getButtons() ~= 0 then\r\n    self.editButton({font_color=data.color})\r\n  else\r\n    self.editInput({font_color=data.color, color=getBackground(data.color)})\r\n  end\r\nend\r\n\r\nfunction getBackground(color) --determines whether to use black or white depending on luminance\r\n  local r,g,b = Color(color):get()\r\n\r\n  local lum = 0.2126*r + 0.7152*g + 0.0722*b\r\n  if lum > 0.75 then\r\n    return {0.2,0.2,0.2, data.box_transparency}\r\n  else\r\n    return {1,1,1, data.box_transparency}\r\n  end\r\nend\r\n\r\nfunction clear()\r\n  data.text = ''\r\n  updateState()\r\n  inputMode()\r\nend\r\n\r\nfunction permalock()\r\n  self.interactable = false\r\n  data.interactable = false\r\n  updateState()\r\nend\r\n\r\nlocal target_script = [[\r\nfunction onLoad(script_state)\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    for _,entry in ipairs(state) do\r\n      self.createButton(entry)\r\n    end\r\n    self.addContextMenuItem('Clear All Text', function(color)\r\n      self.clearContextMenu()\r\n      self.clearButtons()\r\n      self.script_state = ''\r\n      self.script_code = ''\r\n    end)\r\n  end\r\nend\r\n]]\r\n\r\nfunction attemptAttach(player_color)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  local attachee\r\n  local attachers = {}\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if obj ~= self then\r\n        table.insert(attachers, obj)\r\n      end\r\n    else\r\n      if attachee then\r\n        broadcastToColor(\"More than one target selected.\", player_color)\r\n        return\r\n      else\r\n        attachee = obj\r\n      end\r\n    end\r\n  end\r\n  if attachee then\r\n    local code = attachee.script_code\r\n    if code and code ~= '' and code ~= target_script then\r\n      broadcastToColor(\"Warning: script on card has been overriden. Rewind time to undo.\", player_color)\r\n    end\r\n    for i,attacher in ipairs(attachers) do\r\n      attacher.call('attach', {target = attachee})\r\n    end\r\n    attach({target = attachee})\r\n    local type, flip = attachee.type, attachee.getRotation().z\r\n    if (type == 'Card' or type == 'Deck') and flip > 175 and flip < 185 then\r\n      broadcastToColor(\"Warning: text will not display if card or deck is facing down.\", player_color)\r\n    end\r\n  else\r\n    broadcastToColor(\"You must have a target object in your selection (using click-and-drag or Ctrl+Click) to use this option.\", player_color)\r\n  end\r\nend\r\n\r\nfunction attach(params)\r\n  local target = params.target\r\n  local displayText = data.text\r\n  if data.enter_to_finish then\r\n    displayText = displayText:gsub('%[n%]', '\\n')\r\n  end\r\n\r\n  local textRotation = self.getRotation():sub(target.getRotation())\r\n    :add(Vector(180, 0, 180))\r\n\r\n  local textPosition = target.positionToLocal(\r\n    self.getPosition():add(Vector(0, data.hover_height, 0))\r\n  )\r\n  textPosition.x = -textPosition.x\r\n\r\n  local textScale = {}\r\n  textScale.x = self.getScale().x / target.getScale().x\r\n  textScale.y = self.getScale().x / target.getScale().y\r\n  textScale.z = self.getScale().x / target.getScale().z\r\n\r\n  local details = {\r\n    label=displayText,\r\n    click_function=\"none\",\r\n    function_owner=nil,\r\n    position=textPosition,\r\n    rotation=textRotation,\r\n    scale=textScale,\r\n    height=0, width=0,\r\n    font_color=data.color, font_size=data.size\r\n  }\r\n\r\n  target.createButton(details)\r\n\r\n  local script_state = target.script_state\r\n  if script_state and script_state ~= '' then\r\n    local state = JSON.decode(script_state)\r\n    table.insert(state, details)\r\n    target.script_state = JSON.encode(state)\r\n  else\r\n    target.script_state = JSON.encode({[1]=details})\r\n  end\r\n\r\n  target.script_code = target_script\r\n\r\n  self.destruct()\r\nend\r\n\r\nfunction applyMultiple(player_color, func_string, params, static_only)\r\n  local objs = Player[player_color].getSelectedObjects()\r\n  for _,obj in ipairs(objs) do\r\n    if obj.getVar('movableTextTool_cowgoesmoo33') then\r\n      if not static_only or obj.call('isStatic') then\r\n        obj.call(func_string, params)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction isStatic()\r\n  local input = self.getInputs()\r\n  return not input or #input == 0\r\nend\r\n\r\nfunction getBox(input, force)\r\n  local maxLength, lineCount = EXPAND_INTERVAL, 1\r\n  local lineLength = 0\r\n  for i = 1, #input do\r\n    local c = input:sub(i,i)\r\n    if c == '\\n' then\r\n      lineCount = lineCount + 1\r\n      if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n      lineLength = 0\r\n    else\r\n      lineLength = lineLength + 1\r\n    end\r\n  end\r\n  if lineLength > maxLength then maxLength = (math.floor(lineLength / EXPAND_INTERVAL) + 1) * EXPAND_INTERVAL end\r\n\r\n  newWidth = data.size * maxLength * 0.9\r\n  newHeight = data.size * lineCount + 23\r\n\r\n  if force or boxWidth ~= newWidth or boxHeight ~= newHeight then\r\n    boxWidth, boxHeight = newWidth, newHeight\r\n    return {width = boxWidth, height = boxHeight}\r\n  end\r\n  return nil\r\nend\r\n\r\ntemp_lift = nil\r\nfunction onPickUp(player_color)\r\n  if data.autolift then\r\n    local player = Player[player_color]\r\n    temp_lift = player.lift_height\r\n    player.lift_height = 0\r\n  end\r\nend\r\n\r\nfunction onDrop(player_color)\r\n  if data.autolift and temp_lift then\r\n    Player[player_color].lift_height = temp_lift\r\n  end\r\nend\r\n\r\n-- Should be called every time data is modified, allows info to be saved on copy/paste\r\nfunction updateState()\r\n  self.script_state = JSON.encode(data)\r\nend\r\n\r\nfunction onSave()\r\n  self.script_state = JSON.encode(data)\r\n  return self.script_state\r\nend","LuaScriptState":"{\"autolift\":false,\"autolock\":false,\"box_transparency\":1,\"color\":{\"a\":1,\"b\":1,\"g\":1,\"r\":1},\"enter_to_finish\":false,\"hover_height\":0.05,\"interactable\":true,\"size\":550,\"text\":\"1)\"}","XmlUI":""}],"AttachedDecals":[{"Transform":{"posX":-0.0021877822,"posY":-0.08963572,"posZ":-0.00288731651,"rotX":270,"rotY":359.869568,"rotZ":0,"scaleX":2.00000215,"scaleY":2.00000238,"scaleZ":2.00000262},"CustomDecal":{"Name":"dunwich_back","ImageURL":"http://cloud-3.steamusercontent.com/ugc/959719855119695911/931B9829687A20F4DEADB36DA57B7E6D76792231/","Size":7.4}}]}